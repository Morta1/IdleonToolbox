(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,565482,374960,527320,996534,e=>{"use strict";var t=e.i(388866);e.s(["List",()=>t.default],565482),e.i(350461);var a=e.i(191788),s=e.i(56206),n=e.i(600961),o=e.i(174855),r=e.i(280445),i=e.i(590117),l=e.i(395724),u=e.i(916989),c=e.i(75136),d=e.i(860452),g=e.i(713149),p=e.i(46739);function m(e){return(0,p.default)("MuiListItem",e)}function f(e){return(0,p.default)("MuiListItemButton",e)}(0,g.default)("MuiListItem",["root","container","dense","alignItemsFlexStart","divider","gutters","padding","secondaryAction"]);let B=(0,g.default)("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]);function h(e){return(0,p.default)("MuiListItemSecondaryAction",e)}e.s(["default",0,B,"getListItemButtonUtilityClass",()=>f],374960),e.s(["listItemButtonClasses",0,B],527320),(0,g.default)("MuiListItemSecondaryAction",["root","disableGutters"]);var y=e.i(391398);let S=(0,r.styled)("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,a.disableGutters&&t.disableGutters]}})({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",variants:[{props:({ownerState:e})=>e.disableGutters,style:{right:0}}]}),T=a.forwardRef(function(e,t){let o=(0,l.useDefaultProps)({props:e,name:"MuiListItemSecondaryAction"}),{className:r,...i}=o,u=a.useContext(d.default),c={...o,disableGutters:u.disableGutters},g=(e=>{let{disableGutters:t,classes:a}=e;return(0,n.default)({root:["root",t&&"disableGutters"]},h,a)})(c);return(0,y.jsx)(S,{className:(0,s.default)(g.root,r),ownerState:c,ref:t,...i})});T.muiName="ListItemSecondaryAction";let v=(0,r.styled)("div",{name:"MuiListItem",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,a.dense&&t.dense,"flex-start"===a.alignItems&&t.alignItemsFlexStart,a.divider&&t.divider,!a.disableGutters&&t.gutters,!a.disablePadding&&t.padding,a.hasSecondaryAction&&t.secondaryAction]}})((0,i.default)(({theme:e})=>({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",variants:[{props:({ownerState:e})=>!e.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:e})=>!e.disablePadding&&e.dense,style:{paddingTop:4,paddingBottom:4}},{props:({ownerState:e})=>!e.disablePadding&&!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>!e.disablePadding&&!!e.secondaryAction,style:{paddingRight:48}},{props:({ownerState:e})=>!!e.secondaryAction,style:{[`& > .${B.root}`]:{paddingRight:48}}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:e})=>e.button,style:{transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:({ownerState:e})=>e.hasSecondaryAction,style:{paddingRight:48}}]}))),_=(0,r.styled)("li",{name:"MuiListItem",slot:"Container",overridesResolver:(e,t)=>t.container})({position:"relative"}),b=a.forwardRef(function(e,t){let r=(0,l.useDefaultProps)({props:e,name:"MuiListItem"}),{alignItems:i="center",children:g,className:p,component:f,components:B={},componentsProps:h={},ContainerComponent:S="li",ContainerProps:{className:b,...A}={},dense:M=!1,disableGutters:I=!1,disablePadding:C=!1,divider:E=!1,secondaryAction:O,slotProps:P={},slots:x={},...w}=r,L=a.useContext(d.default),R=a.useMemo(()=>({dense:M||L.dense||!1,alignItems:i,disableGutters:I}),[i,L.dense,M,I]),D=a.useRef(null),k=a.Children.toArray(g),N=k.length&&(0,u.default)(k[k.length-1],["ListItemSecondaryAction"]),G={...r,alignItems:i,dense:R.dense,disableGutters:I,disablePadding:C,divider:E,hasSecondaryAction:N},F=(e=>{let{alignItems:t,classes:a,dense:s,disableGutters:o,disablePadding:r,divider:i,hasSecondaryAction:l}=e;return(0,n.default)({root:["root",s&&"dense",!o&&"gutters",!r&&"padding",i&&"divider","flex-start"===t&&"alignItemsFlexStart",l&&"secondaryAction"],container:["container"]},m,a)})(G),H=(0,c.default)(D,t),U=x.root||B.Root||v,j=P.root||h.root||{},W={className:(0,s.default)(F.root,j.className,p),...w},q=f||"li";return N?(q=W.component||f?q:"div","li"===S&&("li"===q?q="div":"li"===W.component&&(W.component="div")),(0,y.jsx)(d.default.Provider,{value:R,children:(0,y.jsxs)(_,{as:S,className:(0,s.default)(F.container,b),ref:H,ownerState:G,...A,children:[(0,y.jsx)(U,{...j,...!(0,o.default)(U)&&{as:q,ownerState:{...G,...j.ownerState}},...W,children:k}),k.pop()]})})):(0,y.jsx)(d.default.Provider,{value:R,children:(0,y.jsxs)(U,{...j,as:q,ref:H,...!(0,o.default)(U)&&{ownerState:{...G,...j.ownerState}},...W,children:[k,O&&(0,y.jsx)(T,{children:O})]})})});e.s(["ListItem",0,b],996534)},164295,937157,e=>{"use strict";e.i(350461);var t=e.i(191788),a=e.i(56206),s=e.i(600961),n=e.i(115871),o=e.i(343906);e.s(["typographyClasses",()=>o.default],937157);var o=o,r=e.i(860452),i=e.i(280445),l=e.i(395724),u=e.i(474844),c=e.i(69998),d=e.i(391398);let g=(0,i.styled)("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[{[`& .${u.default.primary}`]:t.primary},{[`& .${u.default.secondary}`]:t.secondary},t.root,a.inset&&t.inset,a.primary&&a.secondary&&t.multiline,a.dense&&t.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${o.default.root}:where(& .${u.default.primary})`]:{display:"block"},[`.${o.default.root}:where(& .${u.default.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),p=t.forwardRef(function(e,o){let i=(0,l.useDefaultProps)({props:e,name:"MuiListItemText"}),{children:p,className:m,disableTypography:f=!1,inset:B=!1,primary:h,primaryTypographyProps:y,secondary:S,secondaryTypographyProps:T,slots:v={},slotProps:_={},...b}=i,{dense:A}=t.useContext(r.default),M=null!=h?h:p,I=S,C={...i,disableTypography:f,inset:B,primary:!!M,secondary:!!I,dense:A},E=(e=>{let{classes:t,inset:a,primary:n,secondary:o,dense:r}=e;return(0,s.default)({root:["root",a&&"inset",r&&"dense",n&&o&&"multiline"],primary:["primary"],secondary:["secondary"]},u.getListItemTextUtilityClass,t)})(C),O={slots:v,slotProps:{primary:y,secondary:T,..._}},[P,x]=(0,c.default)("primary",{className:E.primary,elementType:n.default,externalForwardedProps:O,ownerState:C}),[w,L]=(0,c.default)("secondary",{className:E.secondary,elementType:n.default,externalForwardedProps:O,ownerState:C});return null==M||M.type===n.default||f||(M=(0,d.jsx)(P,{variant:A?"body2":"body1",component:x?.variant?void 0:"span",...x,children:M})),null==I||I.type===n.default||f||(I=(0,d.jsx)(w,{variant:"body2",color:"textSecondary",...L,children:I})),(0,d.jsxs)(g,{className:(0,a.default)(E.root,m),ownerState:C,ref:o,...b,children:[M,I]})});e.s(["ListItemText",0,p],164295)},571853,e=>{"use strict";let t=async()=>{let e=await fetch("https://oauth2.googleapis.com/device/code",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"client_id=267901585099-u6fjd75v6k9gefq7bcokcndv99riir5j&scope=email profile"});return await e.json()},a=async e=>{try{let t=`client_id=267901585099-u6fjd75v6k9gefq7bcokcndv99riir5j&client_secret=HzoZF-UKUNfFwBuz4vafwsaR&device_code=${e}&grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Adevice_code`,a=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t});return await a.json()}catch(e){console.error("Error has occurred while trying to authenticate:",e)}};e.s(["getUserAndDeviceCode",()=>t,"getUserToken",()=>a])},824048,e=>{"use strict";e.i(350461);var t=e.i(191788),a=e.i(56206),s=e.i(600961),n=e.i(280445),o=e.i(590117),r=e.i(395724),i=e.i(312326),l=e.i(860452),u=e.i(391398);let c=(0,n.styled)("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,"flex-start"===a.alignItems&&t.alignItemsFlexStart]}})((0,o.default)(({theme:e})=>({minWidth:56,color:(e.vars||e).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),d=t.forwardRef(function(e,n){let o=(0,r.useDefaultProps)({props:e,name:"MuiListItemIcon"}),{className:d,...g}=o,p=t.useContext(l.default),m={...o,alignItems:p.alignItems},f=(e=>{let{alignItems:t,classes:a}=e;return(0,s.default)({root:["root","flex-start"===t&&"alignItemsFlexStart"]},i.getListItemIconUtilityClass,a)})(m);return(0,u.jsx)(c,{className:(0,a.default)(f.root,d),ownerState:m,ref:n,...g})});e.s(["ListItemIcon",0,d],824048)},34121,e=>{"use strict";var t=e.i(191788),a=e.i(56206),s=e.i(600961),n=e.i(203060),o=e.i(280445),r=e.i(590117),i=e.i(395724),l=e.i(889095),u=e.i(941661),c=e.i(952753),d=e.i(75136),g=e.i(860452),p=e.i(374960),m=e.i(391398);let f=(0,o.styled)(u.default,{shouldForwardProp:e=>(0,l.default)(e)||"classes"===e,name:"MuiListItemButton",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,a.dense&&t.dense,"flex-start"===a.alignItems&&t.alignItemsFlexStart,a.divider&&t.divider,!a.disableGutters&&t.gutters]}})((0,r.default)(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${p.default.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,n.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${p.default.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:(0,n.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${p.default.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:(0,n.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,n.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${p.default.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${p.default.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.dense,style:{paddingTop:4,paddingBottom:4}}]}))),B=t.forwardRef(function(e,n){let o=(0,i.useDefaultProps)({props:e,name:"MuiListItemButton"}),{alignItems:r="center",autoFocus:l=!1,component:u="div",children:B,dense:h=!1,disableGutters:y=!1,divider:S=!1,focusVisibleClassName:T,selected:v=!1,className:_,...b}=o,A=t.useContext(g.default),M=t.useMemo(()=>({dense:h||A.dense||!1,alignItems:r,disableGutters:y}),[r,A.dense,h,y]),I=t.useRef(null);(0,c.default)(()=>{l&&I.current&&I.current.focus()},[l]);let C={...o,alignItems:r,dense:M.dense,disableGutters:y,divider:S,selected:v},E=(e=>{let{alignItems:t,classes:a,dense:n,disabled:o,disableGutters:r,divider:i,selected:l}=e,u=(0,s.default)({root:["root",n&&"dense",!r&&"gutters",i&&"divider",o&&"disabled","flex-start"===t&&"alignItemsFlexStart",l&&"selected"]},p.getListItemButtonUtilityClass,a);return{...a,...u}})(C),O=(0,d.default)(I,n);return(0,m.jsx)(g.default.Provider,{value:M,children:(0,m.jsx)(f,{ref:O,href:b.href||b.to,component:(b.href||b.to)&&"div"===u?"button":u,focusVisibleClassName:(0,a.default)(E.focusVisible,T),ownerState:C,className:(0,a.default)(E.root,_),...b,classes:E,children:B})})});e.s(["default",0,B])},575982,750935,e=>{"use strict";e.s(["default",()=>h,"offlineTools",()=>B],575982);var t=e.i(391398),a=e.i(261576),s=e.i(717803),n=e.i(565482),o=e.i(996534),r=e.i(824048),i=e.i(164295),l=e.i(886779),u=e.i(191788),c=e.i(203828),d=e.i(985978),g=e.i(285592),p=e.i(34121),m=e.i(162271),f=e.i(608580);let B={cardSearch:!0,builds:!0,itemBrowser:!0,itemPlanner:!0},h=e=>{let h,S,T,v,_,b,A,M,I,C,E=(0,a.c)(21),{fromList:O}=e,{state:P}=(0,u.useContext)(d.AppContext),x=(0,c.useRouter)();E[0]!==x?(h=e=>{let t=`/tools/${e}`;void 0!==window.gtag&&window.gtag("event","handle_nav",{event_category:t,event_label:"engagement",value:1}),x.push({pathname:t})},E[0]=x,E[1]=h):h=E[1];let w=h;E[2]!==x?(S=e=>x.pathname.includes(e),E[2]=x,E[3]=S):S=E[3];let L=S;return E[4]===Symbol.for("react.memo_cache_sentinel")?(T={height:"100%"},E[4]=T):T=E[4],E[5]!==O?(v={...O?{padding:0}:{}},E[5]=O,E[6]=v):v=E[6],E[7]===Symbol.for("react.memo_cache_sentinel")?(_=Object.entries(m.PAGES.TOOLS),E[7]=_):_=E[7],E[8]!==w||E[9]!==L||E[10]!==P?.signedIn?(b=_.map((e,a)=>{let[s,n]=e;if(!P?.signedIn&&!B[s])return null;let{icon:o}=n,l=s.split(/(?=[A-Z])/).map(y).join("-"),u=s.split(/(?=[A-Z])/).join(" ").capitalize(),c=L(l);return(0,t.jsxs)(p.default,{selected:c,onClick:()=>w(l),children:[(0,t.jsx)(r.ListItemIcon,{sx:{minWidth:32},children:(0,t.jsx)("img",{style:{objectFit:"contain"},width:32,height:32,src:`${f.prefix}${o}.png`,alt:""})}),(0,t.jsx)(i.ListItemText,{slotProps:{primary:{color:c?"#99ccff":"inherit"}},style:{marginLeft:10},primary:u})]},s+" "+a)}),E[8]=w,E[9]=L,E[10]=P?.signedIn,E[11]=b):b=E[11],E[12]!==v||E[13]!==b?(A=(0,t.jsx)(n.List,{sx:v,children:b}),E[12]=v,E[13]=b,E[14]=A):A=E[14],E[15]!==O?(M=O?null:(0,t.jsx)(n.List,{style:{marginTop:"auto",paddingBottom:0},children:(0,t.jsx)(o.ListItem,{children:(0,t.jsx)(i.ListItemText,{children:(0,t.jsx)(g.default,{display:"inline-block"})})})}),E[15]=O,E[16]=M):M=E[16],E[17]===Symbol.for("react.memo_cache_sentinel")?(I=(0,t.jsx)(s.Divider,{}),E[17]=I):I=E[17],E[18]!==A||E[19]!==M?(C=(0,t.jsxs)(l.Stack,{sx:T,children:[A,M,I]}),E[18]=A,E[19]=M,E[20]=C):C=E[20],C};function y(e){return e.toLowerCase()}let S=async({device_code:e,h_nonce:t,statusToken:a})=>{let s=new URLSearchParams({client_id:"com.lavaflame.idleon.service.signin",nonce:t,redirect_uri:"https://us-central1-idlemmo.cloudfunctions.net/xapsi",response_mode:"form_post",response_type:"code id_token",scope:"email",code:e,state:a});window.open(`https://appleid.apple.com/auth/authorize?${s.toString()}`,"_blank","popup")},T=async()=>{let e=encodeURIComponent("https://us-central1-idlemmo.cloudfunctions.net/tspa"),t=await fetch(`https://appleauth.idleontoolbox.workers.dev/?url=${e}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});return await t.json()},v=async({device_code:e,statusToken:t})=>{let a=new URLSearchParams;a.append("device_code",e),a.append("statusToken",t);let s=encodeURIComponent("https://us-central1-idlemmo.cloudfunctions.net/capsc"),n=await fetch(`https://appleauth.idleontoolbox.workers.dev/?url=${s}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});return await n.json()};e.s(["appleAuthorize",()=>S,"geAppleStatus",()=>v,"getAppleCode",()=>T],750935)},478627,e=>{"use strict";var t=e.i(173024),a=e.i(805861),s=e.i(10051),n=e.i(618332),o=e.i(372110),r=e.i(172833),i=e.i(971176),l=e.i(712738),u=e.i(942144),c=e.i(82748),d=e.i(210270),g=e.i(109304),p=e.i(279522),m=e.i(931),f=e.i(276924),B=e.i(685849),h=e.i(608580),y=e.i(433568),S=e.i(733884),T=e.i(262887),v=e.i(775003),_=e.i(962202),b=e.i(24174),A=e.i(398241),M=e.i(198659),I=e.i(39188),C=e.i(405127),E=e.i(435327),O=e.i(161866),P=e.i(267350),x=e.i(470242),w=e.i(304782);let L=(e,m,f)=>{let B=t.mainStatMap?.[e?.class],y=(0,a.getPostOfficeBonus)(e?.postOffice,"Deaths_Storage_Unit",0),S=(0,s.getDungeonFlurboStatBonus)(f?.dungeons?.upgrades,"Weapon_Power"),v=(0,n.getCardBonusByEffect)(e?.cards?.equippedCards,"Weapon_Power"),_=(0,n.getCardBonusByEffect)(f?.cards,"Weapon_Power_(Passive)"),b=(0,o.getGuildBonusBonus)(f?.guild?.guildBonuses,3),A=(0,r.getSigilBonus)(f?.alchemy?.p2w?.sigils,"DUSTER_STUDS"),M=(0,i.getStatsFromGear)(e,"Weapon_Power",f),I=(0,l.getObolsBonus)(e?.obols,"Weapon_Power"),C=(0,T.getPlayerLabChipBonus)(e,f,19),E="strength"===B?(0,r.getBubbleBonus)(f,"SPEAR_POWAH",!1,"strength"===B):0,O="agility"===B?(0,r.getBubbleBonus)(f,"BOW_POWER",!1,"agility"===B):0,P="wisdom"===B||"luck"===B?(0,r.getBubbleBonus)(f,"WAND_PAWUR",!1,"wisdom"===B):0,x=(0,r.getVialsBonusByStat)(f?.alchemy?.vials,"WeaponPOW"),w=(0,d.getHighestLevelOf)(m,t.CLASSES.Barbarian),L=(0,u.getFamilyBonusBonus)(c.classFamilyBonuses,"WEAPON_POWER",w),R=(0,g.getStarSignBonus)(e,f,"Weapon_Power"),D=(0,p.getArcadeBonus)(f?.arcade?.shop,"Weapon_Power")?.bonus,k=(0,t.getTalentBonus)(e?.flatTalents,"TOUGH_STEAKS"),N=(0,t.getTalentBonus)(e?.flatTalents,"GAMER_STRENGTH"),G=Math.round(10*(0,t.getTalentBonus)(e?.flatTalents,"CREW_ROWING_STRENGTH"))/10,F=(0,t.getTalentBonus)(e?.flatTalents,"BELIEVER_STRENGTH"),H=(0,t.getTalentBonus)(e?.flatTalents,"ANIMALISTIC_FEROCITY"),U=(0,t.getTalentBonus)(e?.flatTalents,"WIRED_IN_POWER"),j=f?.breeding?.storedPets?.[0]?.power??0,W=(0,d.getHighestLevelOf)(m,t.CLASSES.Beginner),q=Math.min((0,t.getTalentBonus)(e?.flatStarTalents,"BEGINNER_BEST_CLASS"),Math.floor(W/10));return 5+y+S+(0,d.getFoodBonus)(e,f,"WeaponPowerBoosts")+(v+_+(b+A))+((M+I)*(1+(C+(E+(O+P)))/100)+q+(x+(L+(R+(D+(k*Math.floor(e?.skillsInfo?.cooking?.level/10)+(N*Math.floor(e?.skillsInfo?.gaming?.level/10)+(G*Math.floor(e?.skillsInfo?.sailing?.level/10)+F*Math.floor(e?.skillsInfo?.divinity?.level/10)))+(H*(0,h.lavaLog)(j)+U*Math.floor(e?.skillsInfo?.laboratory?.level/10))))))))},R=(e,s,n,o)=>{let u=D(e,n,"D"),d=D(e,n,"K"),g=t.mainStatMap?.[e?.class],p=e?.equipment?.[1]?.Speed||0,m=(0,i.getStatsFromGear)(e,56,n),f=(0,l.getObolsBonus)(e?.obols,c.bonuses?.etcBonuses?.[56]),B=(0,v.getMealsBonusByEffectOrStat)(n,null,"AtkSpd"),h=(0,T.getPlayerLabChipBonus)(e,n,4),y=(0,r.getBubbleBonus)(n,"HYPERSWIFT",!1,"wisdom"===g),S=(0,a.getPostOfficeBonus)(e?.postOffice,"Deaths_Storage_Unit",1),_=c.monsters?.[e?.targetMonster],b=k(_?.MonsterHPTotal,e,n),A=c.mapDetails?.[e?.mapIndex]?.[1]?.[0],M=c.mapDetails?.[e?.mapIndex]?.[1]?.[1],I=Math.min(Math.max(d,1),2.2),C=Math.max(.1,(1+(10-p)/5)/(1+(m+f+(B+(h+(y+S))))/100)),E=o?.maxDamage*(o.mastery+(1-o.mastery)/2)*(1+(o.critDamage-1)*(o.critChance/100))*(o.hitChance/100)*Math.max(u,1);return Math.floor(3600*(0<o.hitChance?Math.min(A/(o.respawnRate+.1),I/(M/(130*(o?.movementSpeed/100))+C*Math.max((b/E+.52)*(1/(o.hitChance/100)),1))):Math.min(A/(o.respawnRate+.1),I/(M/(130*o?.movementSpeed)+C*Math.max(b/E+.52,1)))))},D=(e,a,s)=>{let n=t.mainStatMap?.[e?.class],o=e?.talentsLoadout?.reduce((e,t)=>t?.AFKactivity!==0||t?.[s]===1?e:e*(t?.[s]||1)*(1+Math.min(1,t?.baseLevel/(t?.baseLevel+100))),1),i=(0,t.getTalentBonus)(e?.flatStarTalents,"ATTACKS_ON_SIMMER"),l=(0,t.getTalentBonus)(e?.flatTalents,"TWO_PUNCH_MAN"),u=(0,t.getTalentBonus)(e?.flatTalents,"TRIPLE_JAB"),c=(0,t.getTalentBonus)(e?.flatTalents,"DOUBLE_STRIKE"),d=(0,t.getTalentBonus)(e?.flatTalents,"HAVE_ANOTHER!"),g=(0,t.getTalentBonus)(e?.flatTalents,"HAVE_ANOTHER..._AGAIN!"),p=(0,r.getBubbleBonus)(a,"ALL_FOR_KILL",!1,"wisdom"===n);return"D"===s?o*(1+(Math.min(i,25)+Math.min(p,25))/100)*(1+(l+(u+(c+(d+g))))/100):o},k=(e,t,a)=>e*(1+((0,S.getPrayerBonusAndCurse)(t?.activePrayers,"Big_Brain_Time",a)?.curse+((0,S.getPrayerBonusAndCurse)(t?.activePrayers,"Midas_Minded",a)?.curse+(0,S.getPrayerBonusAndCurse)(t?.activePrayers,"Jawbreaker",a)?.curse))/100),N=(e,s,n,o)=>{let r=G(c.monsters?.[e?.targetMonster],e,n,o),i=(0,t.getTalentBonus)(e?.flatTalents,"MANA_IS_LIFE");i&&(r/=1+i/100);let l=(0,d.getHealthFoodBonus)(e,n,"Health"),u=(0,t.getTalentBonus)(e?.flatStarTalents,"GOBLET_OF_HEMOGLOBIN"),g=l+o?.survivabilityMath*(u/100)*o?.maxHp,p=r*c.mapDetails?.[e?.mapIndex]?.[1]?.[2]-g;if(!(p>0))return 100;{p=o?.maxHp/p;let s=(0,t.getTalentBonus)(e?.flatStarTalents,"BORED_TO_DEATH"),n=(0,a.getPostOfficeBonus)(e?.postOffice,"Locally_Sourced_Organs",2);return Math.min(Math.round(100*(p/(p+(0===s?600/(1+Math.min(50,Math.max(0,n)/100)):Math.max(s/(1+Math.min(50,Math.max(0,n))/100),100))/3600))),100)}},G=(e,a,s,n)=>{let{Damages:o}=e||{},r=o?.[0]-2.5*Math.pow(n?.defence?.value,.8),i=Math.pow(n?.defence?.value,1.5)/100,l=r/Math.max(1+n?.defence?.value/Math.max(o?.[0],1)*i,1),u=(0,t.getTalentBonusIfActive)(a?.activeBuffs,"NO_PAIN_NO_GAIN"),c=(0,t.getTalentBonus)(a?.flatTalents,"BRICKY_SKIN");return u&&(l*=2),c&&(l*=Math.max(.05,1-c/100)),l<.5?0:Math.max(Math.ceil(l),0)},F=(e,s,o,u)=>{let d=(0,g.getStarSignBonus)(e,o,"Total_Multikill"),m=(0,E.getSaltLickBonus)(o?.saltLick,8),f=(0,B.getStampsBonusByEffect)(o,"Base_Overkill"),h=(0,i.getStatsFromGear)(e,29,o),y=(0,l.getObolsBonus)(e?.obols,c.bonuses?.etcBonuses?.[29]),v=c.monsters?.[e?.targetMonster],_=k(v?.MonsterHPTotal,e,o),A=1;for(let e=0;e<50;e++)u?.maxDamage>=2*_*Math.pow(2,e+1)&&(A=e+2);let I=o?.deathNote?.[Math.floor(e?.mapIndex/50)]?.rank||0,C=(0,r.getVialsBonusByStat)(o?.alchemy?.vials,"Overkill"),P=(0,t.getTalentBonusIfActive)(e?.activeBuffs,"VOID_RADIUS"),x=(0,t.getHighestTalentByClass)(s,t.CLASSES.Voidwalker,"MASTER_OF_THE_SYSTEM"),w=(0,p.getArcadeBonus)(o?.arcade?.shop,"Multikill_per_Tier")?.bonus??0,L=(0,b.isArtifactAcquired)(o?.sailing?.artifacts,"Trilobite_Rock")?.bonus??0,R=(0,t.getTalentBonusIfActive)(e?.activeBuffs,"MANA_IS_LIFE","y"),D=(0,T.getPlayerLabChipBonus)(e,o,14),N=(0,i.getStatsFromGear)(e,71,o),G=(0,l.getObolsBonus)(e?.obols,c.bonuses?.etcBonuses?.[71]),F=(0,n.getCardBonusByEffect)(e?.cards?.equippedCards,"Multikill_per_tier"),H=(0,S.getPrayerBonusAndCurse)(e?.activePrayers,"Balance_of_Pain",o)?.bonus,U=(0,M.getShinyBonus)(o?.breeding?.pets,"Multikill_Per_Tier"),j=(0,a.getPostOfficeBonus)(e?.postOffice,"Utilitarian_Capsule",1),W=(0,r.getActiveBubbleBonus)(e?.equippedBubbles,"MR_MASSACRE",o),q=(0,O.getAchievementStatus)(o?.achievements,148),$=(0,O.getAchievementStatus)(o?.achievements,122),K=(0,O.getAchievementStatus)(o?.achievements,123);return Math.floor(d+m+(f+2*o?.towers?.towersTwo)+(h+y+(Math.min(5,q)+(6*$+2*K)))+A*(I+(C+(P+x*Math.floor(o?.accountOptions?.[158]/5))+(w+(L+R)+(D+(N+G+F+(H+U)))+(j+W)))))};e.s(["getMaxDamage",0,(e,o,D)=>{var G,H,U,j,W,q,$,K,V,Y,J,z,Z,Q,X,ee,et,ea,es,en,eo,er,ei,el,eu,ec,ed,eg,ep,em,ef,eB,eh,ey,eS,eT,ev,e_,eb,eA,eM,eI,eC,eE,eO,eP;let ex,ew,eL,eR,eD,ek,eN,eG,eF,eH,eU,ej,eW,eq,e$,eK,eV,eY,eJ,ez,eZ,eQ,eX,e0,e1,e2,e5,e3,e9,e8,e4,e6,e7,te,tt,ta,ts,tn,to,tr,ti,tl,tu,tc,td,tg,tp,tm,tf,tB,th,ty,tS,tT,tv,t_,tb,tA,tM,tI,tC,tE,tO,tP,tx,tw,tL,tR,tD,tk,tN,tG,tF,tH,tU,tj,tW,tq,t$,tK,tV,tY,tJ,tz,tZ,tQ,tX,t0,t1,t2,t5,t3,t9,t8,t4,t6,t7,ae,at,aa,as,an,ao,ar,ai,al,au,ac,ad,ag,ap,am,af,aB,ah,ay,aS,aT,av,a_,ab,aA,aM,aI,aC,aE,aO,aP,ax,aw,aL,aR,aD,ak,aN,aG,aF,aH,aU,aj,aW,aq,a$,aK,aV,aY,aJ,az,aZ,aQ,aX,a0,a1,a2,a5,a3,a9,a8,a4,a6,a7,se,st,sa,ss,sn,so,sr,si,sl,su,sc,sd,sg={survivabilityMath:0},sp=t.mainStatMap?.[e?.class],sm=(0,t.getTalentBonus)(e?.flatTalents,"STRENGTH_IN_NUMBERS"),sf=(0,t.getTalentBonus)(e?.flatTalents,"KNOWLEDGE_IS_POWER"),sB=(0,t.getTalentBonus)(e?.flatTalents,"LUCKY_HIT"),sh=(e?.stats?.[sp]||0)*(1+(sm+(sf+sB))/100),{respawnRate:sy}=(0,m.getRespawnRate)(e,D);sg.respawnRate=sy;let{afkGains:sS}=(0,m.getAfkGain)(e,o,D);sg.afkGains=sS,G=e,H=o,U=D,ex=(0,d.getFoodBonus)(G,U,"HpBaseBoosts"),ew=(0,f.getStatueBonus)(U,4,G?.flatTalents),eL=(0,n.getCardBonusByEffect)(G?.cards?.equippedCards,"Base_HP"),eR=(0,n.getCardBonusByEffect)(G?.cards?.equippedCards,"Total_HP"),eD=(0,B.getStampsBonusByEffect)(U,"Base_HP"),ek=(0,a.getPostOfficeBonus)(G?.postOffice,"Locally_Sourced_Organs",0),eN=(0,a.getPostOfficeBonus)(G?.postOffice,"Locally_Sourced_Organs",1),eG=(0,t.getTalentBonus)(G?.flatTalents,"HEALTH_BOOSTER"),eF=(0,t.getTalentBonus)(G?.flatStarTalents,"UBERCHARGED_HEALTH"),eH=(0,t.getTalentBonus)(G?.flatTalents,"STRENGTH_IN_NUMBERS"),eU=(0,t.getTalentBonus)(G?.flatTalents,"HEALTH_OVERDRIVE"),ej=(0,t.getTalentBonus)(G?.flatTalents,"HEMA_OVERDRIVE"),eW=(0,t.getTalentBonusIfActive)(G?.activeBuffs,"NO_PAIN_NO_GAIN"),eq=(0,g.getStarSignBonus)(G,U,"Total_HP"),e$=(0,d.getHighestLevelOf)(H,t.CLASSES.Squire),eK=(0,t.getTalentBonus)(G?.flatTalents,"THE_FAMILY_GUY"),eV=(0,u.getFamilyBonusBonus)(c.classFamilyBonuses,"TOTAL_HP",e$)*((0,t.checkCharClass)(G?.class,t.CLASSES.Squire)&&G?.level===e$&&eK>0?1+eK/100:1),eY=(0,i.getStatsFromGear)(G,15,U),eJ=(0,l.getObolsBonus)(G?.obols,c.bonuses?.etcBonuses?.[15]),ez=(0,y.getShrineBonus)(U?.shrines,1,G?.mapIndex,U?.cards,U?.sailing?.artifacts),eZ=(0,d.getGoldenFoodBonus)("Golden_Jam",G,U,H)||1,sg.maxHp=(15+eL+0+(eD+(ex+ew))+(ek+(eG+eF)+Math.pow(G?.stats?.strength*(1+eH/100),1.05)))*((1+(eU+(ej+eY+eJ))/100)*(1+ez/100)*(1===eZ?eZ:1+eZ/100)*(1+eN/100)*(1-eW/100)*(1+(eV+eR)/100)*(1+eq/100)),j=e,W=0,q=D,eQ=(0,n.getCardBonusByEffect)(j?.cards?.equippedCards,"Base_MP"),eX=(0,n.getCardBonusByEffect)(j?.cards?.equippedCards,"Total_MP"),e0=(0,B.getStampsBonusByEffect)(q,"Base_MP"),e1=(0,t.getTalentBonus)(j?.flatTalents,"MANA_BOOSTER"),e2=(0,a.getPostOfficeBonus)(j?.postOffice,"Magician_Starterpack",0),e5=(0,a.getPostOfficeBonus)(j?.postOffice,"Magician_Starterpack",1),sg.maxMp=(1+((0,t.getTalentBonus)(j?.flatTalents,"MANA_OVERDRIVE")+(0,t.getTalentBonus)(j?.flatTalents,"HEMA_OVERDRIVE"))/100)*(1+(e5+eX)/100)*(10+eQ+0+e0+(e1+(j?.stats?.wisdom+e2))),sg.movementSpeed=(0,m.getPlayerSpeedBonus)(e,o,D),$=e,K=o,V=D,Y=sg.movementSpeed,e3=t.mainStatMap?.[$?.class],e9=(0,r.getVialsBonusByStat)(V?.alchemy?.vials,"baseACC"),e8=(0,a.getPostOfficeBonus)($?.postOffice,"Box_of_Unwanted_Stats",0),e4=(0,n.getCardBonusByEffect)($?.cards?.equippedCards,"Base_accuracy"),e6=(0,i.getStatsFromGear)($,28,V),e7=(0,d.getGoldenFoodBonus)("Butter_Bar",$,V,K)||0,te=(0,B.getStampsBonusByEffect)(V,"Base_Accuracy"),tt=(0,r.getBubbleBonus)(V,"SHAQURACY",!1,"agility"===e3),ta=(0,n.getCardBonusByEffect)($?.cards?.equippedCards,"Total_Accuracy"),ts=$?.cards?.cardSet?.rawName==="CardSet4"?$?.cards?.cardSet?.bonus:0,tn=(0,t.getTalentBonusIfActive)($?.activeBuffs,"EXTENDO_RANGEO"),to=(0,t.getTalentBonusIfActive)($?.activeBuffs,"BALANCED_SPIRIT"),tr=(0,g.getStarSignBonus)($,V,"Accuracy"),ti=(0,f.getStatueBonus)(V,14,$?.flatTalents),tl=(0,p.getArcadeBonus)(V?.arcade?.shop,"Total_Accuracy")?.bonus,tu=(0,s.getDungeonFlurboStatBonus)(V?.dungeons?.upgrades,"Accuracy"),tc=V?.bribes?.[21]?.done?V?.bribes?.[21]?.value:0,td=(0,t.getTalentBonus)($?.flatStarTalents,"TIPTOE_QUICKNESS",!0),tg=(0,S.getPrayerBonusAndCurse)($?.activePrayers,"Balance_of_Precision",V)?.bonus,tp=(0,S.getPrayerBonusAndCurse)($?.activePrayers,"Beefy_For_Real",V)?.curse,tm=(0,S.getPrayerBonusAndCurse)($?.activePrayers,"Balance_of_Pain",V)?.curse,tf=(0,T.getPlayerLabChipBonus)($,V,2),tB=(0,v.getMealsBonusByEffectOrStat)(V,null,"TotAcc"),th=(0,d.isCompanionBonusActive)(V,0)?(0,P.getMinorDivinityBonus)($,V,0):$?.linkedDeity===0?$?.deityMinorBonus:0,ty=$?.stats?.[({strength:"wisdom",agility:"strength",wisdom:"agility",luck:"luck"})[e3]]*(1+tt/100)*(1+(tn+(ta+(tr+(to+(ti+(tl+(tu+tc)))))))/100),Y/100>1.99&&(ty*=1+td/100),sg.accuracy=ty=(Math.pow(ty/4,1.4)+(ty+(2+e9+(e8+(e4+e6+e7)+te))))*(1+(ty+2*ts)/200)*Math.max(.1,1+(tg-tp-tm)/100)*(1+(tf+tB)/100)*(1+th/100),J=e,z=0,Z=D,tS=t.mainStatMap?.[J?.class],tT=(0,t.getTalentBonus)(J?.flatTalents,"FARSIGHT"),tv=(0,t.getTalentBonus)(J?.flatTalents,"CRITIKILL"),t_=(0,t.getTalentBonus)(J?.flatTalents,"KNUCKLEBUSTER"),tb=(0,t.getTalentBonusIfActive)(J?.activeBuffs,"DIVINE_INTERVENTION"),tA=(0,r.getBubbleBonus)(Z,"BAPPITY_BOOPITY",!1,"strength"===tS),tM=(0,B.getStampsBonusByEffect)(Z,"Critical_Damage"),tI=(0,n.getCardBonusByEffect)(J?.cards?.equippedCards,"Critical_Damage"),tC=(0,S.getPrayerBonusAndCurse)(J?.activePrayers,"Circular_Criticals",Z)?.curse,tE=(0,i.getStatsFromGear)(J,22,Z),tO=(0,l.getObolsBonus)(J?.obols,c.bonuses?.etcBonuses?.[22]),sg.critDamage=1.2+(tv+(0,f.getStatueBonus)(Z,5,J?.flatTalents)+(tT+(tM+(100*(1e3>J?.stats?.strength?(Math.pow(J?.stats?.strength+1,.37)-1)/40:(J?.stats?.strength-1e3)/(J?.stats?.strength+2500)*.5+.255)/1.8+(tA+(tI-tC+(t_+(tE+tO+tb))))))))/100,Q=e,X=0,ee=D,et=sg,tP=t.mainStatMap?.[Q?.class],tx=(0,n.getCardBonusByEffect)(Q?.cards?.equippedCards,"Critical_Chance"),tw=(0,n.getCardBonusByEffect)(ee?.cards,"Critical_Chance_(Passive)"),tL=Q?.cards?.cardSet?.rawName==="CardSet6"?Q?.cards?.cardSet?.bonus:0,tR=(0,S.getPrayerBonusAndCurse)(Q?.activePrayers,"Circular_Criticals",ee)?.bonus,tD=(0,v.getMealsBonusByEffectOrStat)(ee,null,"Crit"),tk=(0,f.getStatueBonus)(ee,13,Q?.flatTalents),tN=(0,t.getTalentBonus)(Q?.flatStarTalents,"MEGA_CRIT"),tG=(0,t.getTalentBonus)(Q?.flatStarTalents,"OVERACCURATE_CRIT"),tF=(0,g.getStarSignBonus)(Q,ee,"Crit_Chance"),tH=(0,i.getStatsFromGear)(Q,23,ee),tU=(0,l.getObolsBonus)(Q?.obols,c.bonuses?.etcBonuses?.[23]),tj=(0,t.getTalentBonus)(Q?.flatTalents,"I_SEE_YOU"),tW=(0,t.getTalentBonus)(Q?.flatTalents,"FARSIGHT",!0),tq=(0,O.getAchievementStatus)(ee?.achievements,184),t$=(0,a.getPostOfficeBonus)(Q?.postOffice,"Civil_War_Memory_Box",2),tK=c.monsters?.[Q?.targetMonster],tV=Math.floor(et?.accuracy),tY=(0,h.lavaLog)(tV-1.5*tK?.Defence),tJ=(0,r.getBubbleBonus)(ee,"CHEAP_SHOT",!1,"agility"===tP),sg.critChance=5+tL+(tx+Math.min(tw,50)+(tN+(tH+tU)+(tR+tD+tk+tF)))+(tj+(tW+5*tq+(t$+tG*tY)+((1e3>Q?.stats?.agility?(Math.pow(Q?.stats?.agility+1,.37)-1)/40:(Q?.stats?.agility-1e3)/(Q?.stats?.agility+2500)*.5+.255)/2.3*100+tJ))),ea=e,es=0,en=0,eo=sg,tz=c.monsters?.[ea?.targetMonster],sg.hitChance=.5<=(tZ=eo?.accuracy/tz?.Defence)?Math.floor(Math.min(100*(.95*tZ-.425),100)):0,er=e,ei=0,el=D,tQ=t.mainStatMap?.[er?.class],sg.mastery=Math.min(.8,.35+((0,r.getBubbleBonus)(el,"LIL_BIG_DAMAGE",!1,"agility"===tQ)+((0,n.getCardBonusByEffect)(er?.cards?.equippedCards,"Minimum_Damage")+((0,t.getTalentBonus)(er?.flatTalents,"MASTERY_UP")+(0,i.getStatsFromGear)(er,21,el))))/100),sg.miningEff=(0,w.getMiningEff)(e,o,D,sg);let{baseDamage:sT}=(eu=e,ec=o,ed=D,eg=sg,ep=sh,tX=t.mainStatMap?.[eu?.class],t0=(0,t.getTalentBonus)(eu?.flatTalents,"CARRY_A_BIG_STICK"),t1=(0,t.getTalentBonus)(eu?.flatTalents,"HIGH_POLYMER_LIMBS"),t2=(0,t.getTalentBonus)(eu?.flatTalents,"POWER_OVERWHELMING"),t5=(0,t.getTalentBonus)(eu?.flatTalents,"SHARPENED_AXE"),t3=L(eu,ec,ed),t9=(0,p.getArcadeBonus)(ed?.arcade?.shop,"Base_Damage")?.bonus??0,t8=(0,d.getGoldenFoodBonus)("Golden_Nomwich",eu,ed,ec),t4=(0,B.getStampsBonusByEffect)(ed,"Base_Damage"),t6=(0,a.getPostOfficeBonus)(eu?.postOffice,"Civil_War_Memory_Box",0),t7=(0,i.getStatsFromGear)(eu,16,ed),ae=(0,l.getObolsBonus)(eu?.obols,c.bonuses?.etcBonuses?.[16]),at=(0,f.getStatueBonus)(ed,0,eu?.flatTalents),aa=(0,r.getBubbleBonus)(ed,"BIG_MEATY_CLAWS",!1,"strength"===tX),as=(0,r.getBubbleBonus)(ed,"QUICK_SLAP",!1,"agility"===tX),an=(0,r.getBubbleBonus)(ed,"NAME_I_GUESS",!1,"wisdom"===tX),ao=(0,n.getCardBonusByEffect)(eu?.cards?.equippedCards,"Base_Damage"),ar=(0,r.getSigilBonus)(ed?.alchemy?.p2w?.sigils,"PLUNGING_SWORD"),(ai=Math.pow((t3*(1+(t0+(t1+t2))/100)+t5)/3,2)+(ep+t8)+t9+(t4+(t7+ae)+at+(t6+(aa*(0,h.lavaLog)(Math.max(eg.maxHp-250,1))+as*(Math.max(eg.movementSpeed/100-1.1,0)/.25)+(an*(0,h.lavaLog)(Math.max(eg.maxMp-150,1))+(ao+ar))))))>4e3&&(ai=4e3+Math.max(Math.pow(ai-4e3,.91),0)),ai>15e3&&(ai=15e3+Math.max(Math.pow(ai-15e3,.84))),{baseDamage:ai+=(0,d.getFoodBonus)(eu,ed,"BaseDmgBoosts")}),sv=(em=e,ef=0,eB=D,eh=sg,ey=sh,al=(0,f.getStatueBonus)(eB,22,em?.flatTalents),au=(0,t.getTalentBonus)(em?.flatTalents,"MEAT_SHANK"),ac=(0,t.getTalentBonus)(em?.flatTalents,"OVERCLOCKED_ENERGY"),1+(Math.pow(ey,.7)+((eB?.bribes?.[20]?.done?eB?.bribes?.[20]?.value:0)+((0,B.getStampsBonusByEffect)(eB,"Total_Damage")+al+0)+((0,h.lavaLog)(eh.maxHp)*au+(0,h.lavaLog)(eh.maxMp)*ac)))/100),s_=(eS=e,eT=o,ev=D,e_=sg,eb=sv,ad=(0,t.getTalentBonus)(eS?.flatTalents,"VEINS_OF_THE_INFERNAL"),ag=(0,d.getMinigameScore)(ev,"chopping"),ap=(0,t.getTalentBonus)(eS?.flatTalents,"CHOPPIN_IT_UP_EZ",!0)*Math.floor(ag/25),am=(0,t.getTalentBonus)(eS?.flatTalents,"SKILLAGE_DAMAGE")*Math.floor((Math.min(...Object.entries(eS?.skillsInfo||{})?.filter(([e,{index:t}])=>t<9)?.map(([e,{level:t}])=>t)||[])??0)/5),af=(0,t.getTalentBonus)(eS?.flatTalents,"APOCALYPSE_ZOW"),aB=eS?.zow?.finished?.[0]+1||0,ah=c.monsters?.[eS?.targetMonster],ay=(0,t.getTalentBonus)(eS?.flatTalents,"PRECISION_POWER"),aS=e_.accuracy>=ah?.Defence*2.25?ev?.refinery?.totalLevels*ay:0,aT=ev?.alchemy?.vials?.reduce((e,{level:t})=>e+ +(t>3),0),av=(0,t.getTalentBonus)(eS?.flatTalents,"VIRILE_VIALS"),a_=ev?.looty?.lootedItems,ab=(0,t.getTalentBonus)(eS?.flatTalents,"LOOTY_MC_SHOOTY"),aA=(0,B.calcStampCollected)(ev?.stamps),aM=(0,t.getTalentBonus)(eS?.flatTalents,"PAPERWORK,_GREAT..."),aI=(0,t.getTalentBonus)(eS?.flatTalents,"SPEEDNA")*Math.floor((e_.movementSpeed/100-1)/.15),aC=(0,t.getTalentBonus)(eS?.flatStarTalents,"DUNGEONIC_DAMAGE")*(0,h.lavaLog)(ev?.accountOptions?.[71]),aE=(0,d.isCompanionBonusActive)(ev,0)?(0,P.getMinorDivinityBonus)(eS,ev,2):eS?.linkedDeity===2?eS?.deityMinorBonus:eS?.secondLinkedDeityIndex===2?eS?.secondDeityMinorBonus:0,aO=(0,d.getGoldenFoodBonus)("Golden_Kebabs",eS,ev,eT)||1,100<(aP=eb*(1+ad*(eS?.skillsInfo?.smithing?.level/12)/100)*(1+(ap+(am+af*aB+aS+av*aT+(ab*a_/50+aM*aA/10)+aI+aC+aE))/100)*(1===aO?aO:1+aO/100))?100+Math.max(Math.pow(aP-100,.86),0):aP),sb=((e,s,o)=>{let p=t.mainStatMap?.[e?.class],{strength:m,agility:f,wisdom:B,luck:w}=e?.stats||{},L=1+(0,t.getTalentBonus)(e?.flatTalents,"WORMHOLE_EMPEROR")*(0,h.lavaLog)(o?.accountOptions?.[152]??0)/100,R=(0,x.getEquinoxBonus)(o?.equinox?.upgrades,"Matching_Scims"),D=5*(0,_.getEclipseSkullsBonus)(o),k=(0,t.getTalentBonusIfActive)(e?.activeBuffs,"NO_PAIN_NO_GAIN"),N=(0,g.getStarSignBonus)(e,o,"Total_Damage"),G=o?.divinity?.unlockedDeities??0,F=(0,t.getHighestTalentByClass)(s,t.CLASSES.Elemental_Sorcerer,"GODS_CHOSEN_CHILDREN",!1,!0),H=(0,t.getHighestTalentByClass)(s,t.CLASSES.Voidwalker,"POWER_ORB"),U=(0,y.getShrineBonus)(o?.shrines,0,e?.mapIndex,o?.cards,o?.sailing?.artifacts),j=(0,a.getPostOfficeBonus)(e?.postOffice,"Deaths_Storage_Unit",2),W=(0,a.getPostOfficeBonus)(e?.postOffice,"Scurvy_C'arr'ate",2),q=(0,a.getPostOfficeBonus)(e?.postOffice,"Gaming_Lootcrate",2),$=(0,d.getHighestLevelOf)(s,t.CLASSES.Blood_Berserker),K=(0,t.getTalentBonus)(e?.flatTalents,"THE_FAMILY_GUY"),V=(0,u.getFamilyBonusBonus)(c.classFamilyBonuses,"TOTAL_DAMAGE",$)*((0,t.checkCharClass)(e?.class,t.CLASSES.Blood_Berserker)&&K>0?1+K/100:1),Y=(0,b.isArtifactAcquired)(o?.sailing?.artifacts,"Crystal_Steak"),J=Y?.additionalData?.[e?.playerId]?.bonus??0,z=(0,b.isArtifactAcquired)(o?.sailing?.artifacts,"Ruble_Cuble")?.bonus??0,Z=(0,b.isArtifactAcquired)(o?.sailing?.artifacts,"Fun_Hippoete")?.bonus??0,Q=(0,b.isArtifactAcquired)(o?.sailing?.artifacts,"Opera_Mask")?.bonus??0,X=(0,b.isArtifactAcquired)(o?.sailing?.artifacts,"The_True_Lantern")?.bonus??0,ee=(0,A.getAtomBonus)(o,"Carbon_-_Wizard_Maximizer")??0,et=(0,M.getShinyBonus)(o?.breeding?.pets,"Total_Damage"),ea=(0,I.isSuperbitUnlocked)(o,"MSA_Skill_EXP")?.bonus??0,es=(0,d.getSkillMasteryBonusByIndex)(o?.totalSkillsLevels,o?.rift,0),en=(0,r.getBubbleBonus)(o,"BRITTLEY_SPEARS",!1,"strength"===p),eo=(0,r.getBubbleBonus)(o,"BOW_JACK",!1,"agility"===p),er=(0,r.getBubbleBonus)(o,"MATTY_STAFFORD",!1,"wisdom"===p),ei="strength"===p||"luck"===p?(0,r.getBubbleBonus)(o,"POWER_TRIONE",!1,"strength"===p):0,el="agility"===p?(0,r.getBubbleBonus)(o,"POWER_TRITWO",!1,"agility"===p):0,eu="wisdom"===p?(0,r.getBubbleBonus)(o,"POWER_TRITHREE",!1,"wisdom"===p):0,ec=o?.towers?.totalLevels>=C.constructionMasteryThresholds?.[2]?2*Math.floor((o?.towers?.totalLevels-C.constructionMasteryThresholds?.[2])/10):0,ed=(0,t.getTalentBonus)(e?.flatTalents,"GILDED_SWORD"),eg=(0,E.getSaltLickBonus)(o?.saltLick,9),ep=(0,i.getStatsFromGear)(e,45,o),em=(0,l.getObolsBonus)(e?.obols,c.bonuses?.etcBonuses?.[45]),ef=(0,S.getPrayerBonusAndCurse)(e?.activePrayers,"Beefy_For_Real",o)?.bonus,eB=(0,S.getPrayerBonusAndCurse)(e?.activePrayers,"Balance_of_Precision",o)?.curse,eh=(0,S.getPrayerBonusAndCurse)(e?.activePrayers,"Fibers_of_Absence",o)?.curse,ey=(0,T.getLabBonus)(o?.lab?.labBonuses,0),eS=(0,T.getLabBonus)(o?.lab?.labBonuses,11),eT=(0,T.getLabBonus)(o?.lab.labBonuses,8),ev=o?.lab.jewels?.slice(7,10)?.every(({active:e})=>e)?2:1,e_=(0,T.getJewelBonus)(o?.lab.jewels,10,eT)*ev,eb=e?.cards?.cardSet?.rawName==="CardSet26"?e?.cards?.cardSet?.bonus:0,eA=(0,n.getCardBonusByEffect)(e?.cards?.equippedCards,"Total_Damage"),eM=o?.accountOptions?.[89],eI=c.randomList?.[53],eC=+(0,d.isArenaBonusActive)(eM,eI,2),eE=+(0,d.isArenaBonusActive)(eM,eI,15),eO=(0,T.getPlayerLabChipBonus)(e,o,12),eP=(0,v.getMealsBonusByEffectOrStat)(o,null,"TotDmg"),ex=(0,t.getTalentBonus)(e?.flatTalents,"CURSE_OF_MR_LOOTY_BOOTY"),ew=(0,t.getTalentBonusIfActive)(e?.activeBuffs,"BALANCED_SPIRIT"),eL=(0,P.getGodBlessingBonus)(o?.divinity?.deities,"Flutterbis"),eR=(0,P.getGodBlessingBonus)(o?.divinity?.deities,"Kattlecruk"),eD=L*(1+R/100)*(1+D/100)*(1+(k+(N+(Math.max(0,G-10)*F+Math.floor(Math.max(0,e?.level-200)/50)*H)))/100)*(1+(U+(j+(W+q)+V)+(J+(ee+(et+ea))))/100)*(1+(es+en+(eo+(er+(z+(Z+(ei*Math.floor(Math.max(m,w)/250)+el*Math.floor(f/250)+(eu*Math.floor(B/250)+ec)))))))/100)*(1+(ed+(eg+(ep+em+ef))+(ey+(eS+e_)+(Q+X)))/100)*(1+(eA+eb)/100)*(1+(20*eC+40*eE+(eO+eP)+2*(0,O.getAchievementStatus)(o?.achievements,58)+3*(0,O.getAchievementStatus)(o?.achievements,59)+(5*(0,O.getAchievementStatus)(o?.achievements,60)+5*(0,O.getAchievementStatus)(o?.achievements,62))+2*(0,O.getAchievementStatus)(o?.achievements,119)+3*(0,O.getAchievementStatus)(o?.achievements,120)+(5*(0,O.getAchievementStatus)(o?.achievements,121)+2*(0,O.getAchievementStatus)(o?.achievements,185)+3*(0,O.getAchievementStatus)(o?.achievements,186)+(5*(0,O.getAchievementStatus)(o?.achievements,187)+((0,O.getAchievementStatus)(o?.achievements,240)+(0,O.getAchievementStatus)(o?.achievements,280))+3*(0,O.getAchievementStatus)(o?.achievements,297)+2*(0,O.getAchievementStatus)(o?.achievements,303)+(eL+eR))))/100)*Math.max((1-ex/100)*(1-ew/100)*Math.max(.01,1-(eB+eh)/100),.05);return 100<eD?100+Math.max(Math.pow(eD-100,.86),0):eD})(e,o,D,sg);return sg.maxDamage=sT*s_*sb,sg.minDamage=sg.mastery*sg.maxDamage,eA=e,eM=o,eI=D,ax=t.mainStatMap?.[eA?.class],aw=(0,a.getPostOfficeBonus)(eA?.postOffice,"Box_of_Unwanted_Stats",1),aL=eA?.cards?.cardSet?.rawName==="CardSet4"?eA?.cards?.cardSet?.bonus:0,aR=(0,n.getCardBonusByEffect)(eA?.cards?.equippedCards,"Base_Defence"),aD=(0,n.getCardBonusByEffect)(eA?.cards?.equippedCards,"Defence_from_Equipment"),ak=(0,r.getBubbleBonus)(eI,"FMJ",!1,"strength"===ax),aN=(0,B.getStampsBonusByEffect)(eI,"Base_Defence"),aG=(0,i.getStatsFromGear)(eA,"Defence",eI,!0),aF=(0,i.getStatsFromGear)(eA,"Defence",eI),aH=(0,l.getObolsBonus)(eA?.obols,"Defence"),aU=(0,i.getStatsFromGear)(eA,50,eI),aj=(0,l.getObolsBonus)(eA?.obols,c.bonuses?.etcBonuses?.[50]),aW=(0,i.getStatsFromGear)(eA,7,eI),aq=(0,l.getObolsBonus)(eA?.obols,c.bonuses?.etcBonuses?.[7]),a$=(0,p.getArcadeBonus)(eI?.arcade?.shop,"Base_Defence")?.bonus??0,aK=(0,f.getStatueBonus)(eI,7,eA?.flatTalents),aV=(0,v.getMealsBonusByEffectOrStat)(eI,null,"Def"),aY=(0,t.getTalentBonus)(eA?.flatTalents,"BRICKY_SKIN",!0),aJ=(0,t.getTalentBonus)(eA?.flatTalents,"BUCKLERED_UP"),az=(0,y.getShrineBonus)(eI?.shrines,1,eA?.mapIndex,eI?.cards,eI?.sailing?.artifacts),aZ=eI?.bribes?.[22]?.done?eI?.bribes?.[22]?.value:0,aQ=(0,S.getPrayerBonusAndCurse)(eA?.activePrayers,"Beefy_For_Real",eI)?.curse,aX=(0,S.getPrayerBonusAndCurse)(eA?.activePrayers,"Balance_of_Pain",eI)?.curse,a0=(0,d.getGoldenFoodBonus)("Golden_Meat_Pie",eA,eI,eM),a1=(0,g.getStarSignBonus)(eA,eI,"Defence"),a2=(0,t.getTalentBonusIfActive)(eA?.activeBuffs,"BALANCED_SPIRIT"),a5=(0,s.getDungeonFlurboStatBonus)(eI?.dungeons?.upgrades,"Defence"),a3=(0,T.getPlayerLabChipBonus)(eA,eI,0),a9=(0,d.isCompanionBonusActive)(eI,0)?(0,P.getMinorDivinityBonus)(eA,eI,0):eA?.linkedDeity===0?eA?.deityMinorBonus:0,sg.defence={value:Math.floor(aw+aR+Math.min(eA?.level,ak)+(aN+(aU+aj)+a$+aK)+((aF+aH+aG)*(1+(ak+aD)/100)+(aV+aY)))*(1+(az+aZ)/100)*Math.max(.05,1-(aQ+aX)/100)*(1+(a0+aJ+(aW+aq+(a1+(a2+(aL+(a5+a3))))))/100)*(1+a9/100),breakdown:[{name:"Post Office",value:aw},{name:"Card Bonus",value:aR+aD},{name:"Cardset Bonus",value:aL},{name:"Flurbo Bonus",value:a5},{name:"Minor Divinity Bonus",value:a9},{name:"Chip Bonus",value:a3},{name:"Bubble Bonus",value:ak},{name:"Stamp Bonus",value:aN},{name:"Equip Base Defence ",value:aU+aj},{name:"Equip Defence",value:aF+aH+aG},{name:"Equip % Defence",value:aW+aq},{name:"Arcade Bonus",value:a$},{name:"Statue Bonus",value:aK},{name:"Meal Bonus",value:aV},{name:"Shrine Bonus",value:az},{name:"Bribe Bonus",value:aZ},{name:"Prayers",value:aQ+aX},{name:"Golden Food",value:a0},{name:"Talents Bonus",value:aY+aJ},{name:"Active Talents Bonus",value:a2}]},sg.survivability=N(e,o,D,sg),sg.killsPerHour=R(e,o,D,sg),sg.survivabilityMath=sg.killsPerHour*sg.afkGains*(sg.survivability/100),sg.survivability=N(e,o,D,sg),sg.killsPerHour=R(e,o,D,sg),eC=e,eE=o,eO=D,eP=sg,a8=(0,i.getStatsFromGear)(eC,68,eO),a4=(0,i.getStatsFromGear)(eC,69,eO),a6=(0,i.getStatsFromGear)(eC,70,eO),a7=c.monsters?.[eC?.targetMonster],se=k(a7?.MonsterHPTotal,eC,eO),st=eP?.maxDamage>=2*se&&.5<eO?.towers?.towersTwo?eP?.accuracy>1.5*a7?.Defence:0,sa=(0,T.getLabBonus)(eO?.lab?.labBonuses,4),ss=0,100<=eC?.mapIndex&&150>eC?.mapIndex?ss=a8:150<=eC?.mapIndex&&200>eC?.mapIndex?ss=a4:50<=eC?.mapIndex&&100>eC?.mapIndex&&(ss=a6),sn=(0,d.isCompanionBonusActive)(eO,0)||eC?.linkedDeity===2||eC?.secondLinkedDeityIndex===2?1:0,so=(0,t.getTalentBonus)(eC?.flatTalents,"CHARRED_SKULLS"),sr=(0,t.getTalentBonus)(eC?.flatTalents,"STACKED_SKULLS"),si=(0,t.getTalentBonus)(eC?.flatTalents,"MEMORIAL_SKULLS"),sl=(0,t.getTalentBonus)(eC?.flatTalents,"MONSTER_DECIMATOR"),su=F(eC,eE,eO,eP),sc=(0,r.getActiveBubbleBonus)(eC?.equippedBubbles,"KILL_PER_KILL",eO),sd=(0,S.getPrayerBonusAndCurse)(eC?.activePrayers,"Fibers_of_Absence",eO)?.bonus,sg.killPerkill=st?Math.max(1,sa)*(1+ss/100)*Math.max(1,1+sn)*(1+(so*(eC?.stats?.strength/1e3)+(sr*(eC?.stats?.agility/1e3)+(si*(eC?.stats?.wisdom/1e3)+sl))+(su+(sc+sd)))/100):Math.max(1,sa)*(1+ss/100)*Math.max(1,1+sn)*(1+(so*(eC?.stats?.strength/1e3)+(sr*(eC?.stats?.agility/1e3)+(si*(eC?.stats?.wisdom/1e3)+sl))+(sc+sd))/100),sg.finalKillsPerHour=Math.floor(sg.killsPerHour*sg.afkGains*(sg.survivability/100)*sg.killPerkill),sg},"notateDamage",0,e=>{let t=[];return 9999999>e.maxDamage?t.push(Math.ceil(e.minDamage)+"~"+Math.ceil(e.maxDamage)):0x3b9ac9ff>e.maxDamage?t.push(Math.ceil(e.minDamage/1e3)/1e3+"[~"+Math.ceil(e.maxDamage/1e3)/1e3+"["):0x9184e729fff>e.maxDamage?t.push(Math.ceil(e.minDamage/1e5)/10+"[~"+Math.ceil(e.maxDamage/1e5)/10+"["):t.push(Math.ceil(e.minDamage/1e9)/1e3+"!~"+Math.ceil(e.maxDamage/1e9)/1e3+"!"),t}])},736094,e=>{"use strict";e.i(350461);var t=e.i(608580),a=e.i(931),s=e.i(478627),n=e.i(24174),o=e.i(21294),o=o;let r="https://profiles.idleontoolbox.workers.dev/api",i=async({profile:e,leaderboardConsent:t},a)=>{try{let s=g(e),n=await fetch(`${r}/profiles`,{method:"POST",body:JSON.stringify({profile:s,leaderboardConsent:t}),headers:{"Content-Type":"application/json",Authorization:a}});if(n?.status!==200)throw n;return n}catch(e){if(console.error("Error has occurred: ",e),e?.status===429)throw"You have uploaded your profile in the past 4 hours. Please wait until the cooldown is over.";throw e?.status===500||e?.status,"An error has occurred while uploading your profile. Please try again later."}},l=async({mainChar:e})=>{try{let t=await fetch(`${r}/profiles/?profile=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t)return null;return await t?.json()}catch(t){throw console.error(`/ROOT/services/profiles.js -> Error has occurred while getting profile for ${e}`),t}},u=async e=>{try{let t=await fetch(`${r}/leaderboards?leaderboard=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t)return null;return await t?.json()}catch(e){throw console.error("/ROOT/services/profiles.js -> Error has occurred while getting leaderboards"),e}},c=async(e,t)=>{try{let a=await fetch(`${r}/leaderboards?leaderboard=${e}&leaderboardUser=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a)return null;return await a?.json()}catch(e){throw console.error("/ROOT/services/profiles.js -> Error has occurred while getting leaderboards"),e}},d=(e,t=0)=>isNaN(e)?t:e,g=e=>{let a=Object.entries(e.data).reduce((e,[a,s])=>(e[a]=(0,t.tryToParse)(s),e),{});return{...e,data:a}};e.s(["expandLeaderboardInfo",0,(e,t)=>{let r=Math.max(...t.map(s=>(0,a.getDropRate)(s,e,t)?.dropRate||0)),i=Math.max(...t.map(s=>(0,a.getCashMulti)(s,e,t)?.cashMulti||0)),l=t.map(a=>(0,s.getMaxDamage)(a,t,e)),u=Math.max(...l.map(({defence:e})=>e?.value)),c=Math.max(...l.map(({accuracy:e})=>e)),g=Math.max(...l.map(({maxHp:e})=>e)),p=Math.max(...l.map(({maxMp:e})=>e)),m=e?.deathNote?.[0]?.mobs?.[0]?.kills||0,f=(0,n.calcTotalBoatLevels)(e?.sailing?.boats),B=e?.tome?.totalPoints,h=e?.gaming?.logBook?.reduce((e,{unlocked:t})=>e+t,0),y=e?.hole?.villagers?.map(({expRate:e})=>e.value)?.filter(e=>e>0),S=y?.length>0?Math.max(...y):0;return{dropRate:Math.max(r,d(e.accountOptions?.[200])),defence:d(u),accuracy:d(c),hp:d(g),mp:d(p),logBook:h,totalShinyLevels:d(e?.breeding?.totalShinyLevels),totalBreedabilityLevels:d(e?.breeding?.totalBreedabilityLv),slab:d(e?.looty?.lootedItems,0),greenMushroomKills:m,totalBoats:f,totalTomePoints:d(B,0),highestVillagerExpPerHour:S,topKilledMonsters:e?.topKilledMonsters,accountAge:(0,o.default)(new Date,new Date(e?.accountCreateTime)),currentWorld:e?.currentWorld,cashMulti:d(i)}},"fetchLeaderboard",0,u,"fetchUserLeaderboards",0,c,"getProfile",0,l,"uploadProfile",0,i],736094)},985978,e=>{"use strict";e.s(["AppContext",()=>d,"default",()=>p]);var t=e.i(391398),a=e.i(191788),s=e.i(153712),n=e.i(94995),o=e.i(203828),r=e.i(46300),i=e.i(571853),l=e.i(575982),u=e.i(750935),c=e.i(736094);let d=(0,a.createContext)({});function g(e,t){let a={login:()=>({...e,...t.data}),data:()=>({...e,...t.data}),logout:()=>({characters:null,account:null,signedIn:!1,emailPassword:null,appleLogin:null}),displayedCharacters:()=>({...e,displayedCharacters:t.data}),filters:()=>({...e,filters:t.data}),pinnedPages:()=>({...e,pinnedPages:t.data}),planner:()=>({...e,planner:t.data}),trackers:()=>({...e,trackers:t.data}),godPlanner:()=>({...e,godPlanner:t.data}),loginError:()=>({...e,loginError:t.data}),showRankOneOnly:()=>({...e,showRankOneOnly:t.data}),showUnmaxedBoxesOnly:()=>({...e,showUnmaxedBoxesOnly:t.data}),setLoading:()=>({...e,isLoading:t.data})}[t.type];if(!a)throw Error(`Unhandled action type: ${t.type}`);return a()}let p=({children:p})=>{let[m,f]=(0,a.useReducer)(g,{},function(){let e=["filters","pinnedPages","displayedCharacters","trackers","godPlanner","manualImport","lastUpdated","planner"].reduce((e,t)=>{try{let a=localStorage.getItem(t);a&&(e[t]=JSON.parse(a))}catch(e){console.warn(`Failed to parse ${t} from localStorage:`,e)}return e},{});return e.pinnedPages||(e.pinnedPages=[]),{showRankOneOnly:!1,showUnmaxedBoxesOnly:!1,isLoading:!0,...e}}),B=(0,a.useMemo)(()=>({state:m,dispatch:f}),[m,f]),h=(0,o.useRouter)(),[y,S]=(0,a.useState)(0),[T,v]=(0,a.useState)(!1),_=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!h.isReady)return;let t=async()=>{try{let t,a=await (0,c.getProfile)({mainChar:h?.query?.profile});if(!a)throw Error("Failed to load data from profile api");let{parseData:n}=await e.A(730819);if(Object.keys(a).includes("serverVars")){let{data:e,charNames:s,companion:o,guildData:r,serverVars:i,lastUpdated:l,accountCreateTime:u}=a;t=n(e,s,o,r,i,u);let c=l||new Date().getTime();t={...t,lastUpdated:c},localStorage.setItem("rawJson",JSON.stringify({data:e,charNames:s,guildData:r,serverVars:i,lastUpdated:c}))}else t=n(a);localStorage.setItem("manualImport","false");let o=t?.lastUpdated||new Date().getTime(),r=await (0,s.checkUserStatus)();f({type:"data",data:{...t,profile:!0,manualImport:!1,signedIn:!!r,lastUpdated:o,isLoading:!1}})}catch(e){console.error("Failed to load data from profile api",e),h.push({pathname:"/",query:h.query}),f({type:"data",data:{isLoading:!1}})}},a=async()=>{let{data:t,charNames:a,companion:s,guildData:o,serverVars:r,lastUpdated:i}=n.default,{parseData:l}=await e.A(730819),u=i||new Date().getTime();f({type:"data",data:{...l(t,a,s,o,r),lastUpdated:u,demo:!0,isLoading:!1}})},o=async()=>{try{let e=await (0,s.checkUserStatus)();!m?.account&&e?_.current=await (0,s.subscribe)(e?.uid,e?.accessToken,A):("/"===h.pathname||M()||"/data"===h.pathname||"/statistics"===h.pathname||"/leaderboards"===h.pathname||h.push({pathname:"/",query:h?.query}),f({type:"setLoading",data:!1}))}catch(e){console.error(e),f({type:"setLoading",data:!1}),b()}};return(async()=>{h?.query?.profile?await t():h?.query?.demo?await a():m?.signedIn?f({type:"setLoading",data:!1}):await o()})(),()=>{_.current&&_.current()}},[]),(0,a.useEffect)(()=>{if(m?.filters&&localStorage.setItem("filters",JSON.stringify(m.filters)),m?.pinnedPages&&localStorage.setItem("pinnedPages",JSON.stringify(m.pinnedPages)),m?.displayedCharacters&&localStorage.setItem("displayedCharacters",JSON.stringify(m.displayedCharacters)),m?.planner&&localStorage.setItem("planner",JSON.stringify(m.planner)),m?.trackers&&localStorage.setItem("trackers",JSON.stringify(m.trackers)),m?.godPlanner&&localStorage.setItem("godPlanner",JSON.stringify(m.godPlanner)),m?.manualImport){localStorage.setItem("manualImport",JSON.stringify(m.manualImport));let e=JSON.parse(localStorage.getItem("lastUpdated"));m?.signedIn&&b(!0,{...m,lastUpdated:e,signedIn:!1,manualImport:!0})}},[m?.trackers,m?.pinnedPages,m?.filters,m?.displayedCharacters,m?.planner,m?.manualImport,m?.godPlanner]),(0,a.useEffect)(()=>{T||0===y||S(0)},[T]),(0,r.default)(async()=>{try{let e,t,a;if(m?.signedIn)return;if(m?.loginType==="steam"){let n=await (0,s.signInWithCustom)(m?.loginData?.token,f);a=n?.accessToken,e=n?.accessToken,t=n?.uid}else if(m?.loginType==="email")e=m?.loginData?.accessToken,t=m?.loginData?.uid,a=e;else{if(m?.loginType==="apple"){let t=await (0,u.geAppleStatus)(m?.loginData);t?.id_token&&(e=t)}else{let t=await (0,i.getUserToken)(m?.loginData?.deviceCode)||{};e=t?.id_token}if(e){let a=await (0,s.signInWithToken)(e,m?.loginType);t=a?.uid}}e?(_.current=await (0,s.subscribe)(t,a||e?.id_token,A),void 0!==window?.gtag&&window?.gtag("event","login",{action:"login",category:"engagement",value:m?.emailPasswordLogin?"email-password":m?.appleLogin?"apple":"google"}),v(!1),S(0)):y>12&&(v(!1),f({type:"loginError",data:"Reached maximum retry limit, please re-open this dialog"})),S(e=>e+1)}catch(e){console.error("Error: ",e?.stack),f({type:"loginError",data:e?.stack})}},T?0===y?1e3:4e3:null);let b=(e,t)=>{_.current&&_.current(),(0,s.userSignOut)(),void 0!==window?.gtag&&window?.gtag("event","logout",{action:"logout",category:"engagement",value:1}),localStorage.removeItem("charactersData"),localStorage.removeItem("rawJson"),f({type:"logout"}),v(!1),e?f({type:"data",data:t}):h.push({pathname:"/",query:h.query})},A=async(t,a,s,n,o,r,i,l)=>{if(h?.query?.profile){let{profile:e,...t}=h.query;h.replace({query:t})}let u=r?.seconds,c=new Date().getTime();localStorage.setItem("rawJson",JSON.stringify({data:t,charNames:a,companion:s,guildData:n,serverVars:o,accountCreateTime:1e3*u,lastUpdated:c}));let{parseData:d}=await e.A(730819),g=d(t,a,s,n,o,1e3*u);localStorage.setItem("manualImport",JSON.stringify(!1)),f({type:"data",data:{...g,signedIn:!0,manualImport:!1,profile:!1,lastUpdated:c,serverVars:o,uid:i,accessToken:l,accountCreateTime:1e3*u,isLoading:!1}}),g=null},M=()=>{if(!h.pathname.includes("tools"))return!1;let e=h.pathname.split("/")?.[2]||"",t=e?.replace("-"," ")?.toCamelCase();return!m?.signedIn&&h.pathname.includes("tools")&&l.offlineTools[t]};return(0,t.jsx)(d.Provider,{value:{...B,logout:b,waitingForAuth:T,setWaitingForAuth:v},children:p})}}]);
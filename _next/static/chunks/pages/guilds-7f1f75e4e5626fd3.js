(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[961],{30045:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guilds",function(){return s(41002)}])},41002:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return guilds}});var l=s(85893),i=s(67294),r=s(6875),t=s(23972),d=s(51233),o=s(98456),a=s(72882),c=s(55113),u=s(7906),h=s(53184),x=s(53816),j=s(53252),m=s(295),Z=s(81458),p=s(57922),g=s(2962),v=s(30925),b=s(93946),f=s(88169),w=(0,f.Z)((0,l.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),y=s(85578),S=(0,f.Z)((0,l.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp"),C=s(27709),G=s(40929),I=s(61436),_=(0,f.Z)((0,l.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),N=s(2511),T=s(64605),guilds=()=>{let[e,n]=(0,i.useState)({func:null}),[s,f]=(0,i.useState)(null),[E,L]=(0,i.useState)(null),k=(0,v.tryToParse)(sessionStorage.getItem("snapshotDate")),[z,D]=(0,i.useState)(""),M=(0,i.useCallback)(e=>{var n;return null==e?void 0:null===(n=e.slice(0,100))||void 0===n?void 0:n.map(e=>{var n,s,l,i,r;let t=null==e?void 0:null===(n=e.members)||void 0===n?void 0:n.find(e=>{let{g:n}=e;return 0===n}),d=null==e?void 0:null===(i=e.members)||void 0===i?void 0:null===(l=i.sort((e,n)=>(null==n?void 0:n.e)-(null==e?void 0:e.e)))||void 0===l?void 0:null===(s=l.slice(0,5))||void 0===s?void 0:s.map(e=>{let{a:n,e:s}=e;return{name:n,gpEarned:s}});return{guildIcon:null==e?void 0:e.guildIcon,guildName:null==e?void 0:e.guildName,totalGp:null==e?void 0:e.totalGp,membersCount:null==e?void 0:null===(r=e.members)||void 0===r?void 0:r.length,leader:t,topContributors:d}})},[]),handleGuildsUpdate=e=>{let{guilds:n,error:s}=e;if(s)return D("An unexpected error has occurred");let l=M(n);sessionStorage.setItem("guildsLeaderboard",JSON.stringify(l)),sessionStorage.setItem("snapshotDate",new Date().getTime()),f(l)},subscribe=async()=>{let e=(0,r.n6)(handleGuildsUpdate);n({func:e})};return(0,i.useEffect)(()=>{let n=(0,v.getDuration)(new Date,k);return(null==n?void 0:n.days)>0||(null==n?void 0:n.hours)>0||(null==n?void 0:n.minutes)>=15||!k?setTimeout(()=>subscribe(),3e3):f((0,v.tryToParse)(sessionStorage.getItem("guildsLeaderboard"))),()=>{e&&"function"==typeof(null==e?void 0:e.func)&&(null==e||e.func())}},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.PB,{title:"Guilds | Idleon Toolbox",description:"Top guilds in idleon"}),(0,l.jsx)(t.Z,{variant:"h2",children:"Guilds Leaderboard"}),(0,l.jsxs)(d.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,l.jsxs)(d.Z,{gap:2,direction:"row",children:["Last Updated: ",s?(0,I.Z)(k)?(0,G.Z)(k,"dd/MM/yyyy HH:mm:ss"):null:(0,l.jsx)(o.Z,{size:"22px",disableShrink:!0})]}),(0,l.jsx)(N.Z,{title:"Reload guild data",children:(0,l.jsx)("span",{children:(0,l.jsx)(b.Z,{disabled:!s,onClick:()=>{if(!s)return null;f(null),sessionStorage.removeItem("guildsLeaderboard"),sessionStorage.removeItem("snapshotDate"),subscribe()},children:(0,l.jsx)(_,{})})})})]}),(0,l.jsx)(t.Z,{variant:"caption",component:"div",sx:{mb:2},children:"* Updates every 15 minutes"}),(0,l.jsx)(a.Z,{component:c.Z,children:(0,l.jsxs)(u.Z,{size:"small",children:[(0,l.jsx)(h.Z,{children:(0,l.jsxs)(x.Z,{children:[(0,l.jsx)(j.Z,{sx:{width:"1px"}}),(0,l.jsx)(j.Z,{sx:{width:30}}),(0,l.jsx)(j.Z,{children:"Guild Name"}),(0,l.jsx)(j.Z,{children:"Guild Points"}),(0,l.jsx)(j.Z,{children:"Guild Leader"}),(0,l.jsx)(j.Z,{children:"Guild Level"}),(0,l.jsx)(j.Z,{children:"Members Count"})]})}),(0,l.jsxs)(m.Z,{children:[s||z?null:(0,l.jsx)(x.Z,{children:(0,l.jsx)(j.Z,{colSpan:7,align:"center",children:(0,l.jsxs)(d.Z,{alignItems:"center",gap:2,children:[(0,l.jsx)(t.Z,{children:"Gathering guild info"}),(0,l.jsx)(Z.Z,{sx:{width:300}})]})})}),z?(0,l.jsx)(x.Z,{children:(0,l.jsx)(j.Z,{colSpan:7,align:"center",children:(0,l.jsxs)(d.Z,{sx:{my:3},direction:"row",alignItems:"center",justifyContent:"center",gap:2,children:[(0,l.jsx)(w,{}),(0,l.jsx)(t.Z,{variant:"h6",children:z})]})})}):null,null==s?void 0:s.map((e,n)=>{let{totalGp:s,leader:r,membersCount:o,guildIcon:a,guildName:c,topContributors:Z}=e,g=(0,T.J2)(s);return(0,l.jsxs)(i.Fragment,{children:[(0,l.jsxs)(x.Z,{sx:{"& > *":{borderBottom:"unset"}},children:[(0,l.jsx)(j.Z,{sx:{p:"4px"},children:(0,l.jsx)(b.Z,{"aria-label":"expand row",size:"small",onClick:()=>L(E===n?null:n),children:E===n?(0,l.jsx)(S,{}):(0,l.jsx)(y.Z,{})})}),(0,l.jsx)(j.Z,{sx:{p:1,textAlign:"center"},children:n+1}),(0,l.jsx)(j.Z,{children:(0,l.jsxs)(d.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,l.jsx)("img",{src:"".concat(v.prefix,"data/G2icon").concat(a,".png"),style:{width:24},alt:"guild-icon"}),(0,l.jsx)(t.Z,{children:c})]})}),(0,l.jsx)(j.Z,{children:(0,v.numberWithCommas)(s)}),(0,l.jsx)(j.Z,{children:null==r?void 0:r.a}),(0,l.jsx)(j.Z,{children:g}),(0,l.jsxs)(j.Z,{children:[o," / ",30+4*g]})]}),(0,l.jsx)(x.Z,{sx:{"& > *":{borderBottom:"unset"}},children:(0,l.jsx)(j.Z,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:(0,l.jsx)(p.Z,{in:E===n,timeout:"auto",unmountOnExit:!0,children:(0,l.jsxs)(C.Z,{sx:{p:1},children:[(0,l.jsx)(t.Z,{variant:"h6",sx:{mb:1},children:"Top Contributors"}),(0,l.jsxs)(u.Z,{size:"small",sx:{width:300},children:[(0,l.jsx)(h.Z,{children:(0,l.jsxs)(x.Z,{children:[(0,l.jsx)(j.Z,{children:"Name"}),(0,l.jsx)(j.Z,{children:"Gp"})]})}),(0,l.jsx)(m.Z,{children:null==Z?void 0:Z.map(e=>{let{name:n,gpEarned:s}=e;return(0,l.jsxs)(x.Z,{children:[(0,l.jsx)(j.Z,{children:n}),(0,l.jsx)(j.Z,{children:(0,v.numberWithCommas)(s)})]},"top-3-".concat(n))})})]})]})})})})]},"row"+n)})]})]})})]})}}},function(e){e.O(0,[2307,9774,2888,179],function(){return e(e.s=30045)}),_N_E=e.O()}]);
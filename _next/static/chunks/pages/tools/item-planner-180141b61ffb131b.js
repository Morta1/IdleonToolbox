(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2731],{65600:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tools/item-planner",function(){return n(39818)}])},39818:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return item_planner}});var l=n(82729),i=n(85893),a=n(67294),o=n(70473),r=n(21785),s=n(23972),d=n(51233),c=n(50135),u=n(87109),m=n(94054),p=n(40476),v=n(72890),x=n(50480),h=n(36872),j=n(67358),y=n(38895),g=n(22797),f=n(417),Z=n(49425),b=n(50657),w=n(37645),N=n(6514),I=n(58951),_=n(31425),C=n(69368),O=n(21480),Q=n(30925),k=n(83321),S=n(88344),T=n(93946),A=n(23508),E=n(94895),F=n(34282),M=n(96540),P=n(8364),W=n(61599),q=n(2511),D=n(66242),R=n(44267);function _templateObject(){let e=(0,l._)(["\n  width: 40px;\n"]);return _templateObject=function(){return e},e}let z=W.Z.img(_templateObject()),OwnerTooltip=e=>{let{itemName:t,owners:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Z,{fontWeight:"bold",variant:"h5",children:(0,Q.cleanUnderscore)(t)}),(0,i.jsx)(d.Z,{children:(0,i.jsx)(d.Z,{direction:"row",children:(null==n?void 0:n.length)>0?null==n?void 0:n.map((e,t)=>(0,i.jsx)("div",{children:(0,i.jsxs)(s.Z,{children:[e,"\xa0"]})},t+""+e)):(0,i.jsx)(s.Z,{children:"None"})})})]})};var item_planner_ItemsList=e=>{var t;let{account:n,inventoryItems:l,itemsList:r=[],copies:c=1,itemDisplay:u}=e,mapItems=(e,t)=>null==e?void 0:e.reduce((e,i)=>{var a,r,s;let d,c;if((null==i?void 0:i.itemName)==="Dungeon_Credits_Flurbo_Edition")d=null!==(r=null==n?void 0:null===(a=n.dungeons)||void 0===a?void 0:a.flurbos)&&void 0!==r?r:0,c=["account"];else{let e=(0,S.AN)(l,null==i?void 0:i.itemName);d=null==e?void 0:e.amount,c=null==e?void 0:e.owner}if("0"===t){let t=(null==i?void 0:i.itemQuantity)-d;if((null==i?void 0:i.type)==="Equip"&&t!==(null==i?void 0:i.itemQuantity)){let n=null===(s=(0,S.F6)(o.crafts[null==i?void 0:i.itemName]))||void 0===s?void 0:s.map(e=>{let{amount:n,owner:i}=(0,S.AN)(l,null==e?void 0:e.itemName);return{...e,baseQuantity:null==e?void 0:e.itemQuantity,itemQuantity:(null==e?void 0:e.itemQuantity)*t,quantityOwned:n,owner:i}});return n.forEach(n=>{var l,i;let a=null==e?void 0:null===(l=e[null==n?void 0:n.subType])||void 0===l?void 0:l.find(e=>(null==e?void 0:e.itemName)===(null==n?void 0:n.itemName)),o=null==e?void 0:null===(i=e[null==n?void 0:n.subType])||void 0===i?void 0:i.filter(e=>(null==e?void 0:e.itemName)!==(null==n?void 0:n.itemName));a&&t>0&&(null==a?void 0:a.itemQuantity)-d>(null==a?void 0:a.quantityOwned)&&(o=[...o||[],{...a,itemQuantity:(null==a?void 0:a.itemQuantity)-d}]),e={...e,[null==n?void 0:n.subType]:o}}),t>0&&(e={...e,[null==i?void 0:i.subType]:[...(null==e?void 0:e[null==i?void 0:i.subType])||[],{...i,quantityOwned:0,owner:c,itemQuantity:t}]}),e}return d>=(null==i?void 0:i.itemQuantity)?e:{...e,[null==i?void 0:i.subType]:[...(null==e?void 0:e[null==i?void 0:i.subType])||[],{...i,owner:c,quantityOwned:d}]}}return"1"!==t?e:{...e,[null==i?void 0:i.subType]:[...(null==e?void 0:e[null==i?void 0:i.subType])||[],{...i,quantityOwned:d,owner:c}]}},{}),m=(0,a.useMemo)(()=>mapItems(r,u),[r,u,l,n]);return(0,i.jsx)(d.Z,{flexWrap:"wrap",direction:"row",gap:4,children:null===(t=Object.entries(m))||void 0===t?void 0:t.map((e,t)=>{let[n,l]=e,a="0"!==u||(null==l?void 0:l.length)>0;return a?(0,i.jsx)(D.Z,{variant:"outlined",children:(0,i.jsxs)(R.Z,{children:[(0,i.jsx)("span",{className:"title",children:(0,Q.cleanUnderscore)((0,Q.pascalCase)(n))}),(0,i.jsx)(d.Z,{flexWrap:"wrap",direction:"row",gap:3,children:null==l?void 0:l.map((e,t)=>{let{itemName:n,itemQuantity:l,rawName:a,type:o,quantityOwned:r,owner:m}=e;return(0,i.jsxs)(d.Z,{gap:1,alignItems:"center",children:[(0,i.jsx)(q.Z,{title:(0,i.jsx)(OwnerTooltip,{itemName:n,owners:m}),children:(0,i.jsx)(z,{src:"".concat(Q.prefix,"data/").concat(a,".png"),alt:""})}),(0,i.jsxs)(d.Z,{direction:"row",children:[(0,i.jsx)(q.Z,{title:r>=1e3?(0,Q.numberWithCommas)(r):"",children:(0,i.jsx)(s.Z,{color:r>=("0"===u?parseInt(l):parseInt(l)*c)?"success.light":"",children:(0,Q.notateNumber)(r)})}),(0,i.jsx)(q.Z,{title:l>=1e3?(0,Q.numberWithCommas)(l):"",children:(0,i.jsxs)(s.Z,{color:r>=("0"===u?parseInt(l):parseInt(l)*c)?"success.light":"",children:["/","0"===u?(0,Q.notateNumber)(parseInt(l)):(0,Q.notateNumber)(parseInt(l)*c,2)]})})]})]},n+""+t)})})]})},n+""+t):null})})},L=n(2962),U=n(14689),X=n(73397);function item_planner_templateObject(){let e=(0,l._)(["\n  width: 50px;\n"]);return item_planner_templateObject=function(){return e},e}function _templateObject1(){let e=(0,l._)(["\n  .item-wrapper {\n    width: 105px;\n    height: 102px;\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .title {\n    font-size: 20px;\n    font-weight: bold;\n    display: inline-block;\n    margin-bottom: 10px;\n  }\n\n  .preview {\n    min-height: 77px;\n    min-width: 77px;\n  }\n\n  .controls {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    flex-wrap: wrap;\n    @media (max-width: 800px) {\n      padding: 10px;\n    }\n  }\n\n  .items-wrapper {\n    margin-top: 15px;\n\n    .items {\n      margin-top: 10px;\n      display: flex;\n      flex-wrap: wrap;\n      gap: 15px;\n    }\n  }\n\n  .content {\n    margin-top: 25px;\n    display: grid;\n    grid-template-columns: 1fr 3fr;\n    column-gap: 50px;\n  }\n\n  .crafts-container {\n    margin-top: 15px;\n  }\n"]);return _templateObject1=function(){return e},e}function _templateObject2(){let e=(0,l._)(["\n  ","\n  && label.Mui-focused {\n    color: rgba(255, 255, 255, 0.7);\n  }\n"]);return _templateObject2=function(){return e},e}function _templateObject3(){let e=(0,l._)(["\n  && {\n    color: white;\n  }\n"]);return _templateObject3=function(){return e},e}let B=(0,r.D)({trim:!0}),V={rawName:"EquipmentTransparent108"},MaterialsTooltip=e=>{let{name:t,items:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Z,{fontWeight:"bold",variant:"h5",children:(0,Q.cleanUnderscore)(t)}),(0,i.jsx)(d.Z,{direction:"row",gap:1,flexWrap:"wrap",children:null==n?void 0:n.map((e,t)=>{let{rawName:n,itemQuantity:l}=e;return(0,i.jsxs)(d.Z,{alignItems:"center",children:[(0,i.jsx)(G,{src:"".concat(Q.prefix,"data/").concat(n,".png"),alt:""}),(0,i.jsx)(s.Z,{children:l})]},n+""+t)})})]})},G=W.Z.img(item_planner_templateObject()),H=W.Z.div(_templateObject1()),J=(0,W.Z)(c.Z)(_templateObject2(),e=>{let{width:t}=e;return t?"width:".concat(t,";"):""}),K=(0,W.Z)(C.Z)(_templateObject3());var item_planner=e=>{var t,n;let{}=e,{state:l,lastUpdated:r,dispatch:C}=(0,a.useContext)(O.I),{planner:W={sections:[]}}=l,[D]=(0,a.useState)(Object.keys(o.crafts)),[R,z]=(0,a.useState)({0:""}),[G,Y]=(0,a.useState)([]),[$,ee]=(0,a.useState)([V]),[et,en]=(0,a.useState)("0"),[el,ei]=(0,a.useState)(!1),[ea,eo]=(0,a.useState)(1),[er,es]=(0,a.useState)({}),[ed,ec]=(0,a.useState)(),eu=(0,a.useMemo)(()=>(0,S.tP)(null==l?void 0:l.characters,el),[el]),em=(0,a.useMemo)(()=>(0,S.Nx)(null==l?void 0:l.characters,null==l?void 0:l.account),[null==l?void 0:l.characters,null==l?void 0:l.account]),ep=(0,a.useRef)(),[ev,ex]=(0,a.useState)({open:!1,type:"",data:null});(0,a.useEffect)(()=>{var e;(null==l?void 0:l.characters)||(null==l?void 0:l.account)?Y(el?[...em||[],...eu||[]]:em):Y(o.itemsArray),ee(null==W?void 0:null===(e=W.sections)||void 0===e?void 0:e.map(()=>V))},[l,r,el]);let handleFileChange=async e=>{let t=e.target.files[0];if(!t||(null==t?void 0:t.type)!=="application/json"){console.error("File isn't a json file");return}let n=await t.text();n&&(null==(n=(0,Q.tryToParse)(n))?void 0:n.sections)&&C({type:"planner",data:{sections:null==n?void 0:n.sections}})},onItemChange=(e,t)=>{let n=$.map((n,l)=>l===t?e?o.crafts[e]:V:n);z({...R,["".concat(t)]:e}),ee(n)},onRemoveItem=(e,t,n,l)=>{var i;let a,r;if((null==t?void 0:t.itemQuantity)===0&&n>0)return;let s=null==W?void 0:null===(i=W.sections)||void 0===i?void 0:i[e],d=o.crafts[null==t?void 0:t.itemName];if(d){a=calculateItemsQuantity(null==s?void 0:s.items,d,!1,!1,n,l);let i=Array.isArray(t)?t:(0,S.F6)(t);r=null==i?void 0:i.reduce((e,t)=>calculateItemsQuantity(e,t,!0,!1,n,l),null==s?void 0:s.materials);let o=updateSectionData(e,{materials:r,items:a,name:null==s?void 0:s.name});C({type:"planner",data:{sections:o}})}},onAddItem=(e,t,n)=>{if((null==t?void 0:t.rawName)!==V.rawName){var l;let i,a;let r=null==W?void 0:null===(l=W.sections)||void 0===l?void 0:l[e];i=calculateItemsQuantity(null==r?void 0:r.items,t,!1,!0,n);let s=Array.isArray(o.crafts[null==t?void 0:t.itemName])?o.crafts[null==t?void 0:t.itemName]:(0,S.F6)(o.crafts[null==t?void 0:t.itemName]);a=null==s?void 0:s.reduce((e,t)=>calculateItemsQuantity(e,t,!0,!0,n),null==r?void 0:r.materials);let d=updateSectionData(e,{materials:a,items:i,name:null==r?void 0:r.name});C({type:"planner",data:{sections:d}}),z({...R,[e]:""}),eo(1)}},updateSectionData=(e,t)=>{var n;return null==W?void 0:null===(n=W.sections)||void 0===n?void 0:n.map((n,l)=>e===l?t:n)},calculateItemsQuantity=function(e,t,n){let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=null==e?void 0:e.find(e=>(null==t?void 0:t.itemName)===(null==e?void 0:e.itemName));return o?null==e?void 0:e.reduce((e,n)=>{if((null==t?void 0:t.itemName)!==(null==n?void 0:n.itemName))return[...e,n];let r=i?i*(null==t?void 0:t.itemQuantity):null==n?void 0:n.itemQuantity;return!l&&(null==o?void 0:o.itemQuantity)-r<=0&&a?e:[...e,{...o,itemQuantity:l?(null==o?void 0:o.itemQuantity)+r:(null==o?void 0:o.itemQuantity)-r,itemCount:parseFloat(i)}]},[]):l?[...e||[],{...t,itemQuantity:(null==t?void 0:t.itemQuantity)*i,itemCount:parseFloat(i)}]:e},removeSection=e=>{ex({open:!0,type:"section",data:e})};return(0,i.jsxs)(H,{children:[(0,i.jsx)(L.PB,{title:"Item Planner | Idleon Toolbox",description:"Useful tool to keep track of your crafting projects by tracking existing and missing materials"}),(null==l?void 0:l.characters)||(null==l?void 0:l.account)?null:(0,i.jsx)(s.Z,{component:"div",sx:{mb:2},variant:"caption",children:"* This tool will work better if you're logged in"}),(0,i.jsxs)(d.Z,{direction:"row",gap:5,flexWrap:"wrap",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(d.Z,{direction:"row",alignItems:"center",children:(0,i.jsx)(c.Z,{sx:{mt:1},label:"Section name",placeholder:"Enter section name",onChange:e=>ec(e.target.value),InputProps:{endAdornment:(0,i.jsx)(u.Z,{position:"end",children:(0,i.jsx)(T.Z,{onClick:()=>{var e;let t=ed||"section-".concat(Math.floor((null==W?void 0:null===(e=W.sections)||void 0===e?void 0:e.length)+1));C({type:"planner",data:{sections:[...(null==W?void 0:W.sections)||[],{items:[],materials:[],name:t}]}})},children:(0,i.jsx)(M.Z,{})})})}})}),(0,i.jsx)(q.Z,{title:"This will reset all sections and items",children:(0,i.jsxs)(k.Z,{sx:{mt:1},onClick:()=>{ex({open:!0,type:"sections",data:null})},children:[(0,i.jsx)(F.Z,{})," Reset all sections"]})})]}),(0,i.jsxs)(d.Z,{sx:{pl:1,mt:1},children:[(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(p.Z,{id:"demo-radio-buttons-group-label",children:"Display"}),(0,i.jsxs)(v.Z,{row:!0,"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"0",name:"radio-buttons-group",onChange:e=>en(e.target.value),children:[(0,i.jsx)(x.Z,{value:"0",control:(0,i.jsx)(h.Z,{}),label:"Show Missing Items"}),(0,i.jsx)(x.Z,{value:"1",control:(0,i.jsx)(h.Z,{}),label:"Show All Items"})]})]}),(0,i.jsx)(x.Z,{control:(0,i.jsx)(K,{checked:el,onChange:()=>ei(!el),name:"Include Equipped Items",color:"default"}),label:"Include Equipped Items"})]}),(0,i.jsxs)(d.Z,{gap:1,sx:{ml:"auto"},alignItems:"center",justifyContent:"center",direction:"row",children:[(0,i.jsx)(q.Z,{title:"Export all sections",children:(0,i.jsxs)(k.Z,{onClick:()=>{var e;let t=localStorage.getItem("planner");t&&(null==W?void 0:null===(e=W.sections)||void 0===e?void 0:e.length)!==0&&(0,Q.downloadFile)(t,"it-item-planner.json")},children:[(0,i.jsx)(U.Z,{sx:{mr:1}}),"Export"]})}),(0,i.jsx)(q.Z,{title:"Import (this will override your sections)",children:(0,i.jsxs)(k.Z,{onClick:()=>{ep.current.click()},children:[(0,i.jsx)(X.Z,{sx:{mr:1}}),"Import"]})}),(0,i.jsx)("input",{type:"file",id:"file",ref:ep,style:{display:"none"},accept:".json",onChange:handleFileChange})]})]}),(0,i.jsx)(d.Z,{sx:{mt:2},children:(null==W?void 0:null===(t=W.sections)||void 0===t?void 0:t.length)>0?null==W?void 0:null===(n=W.sections)||void 0===n?void 0:n.map((e,t)=>{var n;let{items:r,materials:c,name:u}=e;return(0,i.jsxs)(j.Z,{children:[(0,i.jsx)(y.Z,{expandIcon:(0,i.jsx)(A.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,i.jsx)(s.Z,{children:u||"Accordion-".concat(t)})}),(0,i.jsxs)(g.Z,{children:[(0,i.jsxs)(k.Z,{onClick:()=>removeSection(t),children:[(0,i.jsx)(E.Z,{})," Remove Section"]}),(0,i.jsxs)("div",{className:"controls",children:[(0,i.jsx)("div",{className:"preview",children:(null==$?void 0:$[t])?(0,i.jsx)("img",{src:"".concat(Q.prefix,"data/").concat(null==$?void 0:null===(n=$[t])||void 0===n?void 0:n.rawName,".png"),alt:""}):null}),(0,i.jsx)(f.Z,{id:"item-locator",value:null==R?void 0:R[t],onChange:(e,n)=>onItemChange(n,t),autoComplete:!0,options:[null==R?void 0:R[t],...D],filterSelectedOptions:!0,filterOptions:B,getOptionLabel:e=>e?null==e?void 0:e.replace(/_/g," "):"",renderOption:(e,t)=>{var n;return t?(0,i.jsxs)(d.Z,{...e,gap:2,direction:"row",children:[(0,i.jsx)("img",{width:24,height:24,src:"".concat(Q.prefix,"data/").concat(null===o.crafts||void 0===o.crafts?void 0:null===(n=o.crafts[t])||void 0===n?void 0:n.rawName,".png"),alt:""}),null==t?void 0:t.replace(/_/g," ")]}):(0,a.createElement)("span",{...e,style:{height:0},key:"empty"})},style:{width:300},renderInput:e=>(0,i.jsx)(J,{...e,label:"Item Name",variant:"outlined"})}),(0,i.jsx)(J,{value:ea,width:"100px",inputProps:{min:1},onChange:e=>{var t;return eo(null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value)},type:"number",label:"Item Count",variant:"outlined"}),(0,i.jsx)(k.Z,{color:"primary",variant:"contained",onClick:()=>onAddItem(t,null==$?void 0:$[t],ea),title:"Add Item",children:"Add"})]}),(0,i.jsxs)("div",{className:"content",children:[(0,i.jsxs)("div",{className:"items-wrapper",children:[(0,i.jsx)("span",{className:"title",children:"Tracked Items"}),(0,i.jsx)("div",{className:"items",children:null==r?void 0:r.map((e,n)=>(0,i.jsxs)("div",{className:"item-wrapper",onMouseEnter:()=>es({...er,["".concat(t,"-").concat(n)]:!0}),onMouseLeave:()=>es({...er,["".concat(t,"-").concat(n)]:!1}),children:[(0,i.jsx)(Z.Z,{badgeContent:(0,Q.numberWithCommas)(null==e?void 0:e.itemQuantity),max:1e4,anchorOrigin:{vertical:"top",horizontal:"right"},color:"primary",children:(0,i.jsx)(q.Z,{title:(0,i.jsx)(MaterialsTooltip,{name:null==e?void 0:e.itemName,items:(0,S.F6)(e)}),children:(0,i.jsx)("img",{src:"".concat(Q.prefix,"data/").concat(null==e?void 0:e.rawName,".png"),alt:""},(null==e?void 0:e.rawName)+" "+n)})}),(null==er?void 0:er["".concat(t,"-").concat(n)])?(0,i.jsxs)("div",{className:"buttons",children:[(0,i.jsx)(T.Z,{type:"bottom",size:"small",onClick:()=>onAddItem(t,{...e,itemQuantity:1},1),children:(0,i.jsx)(M.Z,{})}),(0,i.jsx)(T.Z,{type:"bottom",size:"small",onClick:()=>onRemoveItem(t,e,1),children:(0,i.jsx)(E.Z,{})}),(0,i.jsx)(T.Z,{size:"small",onClick:()=>onRemoveItem(t,e,null==e?void 0:e.itemQuantity,!0),children:(0,i.jsx)(P.Z,{})})]}):null]},t+""+(null==e?void 0:e.itemName)+n))})]}),(0,i.jsxs)("div",{className:"crafts-container",children:[(0,i.jsx)("span",{className:"title",children:"Required Materials"}),(null==G?void 0:G.length)>0?(0,i.jsx)(item_planner_ItemsList,{itemsList:c,account:null==l?void 0:l.account,inventoryItems:G,itemDisplay:et}):null]})]})]})]},"accordion-".concat(t))}):(0,i.jsx)(s.Z,{sx:{mt:3},variant:"h3",children:"Please add a section"})}),(0,i.jsxs)(b.Z,{open:ev.open,onClose:()=>ex({...ev,open:!1}),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,i.jsx)(w.Z,{id:"alert-dialog-title",children:"Section deletion"}),(0,i.jsx)(N.Z,{children:(0,i.jsx)(I.Z,{id:"alert-dialog-description",children:"section"===ev.type?"Are you sure you would like to delete this section?":"Are you sure you would like to delete all sections?"})}),(0,i.jsxs)(_.Z,{children:[(0,i.jsx)(k.Z,{onClick:()=>ex({...ev,open:!1}),children:"Close"}),(0,i.jsx)(k.Z,{onClick:()=>{if("section"===ev.type){let e=W.sections.filter((e,t)=>t!==ev.data);z({...R,[ev.data]:""}),C({type:"planner",data:{sections:e}})}else"sections"===ev.type&&(z({0:""}),ee([V]),C({type:"planner",data:{sections:[]}}));ex({open:!1,type:"",data:null})},autoFocus:!0,children:"Confirm"})]})]})]})}}},function(e){e.O(0,[417,8356,8471,9774,2888,179],function(){return e(e.s=65600)}),_N_E=e.O()}]);
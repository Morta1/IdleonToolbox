(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,153712,e=>{"use strict";let t,n,i,r,s,o,a,l,h,u,c,d,f,p,g;var m,y,_,v,w,I,C,b=e.i(350461);let E=function(e,t){if(!e)throw T(t)},T=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},S=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},k=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},N={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,u=(3&r)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),i.push(n[h],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(S(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):k(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new R;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class R extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let A=function(e){let t=S(e);return N.encodeByteArray(t,!0)},P=function(e){return A(e).replace(/\./g,"")},x=function(e){try{return N.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},D=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===b.default||void 0===b.default.env)return;let e=b.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&x(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},O=e=>{var t,n;return null==(n=null==(t=D())?void 0:t.emulatorHosts)?void 0:n[e]},L=()=>{var e;return null==(e=D())?void 0:e.config},M=e=>{var t;return null==(t=D())?void 0:t[`_${e}`]};class F{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function U(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function V(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(U())}function q(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function j(){return false}class B extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,B.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z.prototype.create)}}class z{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,i=r,n.replace($,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new B(s,l,r)}}let $=/\{\$([^}]+)}/g;function H(e){return JSON.parse(e)}function W(e){return JSON.stringify(e)}let K=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=H(x(s[0])||""),n=H(x(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},G=function(e){let t=K(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},Q=function(e){let t=K(e).claims;return"object"==typeof t&&!0===t.admin};function Y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function X(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Z(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function ee(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(et(n)&&et(s)){if(!ee(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function et(e){return null!==e&&"object"==typeof e}function en(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function ei(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function er(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class es{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class eo{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=ea),void 0===i.error&&(i.error=ea),void 0===i.complete&&(i.complete=ea);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ea(){}function el(e,t){return`${e} failed: ${t} argument `}let eh=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;E(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eu=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function ec(e){return e&&e._delegate?e._delegate:e}class ed{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ef="[DEFAULT]";class ep{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new F;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}if(i)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ef})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ef){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ef){return this.instances.has(e)}getOptions(e=ef){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),r=null!=(n=this.onInitCallbacks.get(i))?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);let s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===ef?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(e){}return i||null}normalizeInstanceIdentifier(e=ef){return this.component?this.component.multipleInstances?e:ef:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eg{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ep(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let em=[];(aT=aN||(aN={}))[aT.DEBUG=0]="DEBUG",aT[aT.VERBOSE=1]="VERBOSE",aT[aT.INFO=2]="INFO",aT[aT.WARN=3]="WARN",aT[aT.ERROR=4]="ERROR",aT[aT.SILENT=5]="SILENT";let ey={debug:aN.DEBUG,verbose:aN.VERBOSE,info:aN.INFO,warn:aN.WARN,error:aN.ERROR,silent:aN.SILENT},e_=aN.INFO,ev={[aN.DEBUG]:"log",[aN.VERBOSE]:"log",[aN.INFO]:"info",[aN.WARN]:"warn",[aN.ERROR]:"error"},ew=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=ev[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eI{constructor(e){this.name=e,this._logLevel=e_,this._logHandler=ew,this._userLogHandler=null,em.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in aN))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ey[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,aN.DEBUG,...e),this._logHandler(this,aN.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,aN.VERBOSE,...e),this._logHandler(this,aN.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,aN.INFO,...e),this._logHandler(this,aN.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,aN.WARN,...e),this._logHandler(this,aN.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,aN.ERROR,...e),this._logHandler(this,aN.ERROR,...e)}}let eC=new WeakMap,eb=new WeakMap,eE=new WeakMap,eT=new WeakMap,eS=new WeakMap,ek={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eb.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eE.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eN(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eN(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(eN(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eC.set(t,e)}).catch(()=>{}),eS.set(t,e),t}if(eT.has(e))return eT.get(e);let i=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eR(this),t),eN(eC.get(this))}:function(...t){return eN(e.apply(eR(this),t))}:function(t,...n){let i=e.call(eR(this),t,...n);return eE.set(i,t.sort?t.sort():[t]),eN(i)};return e instanceof IDBTransaction&&function(e){if(eb.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});eb.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,ek):e}(e);return i!==e&&(eT.set(e,i),eS.set(i,e)),i}let eR=e=>eS.get(e),eA=["get","getKey","getAll","getAllKeys","count"],eP=["put","add","delete","clear"],ex=new Map;function eD(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ex.get(t))return ex.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=eP.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||eA.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return ex.set(t,s),s}ek={...g=ek,get:(e,t,n)=>eD(e,t)||g.get(e,t,n),has:(e,t)=>!!eD(e,t)||g.has(e,t)};class eO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if((null==(t=e.getComponent())?void 0:t.type)!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eL="@firebase/app",eM="0.9.10",eF=new eI("@firebase/app"),eU="[DEFAULT]",eV={[eL]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},eq=new Map,ej=new Map;function eB(e,t){try{e.container.addComponent(t)}catch(n){eF.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ez(e,t){e.container.addOrOverwriteComponent(t)}function e$(e){let t=e.name;if(ej.has(t))return eF.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(ej.set(t,e),eq.values()))eB(n,e);return!0}function eH(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function eW(e,t,n=eU){eH(e,t).clearInstance(n)}function eK(){ej.clear()}let eG=new z("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class eQ{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ed("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eG.create("app-deleted",{appName:this._name})}}let eY="9.22.0";function eJ(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:eU,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw eG.create("bad-app-name",{appName:String(r)});if(n||(n=L()),!n)throw eG.create("no-options");let s=eq.get(r);if(s)if(ee(n,s.options)&&ee(i,s.config))return s;else throw eG.create("duplicate-app",{appName:r});let o=new eg(r);for(let e of ej.values())o.addComponent(e);let a=new eQ(n,i,o);return eq.set(r,a),a}function eX(e=eU){let t=eq.get(e);if(!t&&e===eU&&L())return eJ();if(!t)throw eG.create("no-app",{appName:e});return t}function eZ(){return Array.from(eq.values())}async function e0(e){let t=e.name;eq.has(t)&&(eq.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function e1(e,t,n){var i;let r=null!=(i=eV[e])?i:e;n&&(r+=`-${n}`);let s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let e=[`Unable to register library "${r}" with version "${t}":`];s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eF.warn(e.join(" "));return}e$(new ed(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function e2(e,t){if(null!==e&&"function"!=typeof e)throw eG.create("invalid-log-argument");for(let n of em){let i=null;t&&t.level&&(i=ey[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...r)=>{let s=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(null!=i?i:t.logLevel)&&e({level:aN[n].toLowerCase(),message:s,args:r,type:t.name})}}}function e3(e){em.forEach(t=>{t.setLogLevel(e)})}let e4="firebase-heartbeat-store",e6=null;function e5(){return e6||(e6=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=eN(o);return i&&o.addEventListener("upgradeneeded",e=>{i(eN(o.result),e.oldVersion,e.newVersion,eN(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(e4)}}).catch(e=>{throw eG.create("idb-open",{originalErrorMessage:e.message})})),e6}async function e8(e){try{let t=await e5();return await t.transaction(e4).objectStore(e4).get(e7(e))}catch(e){if(e instanceof B)eF.warn(e.message);else{let t=eG.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eF.warn(t.message)}}}async function e9(e,t){try{let n=(await e5()).transaction(e4,"readwrite"),i=n.objectStore(e4);await i.put(t,e7(e)),await n.done}catch(e){if(e instanceof B)eF.warn(e.message);else{let t=eG.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eF.warn(t.message)}}}function e7(e){return`${e.name}!${e.options.appId}`}class te{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tn(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tt();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))?void 0:(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=tt(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),ti(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),ti(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=P(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function tt(){return new Date().toISOString().substring(0,10)}class tn{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null==(e=r.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await e8(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return e9(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return e9(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ti(e){return P(JSON.stringify({version:2,heartbeats:e})).length}e$(new ed("platform-logger",e=>new eO(e),"PRIVATE")),e$(new ed("heartbeat",e=>new te(e),"PRIVATE")),e1(eL,eM,""),e1(eL,eM,"esm2017"),e1("fire-js",""),e.s(["SDK_VERSION",()=>eY,"_DEFAULT_ENTRY_NAME",()=>eU,"_addComponent",()=>eB,"_addOrOverwriteComponent",()=>ez,"_apps",()=>eq,"_clearComponents",()=>eK,"_components",()=>ej,"_getProvider",()=>eH,"_registerComponent",()=>e$,"_removeServiceInstance",()=>eW,"deleteApp",()=>e0,"getApp",()=>eX,"getApps",()=>eZ,"initializeApp",()=>eJ,"onLog",()=>e2,"registerVersion",()=>e1,"setLogLevel",()=>e3],103251);var tr=e.i(189280);function ts(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let to=new z("auth","Firebase",ts()),ta=new eI("@firebase/auth");function tl(e,...t){ta.logLevel<=aN.ERROR&&ta.error(`Auth (${eY}): ${e}`,...t)}function th(e,...t){throw tc(e,...t)}function tu(e,...t){return tc(e,...t)}function tc(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return to.create(e,...t)}function td(e,t,...n){if(!e)throw tc(t,...n)}function tf(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tl(t),Error(t)}function tp(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function tg(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class tm{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||tf(n),this.isMobile=V()||q()}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tg()||"https:"===tg()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ty(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||tf(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class t_{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void tf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void tf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void tf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tw=new tm(3e4,6e4);function tI(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function tC(e,t,n,i,r={}){return tb(e,r,async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});let o=en(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),t_.fetch()(tT(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},r))})}async function tb(e,t,n){e._canInitEmulator=!1;let i=Object.assign(Object.assign({},tv),t);try{let t=new tS(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw tk(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw tk(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw tk(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw tk(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw new z("auth","Firebase",Object.assign(Object.assign({},ts()),{[o]:n})).create(o,{appName:e.name});th(e,o)}}catch(t){if(t instanceof B)throw t;th(e,"network-request-failed",{message:String(t)})}}async function tE(e,t,n,i,r={}){let s=await tC(e,t,n,i,r);return"mfaPendingCredential"in s&&th(e,"multi-factor-auth-required",{_serverResponse:s}),s}function tT(e,t,n,i){let r=`${t}${n}?${i}`;return e.config.emulator?ty(e.config,r):`${e.config.apiScheme}://${r}`}class tS{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tu(this.auth,"network-request-failed")),tw.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function tk(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=tu(e,t,i);return r.customData._tokenResponse=n,r}async function tN(e,t){return tC(e,"POST","/v1/accounts:delete",t)}async function tR(e,t){return tC(e,"POST","/v1/accounts:lookup",t)}function tA(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function tP(e,t=!1){let n=ec(e),i=await n.getIdToken(t),r=tD(i);td(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");let s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:tA(tx(r.auth_time)),issuedAtTime:tA(tx(r.iat)),expirationTime:tA(tx(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function tx(e){return 1e3*Number(e)}function tD(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return tl("JWT malformed, contained fewer than 3 sections"),null;try{let e=x(n);if(!e)return tl("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tl("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function tO(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof B&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class tM{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tA(this.lastLoginAt),this.creationTime=tA(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tF(e){var t,n,i;let r=e.auth,s=await e.getIdToken(),o=await tO(e,tR(r,{idToken:s}));td(null==o?void 0:o.users.length,r,"internal-error");let a=o.users[0];e._notifyReloadListener(a);let l=(null==(t=a.providerUserInfo)?void 0:t.length)?a.providerUserInfo.map(e=>{var{providerId:t}=e,n=(0,tr.__rest)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],h=(n=e.providerData,i=l,[...n.filter(e=>!i.some(t=>t.providerId===e.providerId)),...i]),u=e.isAnonymous,c=!(e.email&&a.passwordHash)&&!(null==h?void 0:h.length);Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:h,metadata:new tM(a.createdAt,a.lastLoginAt),isAnonymous:!!u&&c})}async function tU(e){let t=ec(e);await tF(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}async function tV(e,t){let n=await tb(e,{},async()=>{let n=en({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=tT(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",t_.fetch()(s,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}class tq{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){let t;td(e.idToken,"internal-error"),td(void 0!==e.idToken,"internal-error"),td(void 0!==e.refreshToken,"internal-error");let n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(td(t=tD(e.idToken),"internal-error"),td(void 0!==t.exp,"internal-error"),td(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return(td(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired)?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await tV(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new tq;return n&&(td("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(td("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(td("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tq,this.toJSON())}_performRefresh(){return tf("not implemented")}}function tj(e,t){td("string"==typeof e||void 0===e,"internal-error",{appName:t})}class tB{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=(0,tr.__rest)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new tM(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await tO(this,this.stsTokenManager.getToken(this.auth,e));return td(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tP(this,e)}reload(){return tU(this)}_assign(e){this!==e&&(td(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new tB(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){td(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await tF(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){let e=await this.getIdToken();return await tO(this,tN(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,l,h;let u=null!=(n=t.displayName)?n:void 0,c=null!=(i=t.email)?i:void 0,d=null!=(r=t.phoneNumber)?r:void 0,f=null!=(s=t.photoURL)?s:void 0,p=null!=(o=t.tenantId)?o:void 0,g=null!=(a=t._redirectEventId)?a:void 0,m=null!=(l=t.createdAt)?l:void 0,y=null!=(h=t.lastLoginAt)?h:void 0,{uid:_,emailVerified:v,isAnonymous:w,providerData:I,stsTokenManager:C}=t;td(_&&C,e,"internal-error");let b=tq.fromJSON(this.name,C);td("string"==typeof _,e,"internal-error"),tj(u,e.name),tj(c,e.name),td("boolean"==typeof v,e,"internal-error"),td("boolean"==typeof w,e,"internal-error"),tj(d,e.name),tj(f,e.name),tj(p,e.name),tj(g,e.name),tj(m,e.name),tj(y,e.name);let E=new tB({uid:_,auth:e,email:c,emailVerified:v,displayName:u,isAnonymous:w,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:b,createdAt:m,lastLoginAt:y});return I&&Array.isArray(I)&&(E.providerData=I.map(e=>Object.assign({},e))),g&&(E._redirectEventId=g),E}static async _fromIdTokenResponse(e,t,n=!1){let i=new tq;i.updateFromServerResponse(t);let r=new tB({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await tF(r),r}}let tz=new Map;function t$(e){var t,n;t="Expected a class definition",e instanceof Function||tf(t);let i=tz.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||tf(n)):(i=new e,tz.set(e,i)),i}class tH{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function tW(e,t,n){return`firebase:${e}:${t}:${n}`}tH.type="NONE";class tK{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=tW(this.userKey,i.apiKey,r),this.fullPersistenceKey=tW("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?tB._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new tK(t$(tH),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||t$(tH),s=tW(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let i=tB._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}let a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length&&(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new tK(r,e,n)}}function tG(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(tX(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(tQ(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(t0(t))return"Blackberry";if(t1(t))return"Webos";if(tY(t))return"Safari";if((t.includes("chrome/")||tJ(t))&&!t.includes("edge/"))return"Chrome";if(tZ(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function tQ(e=U()){return/firefox\//i.test(e)}function tY(e=U()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function tJ(e=U()){return/crios\//i.test(e)}function tX(e=U()){return/iemobile/i.test(e)}function tZ(e=U()){return/android/i.test(e)}function t0(e=U()){return/blackberry/i.test(e)}function t1(e=U()){return/webos/i.test(e)}function t2(e=U()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function t3(e=U()){return t2(e)||tZ(e)||t1(e)||t0(e)||/windows phone/i.test(e)||tX(e)}function t4(e,t=[]){let n;switch(e){case"Browser":n=tG(U());break;case"Worker":n=`${tG(U())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${eY}/${i}`}async function t6(e,t){return tC(e,"GET","/v2/recaptchaConfig",tI(e,t))}function t5(e){return void 0!==e&&void 0!==e.enterprise}class t8{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState)}}function t9(e){return new Promise((t,n)=>{var i,r;let s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{let t=tu("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(null!=(r=null==(i=document.getElementsByTagName("head"))?void 0:i[0])?r:document).appendChild(s)})}function t7(e){return`__${e}${Math.floor(1e6*Math.random())}`}class ne{constructor(e){this.type="recaptcha-enterprise",this.auth=ec(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{t6(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new t8(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;t5(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&t5(window.grecaptcha))i(n,e,r);else{if("undefined"==typeof window)return void r(Error("RecaptchaVerifier is only supported in browser"));t9("https://www.google.com/recaptcha/enterprise.js?render="+n).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function nt(e,t,n,i=!1){let r,s=new ne(e);try{r=await s.verify(n)}catch(e){r=await s.verify(n,!0)}let o=Object.assign({},t);return i?Object.assign(o,{captchaResp:r}):Object.assign(o,{captchaResponse:r}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class nn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class ni{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nr(this),this.idTokenSubscription=new nr(this),this.beforeStateQueue=new nn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=to,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=t$(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted){if(this.persistenceManager=await tK.create(this,e),!this._deleted){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(i=this.currentUser)?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser(),i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);(!n||n===s)&&(null==o?void 0:o.user)&&(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(td(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tF(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){let t=e?ec(e):null;return t&&td(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&td(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(t$(e))})}async initializeRecaptchaConfig(){let e=new t8(await t6(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==this.tenantId?this._agentRecaptchaConfig=e:this._tenantRecaptchaConfigs[this.tenantId]=e,e.emailPasswordEnabled&&new ne(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new z("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&t$(e)||this._popupRedirectResolver;td(t,this,"argument-error"),this.redirectPersistenceManager=await tK.create(this,[t$(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return(td(s,this,"internal-error"),s.then(()=>r(this.currentUser)),"function"==typeof t)?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return td(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=t4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){ta.logLevel<=aN.WARN&&ta.warn(`Auth (${eY}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}class nr{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new eo(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return td(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ns(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function no(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class na{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tf("not implemented")}_getIdTokenResponse(e){return tf("not implemented")}_linkToIdToken(e,t){return tf("not implemented")}_getReauthenticationResolver(e){return tf("not implemented")}}async function nl(e,t){return tC(e,"POST","/v1/accounts:update",t)}async function nh(e,t){return tE(e,"POST","/v1/accounts:signInWithPassword",tI(e,t))}async function nu(e,t){return tE(e,"POST","/v1/accounts:signInWithEmailLink",tI(e,t))}async function nc(e,t){return tE(e,"POST","/v1/accounts:signInWithEmailLink",tI(e,t))}class nd extends na{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new nd(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new nd(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":let n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null==(t=e._getRecaptchaConfig())||!t.emailPasswordEnabled)return nh(e,n).catch(async t=>{if("auth/missing-recaptcha-token"!==t.code)return Promise.reject(t);{console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");let t=await nt(e,n,"signInWithPassword");return nh(e,t)}});{let t=await nt(e,n,"signInWithPassword");return nh(e,t)}case"emailLink":return nu(e,{email:this._email,oobCode:this._password});default:th(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nl(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return nc(e,{idToken:t,email:this._email,oobCode:this._password});default:th(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function nf(e,t){return tE(e,"POST","/v1/accounts:signInWithIdp",tI(e,t))}class np extends na{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new np(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):th("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=(0,tr.__rest)(t,["providerId","signInMethod"]);if(!n||!i)return null;let s=new np(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return nf(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,nf(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nf(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=en(t)}return e}}async function ng(e,t){return tC(e,"POST","/v1/accounts:sendVerificationCode",tI(e,t))}async function nm(e,t){return tE(e,"POST","/v1/accounts:signInWithPhoneNumber",tI(e,t))}async function ny(e,t){let n=await tE(e,"POST","/v1/accounts:signInWithPhoneNumber",tI(e,t));if(n.temporaryProof)throw tk(e,"account-exists-with-different-credential",n);return n}let n_={USER_NOT_FOUND:"user-not-found"};async function nv(e,t){return tE(e,"POST","/v1/accounts:signInWithPhoneNumber",tI(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),n_)}class nw extends na{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new nw({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new nw({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return nm(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return ny(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return nv(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new nw({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class nI{constructor(e){var t,n,i,r,s,o;const a=ei(er(e)),l=null!=(t=a.apiKey)?t:null,h=null!=(n=a.oobCode)?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(i=a.mode)?i:null);td(l&&h&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=h,this.continueUrl=null!=(r=a.continueUrl)?r:null,this.languageCode=null!=(s=a.languageCode)?s:null,this.tenantId=null!=(o=a.tenantId)?o:null}static parseLink(e){let t,n,i,r=(n=(t=ei(er(e)).link)?ei(er(t)).deep_link_id:null,((i=ei(er(e)).deep_link_id)?ei(er(i)).link:null)||i||n||t||e);try{return new nI(r)}catch(e){return null}}}class nC{constructor(){this.providerId=nC.PROVIDER_ID}static credential(e,t){return nd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=nI.parseLink(t);return td(n,"argument-error"),nd._fromEmailAndCode(e,n.code,n.tenantId)}}nC.PROVIDER_ID="password",nC.EMAIL_PASSWORD_SIGN_IN_METHOD="password",nC.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class nb{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class nE extends nb{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nT extends nE{static credentialFromJSON(e){let t="string"==typeof e?JSON.parse(e):e;return td("providerId"in t&&"signInMethod"in t,"argument-error"),np._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return td(e.idToken||e.accessToken,"argument-error"),np._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return nT.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return nT.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:i,pendingToken:r,nonce:s,providerId:o}=e;if(!n&&!i&&!t&&!r||!o)return null;try{return new nT(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:r})}catch(e){return null}}}class nS extends nE{constructor(){super("facebook.com")}static credential(e){return np._fromParams({providerId:nS.PROVIDER_ID,signInMethod:nS.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nS.credentialFromTaggedObject(e)}static credentialFromError(e){return nS.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nS.credential(e.oauthAccessToken)}catch(e){return null}}}nS.FACEBOOK_SIGN_IN_METHOD="facebook.com",nS.PROVIDER_ID="facebook.com";class nk extends nE{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return np._fromParams({providerId:nk.PROVIDER_ID,signInMethod:nk.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nk.credentialFromTaggedObject(e)}static credentialFromError(e){return nk.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return nk.credential(t,n)}catch(e){return null}}}nk.GOOGLE_SIGN_IN_METHOD="google.com",nk.PROVIDER_ID="google.com";class nN extends nE{constructor(){super("github.com")}static credential(e){return np._fromParams({providerId:nN.PROVIDER_ID,signInMethod:nN.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nN.credentialFromTaggedObject(e)}static credentialFromError(e){return nN.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nN.credential(e.oauthAccessToken)}catch(e){return null}}}nN.GITHUB_SIGN_IN_METHOD="github.com",nN.PROVIDER_ID="github.com";class nR extends nE{constructor(){super("twitter.com")}static credential(e,t){return np._fromParams({providerId:nR.PROVIDER_ID,signInMethod:nR.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return nR.credentialFromTaggedObject(e)}static credentialFromError(e){return nR.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return nR.credential(t,n)}catch(e){return null}}}nR.TWITTER_SIGN_IN_METHOD="twitter.com",nR.PROVIDER_ID="twitter.com";class nA{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new nA({user:await tB._fromIdTokenResponse(e,n,i),providerId:nP(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new nA({user:e,providerId:nP(n),_tokenResponse:n,operationType:t})}}function nP(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class nx extends B{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,nx.prototype),this.customData={appName:e.name,tenantId:null!=(r=e.tenantId)?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new nx(e,t,n,i)}}function nD(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw nx._fromErrorAndOperation(e,n,t,i);throw n})}async function nO(e,t,n=!1){let i=await tO(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return nA._forOperation(e,"link",i)}async function nL(e,t,n=!1){let{auth:i}=e,r="reauthenticate";try{let s=await tO(e,nD(i,r,t,e),n);td(s.idToken,i,"internal-error");let o=tD(s.idToken);td(o,i,"internal-error");let{sub:a}=o;return td(e.uid===a,i,"user-mismatch"),nA._forOperation(e,r,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&th(i,"user-mismatch"),e}}async function nM(e,t,n=!1){let i="signIn",r=await nD(e,i,t),s=await nA._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}async function nF(e,t){return nM(ec(e),t)}async function nU(e,t){return tE(e,"POST","/v1/accounts:signInWithCustomToken",tI(e,t))}async function nV(e,t){let n=ec(e),i=await nU(n,{token:t,returnSecureToken:!0}),r=await nA._fromIdTokenResponse(n,"signIn",i);return await n._updateCurrentUser(r.user),r}class nq{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?nj._fromServerResponse(e,t):"totpInfo"in t?nB._fromServerResponse(e,t):th(e,"internal-error")}}class nj extends nq{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new nj(t)}}class nB extends nq{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new nB(t)}}new WeakMap;let nz="__sak";class n${constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(nz,"1"),this.storage.removeItem(nz),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class nH extends n${constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){let e=U();return tY(e)||t2(e)}()&&function(){try{return!!(window&&window!==window.top)}catch(e){return!1}}(),this.fallbackToPolling=t3(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let n=this.storage.getItem(i);if(e.newValue!==n)null!==e.newValue?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}let r=()=>{let e=this.storage.getItem(i);(t||this.localCache[i]!==e)&&this.notifyListeners(i,e)},s=this.storage.getItem(i);((n=U()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}nH.type="LOCAL";class nW extends n${constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}nW.type="SESSION";class nK{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new nK(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function nG(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}nK.receivers=[];class nQ{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=nG("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(h),clearTimeout(i),a(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function nY(){return window}function nJ(){return void 0!==nY().WorkerGlobalScope&&"function"==typeof nY().importScripts}async function nX(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let nZ="firebaseLocalStorageDb",n0="firebaseLocalStorage",n1="fbase_key";class n2{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function n3(e,t){return e.transaction([n0],t?"readwrite":"readonly").objectStore(n0)}function n4(){let e=indexedDB.open(nZ,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(n0,{keyPath:n1})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(n0)?t(n):(n.close(),await new n2(indexedDB.deleteDatabase(nZ)).toPromise(),t(await n4()))})})}async function n6(e,t,n){return new n2(n3(e,!0).put({[n1]:t,value:n})).toPromise()}async function n5(e,t){let n=n3(e,!1).get(t),i=await new n2(n).toPromise();return void 0===i?null:i.value}function n8(e,t){return new n2(n3(e,!0).delete(t)).toPromise()}class n9{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await n4()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nJ()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nK._getInstance(nJ()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await nX(),!this.activeServiceWorker)return;this.sender=new nQ(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null==(e=n[0])?void 0:e.fulfilled)&&(null==(t=n[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await n4();return await n6(e,nz,"1"),await n8(e,nz),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>n6(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>n5(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>n8(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new n2(n3(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}async function n7(e,t,n){var i,r,s;let o=await n.verify();try{let a;if(td("string"==typeof o,e,"argument-error"),td("recaptcha"===n.type,e,"argument-error"),a="string"==typeof t?{phoneNumber:t}:t,"session"in a){let t=a.session;if("phoneNumber"in a)return td("enroll"===t.type,e,"internal-error"),(await (r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:a.phoneNumber,recaptchaToken:o}},tC(e,"POST","/v2/accounts/mfaEnrollment:start",tI(e,r)))).phoneSessionInfo.sessionInfo;{td("signin"===t.type,e,"internal-error");let n=(null==(i=a.multiFactorHint)?void 0:i.uid)||a.multiFactorUid;return td(n,e,"missing-multi-factor-info"),(await (s={mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:o}},tC(e,"POST","/v2/accounts/mfaSignIn:start",tI(e,s)))).phoneResponseInfo.sessionInfo}}{let{sessionInfo:t}=await ng(e,{phoneNumber:a.phoneNumber,recaptchaToken:o});return t}}finally{n._reset()}}n9.type="LOCAL",t7("rcb"),new tm(3e4,6e4);class ie{constructor(e){this.providerId=ie.PROVIDER_ID,this.auth=ec(e)}verifyPhoneNumber(e,t){return n7(this.auth,e,ec(t))}static credential(e,t){return nw._fromVerification(e,t)}static credentialFromResult(e){return ie.credentialFromTaggedObject(e)}static credentialFromError(e){return ie.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?nw._fromTokenResponse(t,n):null}}ie.PROVIDER_ID="phone",ie.PHONE_SIGN_IN_METHOD="phone";class it extends na{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nf(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ii(e){return nM(e.auth,new it(e),e.bypassAuthState)}function ir(e){let{auth:t,user:n}=e;return td(n,t,"internal-error"),nL(n,new it(e),e.bypassAuthState)}async function is(e){let{auth:t,user:n}=e;return td(n,t,"internal-error"),nO(n,new it(e),e.bypassAuthState)}class io{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ii;case"linkViaPopup":case"linkViaRedirect":return is;case"reauthViaPopup":case"reauthViaRedirect":return ir;default:th(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tf(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tf(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let ia=new tm(2e3,1e4);class il extends io{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,il.currentPopupAction&&il.currentPopupAction.cancel(),il.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return td(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tf(t);let n=nG();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(tu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,il.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null==(n=null==(t=this.authWindow)?void 0:t.window)?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ia.get())};e()}}il.currentPopupAction=null;let ih=new Map;class iu extends io{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ih.get(this.auth._key());if(!e){try{let t=await ic(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}ih.set(this.auth._key(),e)}return this.bypassAuthState||ih.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ic(e,t){var n;let i=tW("pendingRedirect",(n=t).config.apiKey,n.name),r=t$(e._redirectPersistence);if(!await r._isAvailable())return!1;let s=await r._get(i)==="true";return await r._remove(i),s}function id(e,t){ih.set(e._key(),t)}async function ip(e,t,n=!1){let i=ec(e),r=t?t$(t):(td(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver),s=new iu(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class ig{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return iy(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!iy(e)){let i=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error";t.onError(tu(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(im(e))}saveEventToCache(e){this.cachedEventUids.add(im(e)),this.lastProcessedEventTime=Date.now()}}function im(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function iy({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function i_(e,t={}){return tC(e,"GET","/v1/projects",t)}let iv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,iw=/^https?/;async function iI(e){if(e.config.emulator)return;let{authorizedDomains:t}=await i_(e);for(let e of t)try{if(function(e){let t=tp(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!iw.test(n))return!1;if(iv.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch(e){}th(e,"unauthorized-domain")}let iC=new tm(3e4,6e4);function ib(){let e=nY().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let iE=null,iT=new tm(5e3,15e3),iS={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ik=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function iN(e){let t,n,i,r,s,o=await (iE=iE||new Promise((t,n)=>{var i,r,s;function o(){ib(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ib(),n(tu(e,"network-request-failed"))},timeout:iC.get()})}if(null==(r=null==(i=nY().gapi)?void 0:i.iframes)?void 0:r.Iframe)t(gapi.iframes.getContext());else if(null==(s=nY().gapi)?void 0:s.load)o();else{let t=t7("iframefcb");return nY()[t]=()=>{gapi.load?o():n(tu(e,"network-request-failed"))},t9(`https://apis.google.com/js/api.js?onload=${t}`).catch(e=>n(e))}}).catch(e=>{throw iE=null,e})),a=nY().gapi;return td(a,e,"internal-error"),o.open({where:document.body,url:(td((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?ty(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:eY},(r=ik.get(e.config.apiHost))&&(i.eid=r),(s=e._getFrameworks()).length&&(i.fw=s.join(",")),`${n}?${en(i).slice(1)}`),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:iS,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=tu(e,"network-request-failed"),s=nY().setTimeout(()=>{i(r)},iT.get());function o(){nY().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}let iR={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class iA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let iP=encodeURIComponent("fac");async function ix(e,t,n,i,r,s){td(e.config.authDomain,e,"auth-domain-config-required"),td(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:eY,eventId:r};if(t instanceof nb)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",X(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=i;if(t instanceof nE){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${iP}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?ty(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${en(o).slice(1)}${l}`}let iD="webStorageSupport",iO=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=nW,this._completeRedirectFn=ip,this._overrideRedirectResult=id}async _openPopup(e,t,n,i){var r,s,o;s=null==(r=this.eventManagers[e._key()])?void 0:r.manager,o="_initialize() not called before _openPopup()",s||tf(o);let a=await ix(e,t,n,tp(),i);return function(e,t,n,i=500,r=600){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l=Object.assign(Object.assign({},iR),{width:i.toString(),height:r.toString(),top:s,left:o}),h=U().toLowerCase();n&&(a=tJ(h)?"_blank":n),tQ(h)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=U()){var t;return t2(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(h)&&"_self"!==a){var c,d;let e,n;return c=t||"",d=a,(e=document.createElement("a")).href=c,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new iA(null)}let f=window.open(t||"",a,u);td(f,e,"popup-blocked");try{f.focus()}catch(e){}return new iA(f)}(e,a,nG())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await ix(e,t,n,tp(),i),nY().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||tf(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await iN(e),n=new ig(e);return t.register("authEvent",t=>(td(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(iD,{type:iD},n=>{var i;let r=null==(i=null==n?void 0:n[0])?void 0:i[iD];void 0!==r&&t(!!r),th(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=iI(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return t3()||tY()||t2()}};var iL="@firebase/auth",iM="0.23.2";class iF{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){td(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let iU=M("authIdTokenMaxAge")||300,iV=null;function iq(e=eX()){let t=eH(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=eH(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(ee(n.getOptions(),null!=t?t:{}))return e;th(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:iO,persistence:[n9,nH,nW]}),i=M("authTokenSyncURL");if(i){let e=async e=>{let t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>iU)return;let r=null==t?void 0:t.token;iV!==r&&(iV=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};ec(n).beforeAuthStateChanged(e,()=>e(n.currentUser)),ec(n).onIdTokenChanged(t=>e(t),void 0,void 0)}let r=O("auth");return r&&function(e,t,n){let i=ec(e);td(i._canInitEmulator,i,"emulator-config-failed"),td(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=ns(t),{host:s,port:o}=function(e){let t=ns(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:no(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:no(t)}}}(t),a=null===o?"":`:${o}`;i.config.emulator={url:`${r}//${s}${a}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:s,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}aS="Browser",e$(new ed("auth",(e,{options:t})=>{let n,i,r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;td(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h=new ni(r,s,o,{apiKey:a,authDomain:l,clientPlatform:aS,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:t4(aS)});return i=(Array.isArray(n=(null==t?void 0:t.persistence)||[])?n:[n]).map(t$),(null==t?void 0:t.errorMap)&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),e$(new ed("auth-internal",e=>new iF(ec(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),e1(iL,iM,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(aS)),e1(iL,iM,"esm2017"),e.s([],444353),e.i(444353);let ij="@firebase/database",iB="0.14.4",iz="";class i${constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),W(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:H(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class iH{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Y(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let iW=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new i$(t)}}catch(e){}return new iH},iK=iW("localStorage"),iG=iW("sessionStorage"),iQ=new eI("@firebase/database"),iY=(f=1,function(){return f++}),iJ=function(e){let t=eh(e),n=new es;n.update(t);let i=n.digest();return N.encodeByteArray(i)},iX=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=iX.apply(null,i):"object"==typeof i?t+=W(i):t+=i,t+=" "}return t},iZ=null,i0=!0,i1=function(e,t){E(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(iQ.logLevel=aN.VERBOSE,iZ=iQ.log.bind(iQ),t&&iG.set("logging_enabled",!0)):"function"==typeof e?iZ=e:(iZ=null,iG.remove("logging_enabled"))},i2=function(...e){if(!0===i0&&(i0=!1,null===iZ&&!0===iG.get("logging_enabled")&&i1(!0)),iZ){let t=iX.apply(null,e);iZ(t)}},i3=function(e){return function(...t){i2(e,...t)}},i4=function(...e){let t="FIREBASE INTERNAL ERROR: "+iX(...e);iQ.error(t)},i6=function(...e){let t=`FIREBASE FATAL ERROR: ${iX(...e)}`;throw iQ.error(t),Error(t)},i5=function(...e){let t="FIREBASE WARNING: "+iX(...e);iQ.warn(t)},i8=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&i5("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},i9=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},i7=function(e){if(j()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},re="[MIN_NAME]",rt="[MAX_NAME]",rn=function(e,t){if(e===t)return 0;{if(e===re||t===rt)return -1;if(t===re||e===rt)return 1;let n=ru(e),i=ru(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},ri=function(e,t){return e===t?0:e<t?-1:1},rr=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+W(t))},rs=function(e){if("object"!=typeof e||null===e)return W(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=W(t[i]),n+=":",n+=rs(e[t[i]]);return n+"}"},ro=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function ra(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let rl=function(e){let t,n,i,r,s;E(!i9(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},rh=RegExp("^-?(0*)\\d{1,10}$"),ru=function(e){if(rh.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},rc=function(e){try{e()}catch(e){setTimeout(()=>{throw i5("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},rd=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class rf{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){i5(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class rp{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(i2("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',i5(e)}}class rg{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}rg.OWNER="owner";let rm=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ry="websocket",r_="long_polling";class rv{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=iK.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&iK.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function rw(e,t,n){let i;if(E("string"==typeof t,"typeof type must == string"),E("object"==typeof n,"typeof params must == object"),t===ry)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===r_)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return ra(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class rI{constructor(){this.counters_={}}incrementCounter(e,t=1){Y(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,this.counters_)}}let rC={},rb={};function rE(e){let t=e.toString();return rC[t]||(rC[t]=new rI),rC[t]}class rT{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&rc(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let rS="start";class rk{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=i3(e),this.stats_=rE(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),rw(t,r_,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new rT(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),i7(()=>{if(this.isClosed_)return;this.scriptTagHolder=new rN((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===rS)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[rS]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&rm.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){rk.forceAllow_=!0}static forceDisallow(){rk.forceDisallow_=!0}static isAvailable(){return!j()&&(!!rk.forceAllow_||!rk.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=W(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=ro(A(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(j())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=W(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class rN{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,j())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=iY(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=rN.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){i2("frame writing exception"),e.stack&&i2(e.stack),i2(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||i2("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){j()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{i2("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let rR=null;"undefined"!=typeof MozWebSocket?rR=MozWebSocket:"undefined"!=typeof WebSocket&&(rR=WebSocket);class rA{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=i3(this.connId),this.stats_=rE(t),this.connURL=rA.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!j()&&"undefined"!=typeof location&&location.hostname&&rm.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),rw(e,ry,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,iK.set("previous_websocket_failure",!0);try{let e;if(j()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${iz}/${b.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=b.default.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new rR(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){rA.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==rR&&!rA.forceDisallow_}static previouslyFailed(){return iK.isInMemoryStorage||!0===iK.get("previous_websocket_failure")}markConnectionHealthy(){iK.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=H(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(E(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=W(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=ro(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}rA.responsesRequiredToBeHealthy=2,rA.healthyTimeout=3e4;class rP{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[rk,rA]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){let t=rA&&rA.isAvailable(),n=t&&!rA.previouslyFailed();if(e.webSocketOnly&&(t||i5("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[rA];else{let e=this.transports_=[];for(let t of rP.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);rP.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}rP.globalTransportInitialized_=!1;class rx{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=i3("c:"+this.id+":"),this.transportManager_=new rP(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=rd(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=rr("t",e),n=rr("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=rr("t",e),n=rr("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=rr("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?i4("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):i4("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&i5("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),rd(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):rd(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(iK.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class rD{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class rO{constructor(e){this.allowedEvents_=e,this.listeners_={},E(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){E(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class rL extends rO{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||V()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new rL}getInitialEvent(e){return E("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class rM{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function rF(){return new rM("")}function rU(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function rV(e){return e.pieces_.length-e.pieceNum_}function rq(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new rM(e.pieces_,t)}function rj(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function rB(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function rz(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new rM(t,0)}function r$(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof rM)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new rM(n,0)}function rH(e){return e.pieceNum_>=e.pieces_.length}function rW(e,t){let n=rU(e),i=rU(t);if(null===n)return t;if(n===i)return rW(rq(e),rq(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function rK(e,t){if(rV(e)!==rV(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function rG(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(rV(e)>rV(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class rQ{constructor(e,t){this.errorPrefix_=t,this.parts_=rB(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eu(this.parts_[e]);rY(this)}}function rY(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+rJ(e))}function rJ(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class rX extends rO{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new rX}getInitialEvent(e){return E("visible"===e,"Unknown event type: "+e),[this.visible_]}}class rZ extends rD{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=rZ.nextPersistentConnectionId_++,this.log_=i3("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!j())throw Error("Auth override specified in options, but not supported on non Node.js platforms");rX.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&rL.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(W(r)),E(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new F,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),E(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;rZ.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Y(e,"w")){let n=J(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();i5(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||Q(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=G(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+W(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):i4("Unrecognized action received from server: "+W(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){E(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+rZ.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){E(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?i2("getToken() completed but was canceled"):(i2("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new rx(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{i5(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&i5(e),a())}}}interrupt(e){i2("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){i2("Resuming connection for reason: "+e),delete this.interruptReasons_[e],X(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>rs(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new rM(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){i2("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){i2("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";j()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+iz.replace(/\./g,"-")]=1,V()?e["framework.cordova"]=1:q()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=rL.getInstance().currentlyOnline();return X(this.interruptReasons_)&&e}}rZ.nextPersistentConnectionId_=0,rZ.nextConnectionId_=0;class r0{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new r0(e,t)}}class r1{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new r0(re,e),i=new r0(re,t);return 0!==this.compare(n,i)}minPost(){return r0.MIN}}class r2 extends r1{static get __EMPTY_NODE(){return i}static set __EMPTY_NODE(e){i=e}compare(e,t){return rn(e.name,t.name)}isDefinedOn(e){throw T("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return r0.MIN}maxPost(){return new r0(rt,i)}makePost(e,t){return E("string"==typeof e,"KeyIndex indexValue must always be a string."),new r0(e,i)}toString(){return".key"}}let r3=new r2;class r4{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class r6{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:r6.RED,this.left=null!=i?i:r5.EMPTY_NODE,this.right=null!=r?r:r5.EMPTY_NODE}copy(e,t,n,i,r){return new r6(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return r5.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return r5.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,r6.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,r6.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}r6.RED=!0,r6.BLACK=!1;class r5{constructor(e,t=r5.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new r5(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,r6.BLACK,null,null))}remove(e){return new r5(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,r6.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new r4(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new r4(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new r4(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new r4(this.root_,null,this.comparator_,!0,e)}}function r8(e,t){return rn(e.name,t.name)}function r9(e,t){return rn(e,t)}r5.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new r6(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let r7=function(e){return"number"==typeof e?"number:"+rl(e):"string:"+e},se=function(e){if(e.isLeafNode()){let t=e.val();E("string"==typeof t||"number"==typeof t||"object"==typeof t&&Y(t,".sv"),"Priority must be a string or number.")}else E(e===r||e.isEmpty(),"priority of unexpected type.");E(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class st{constructor(e,t=st.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,E(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),se(this.priorityNode_)}static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new st(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:st.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return rH(e)?this:".priority"===rU(e)?this.priorityNode_:st.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:st.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=rU(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(E(".priority"!==n||1===rV(e),".priority must be the last token in a path"),this.updateImmediateChild(n,st.__childrenNodeConstructor.EMPTY_NODE.updateChild(rq(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+r7(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=rl(this.value_):e+=this.value_,this.lazyHash_=iJ(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===st.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof st.__childrenNodeConstructor?-1:(E(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=st.VALUE_TYPE_ORDER.indexOf(t),r=st.VALUE_TYPE_ORDER.indexOf(n);return(E(i>=0,"Unknown leaf type: "+t),E(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}st.VALUE_TYPE_ORDER=["object","boolean","number","string"];let sn=new class extends r1{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?rn(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return r0.MIN}maxPost(){return new r0(rt,new st("[PRIORITY-POST]",a))}makePost(e,t){return new r0(t,new st("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},si=Math.log(2);class sr{constructor(e){this.count=parseInt(Math.log(e+1)/si,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let ss=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,o=i-t;if(0===o)return null;if(1===o)return s=e[t],new r6(n?n(s):s,s.node,r6.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,i);return s=e[a],new r6(n?n(s):s,s.node,r6.BLACK,l,h)}};return new r5(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),u=e[s];l(new r6(n?n(u):u,u.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,r6.BLACK):(a(i,r6.BLACK),a(i,r6.RED))}return s}(new sr(e.length)))},so={};class sa{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return E(so&&sn,"ChildrenNode.ts has not been loaded"),l=l||new sa({".priority":so},{".priority":sn})}get(e){let t=J(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof r5?t:null}hasIndex(e){return Y(this.indexSet_,e.toString())}addIndex(e,t){let n;E(e!==r3,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(r0.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?ss(i,e.getCompare()):so;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let h=Object.assign({},this.indexes_);return h[a]=n,new sa(h,l)}addToIndexes(e,t){return new sa(Z(this.indexes_,(n,i)=>{let r=J(this.indexSet_,i);if(E(r,"Missing index implementation for "+i),n===so)if(!r.isDefinedOn(e.node))return so;else{let n=[],i=t.getIterator(r0.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),ss(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new r0(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new sa(Z(this.indexes_,n=>{if(n===so)return n;{let i=t.get(e.name);return i?n.remove(new r0(e.name,i)):n}}),this.indexSet_)}}class sl{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&se(this.priorityNode_),this.children_.isEmpty()&&E(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return h||(h=new sl(new r5(r9),null,sa.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new sl(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=rU(e);return null===t?this:this.getImmediateChild(t).getChild(rq(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(E(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new r0(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new sl(n,s,i)}}updateChild(e,t){let n=rU(e);if(null===n)return t;{E(".priority"!==rU(e)||1===rV(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(rq(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(sn,(s,o)=>{t[s]=o.val(e),n++,r&&sl.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+r7(this.getPriority().val())+":"),this.forEachChild(sn,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":iJ(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new r0(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new r0(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new r0(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,r0.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,r0.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===sh?-1:0}withIndex(e){if(e===r3||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new sl(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===r3||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(sn),n=e.getIterator(sn),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===r3?null:this.indexMap_.get(e.toString())}}sl.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let sh=new class extends sl{constructor(){super(new r5(r9),sl.EMPTY_NODE,sa.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return sl.EMPTY_NODE}isEmpty(){return!1}};function su(e,t=null){if(null===e)return sl.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),E(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new st(e,su(t));if(e instanceof Array){let n=sl.EMPTY_NODE;return ra(e,(t,i)=>{if(Y(e,t)&&"."!==t.substring(0,1)){let e=su(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(su(t))}{let n=[],i=!1;if(ra(e,(e,t)=>{if("."!==e.substring(0,1)){let r=su(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new r0(e,r)))}}),0===n.length)return sl.EMPTY_NODE;let r=ss(n,r8,e=>e.name,r9);if(!i)return new sl(r,su(t),sa.Default);{let e=ss(n,sn.getCompare());return new sl(r,su(t),new sa({".priority":e},{".priority":sn}))}}}Object.defineProperties(r0,{MIN:{value:new r0(re,sl.EMPTY_NODE)},MAX:{value:new r0(rt,sh)}}),r2.__EMPTY_NODE=sl.EMPTY_NODE,st.__childrenNodeConstructor=sl,r=sh,a=sh,o=su;class sc extends r1{constructor(e){super(),this.indexPath_=e,E(!rH(e)&&".priority"!==rU(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?rn(e.name,t.name):r}makePost(e,t){let n=su(e);return new r0(t,sl.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new r0(rt,sl.EMPTY_NODE.updateChild(this.indexPath_,sh))}toString(){return rB(this.indexPath_,0).join("/")}}let sd=new class extends r1{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?rn(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return r0.MIN}maxPost(){return r0.MAX}makePost(e,t){return new r0(t,su(e))}toString(){return".value"}};function sf(e){return{type:"value",snapshotNode:e}}function sp(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function sg(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function sm(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class sy{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){E(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(sg(t,o)):E(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(sp(t,n)):s.trackChildChange(sm(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(sn,(e,i)=>{t.hasChild(e)||n.trackChildChange(sg(e,i))}),t.isLeafNode()||t.forEachChild(sn,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(sm(t,i,r))}else n.trackChildChange(sp(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?sl.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class s_{constructor(e){this.indexedFilter_=new sy(e.getIndex()),this.index_=e.getIndex(),this.startPost_=s_.getStartPost_(e),this.endPost_=s_.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new r0(t,n))||(n=sl.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=sl.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(sl.EMPTY_NODE);let r=this;return t.forEachChild(sn,(e,t)=>{r.matches(new r0(e,t))||(i=i.updateImmediateChild(e,sl.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class sv{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new s_(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new r0(t,n))||(n=sl.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=sl.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=sl.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(sl.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,sl.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();E(e.numChildren()===this.limit_,"");let o=new r0(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(l&&!n.isEmpty()&&c>=0)return null!=r&&r.trackChildChange(sm(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(sg(t,h));let n=e.updateImmediateChild(t,sl.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(sp(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=r&&(r.trackChildChange(sg(a.name,a.node)),r.trackChildChange(sp(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,sl.EMPTY_NODE)):e:e}}class sw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=sn}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return E(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(E(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:re}hasEnd(){return this.endSet_}getIndexEndValue(){return E(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(E(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:rt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return E(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===sn}copy(){let e=new sw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function sI(e){let t,n={};if(e.isDefault())return n;if(e.index_===sn?t="$priority":e.index_===sd?t="$value":e.index_===r3?t="$key":(E(e.index_ instanceof sc,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=W(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=W(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+W(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=W(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+W(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function sC(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==sn&&(t.i=e.index_.toString()),t}class sb extends rD{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=i3("p:rest:"),this.listens_={}}reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(E(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=sb.getListenId_(e,n),o={};this.listens_[s]=o;let a=sI(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),J(this.listens_,s)===o)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=sb.getListenId_(e,t);delete this.listens_[n]}get(e){let t=sI(e._queryParams),n=e._path.toString(),i=new F;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+en(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=H(o.responseText)}catch(e){i5("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&i5("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class sE{constructor(){this.rootNode_=sl.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function sT(){return{value:null,children:new Map}}function sS(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{sS(i,new rM(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class sk{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ra(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class sN{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new sk(e);const n=1e4+2e4*Math.random();rd(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;ra(e,(e,i)=>{i>0&&Y(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),rd(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function sR(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function sA(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function sP(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(ak=aR||(aR={}))[ak.OVERWRITE=0]="OVERWRITE",ak[ak.MERGE=1]="MERGE",ak[ak.ACK_USER_WRITE=2]="ACK_USER_WRITE",ak[ak.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class sx{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=aR.ACK_USER_WRITE,this.source=sR()}operationForChild(e){if(!rH(this.path))return E(rU(this.path)===e,"operationForChild called for unrelated child."),new sx(rq(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return E(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new rM(e));return new sx(rF(),t,this.revert)}}}class sD{constructor(e,t){this.source=e,this.path=t,this.type=aR.LISTEN_COMPLETE}operationForChild(e){return rH(this.path)?new sD(this.source,rF()):new sD(this.source,rq(this.path))}}class sO{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=aR.OVERWRITE}operationForChild(e){return rH(this.path)?new sO(this.source,rF(),this.snap.getImmediateChild(e)):new sO(this.source,rq(this.path),this.snap)}}class sL{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=aR.MERGE}operationForChild(e){if(!rH(this.path))return E(rU(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new sL(this.source,rq(this.path),this.children);{let t=this.children.subtree(new rM(e));return t.isEmpty()?null:t.value?new sO(this.source,rF(),t.value):new sL(this.source,rF(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class sM{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(rH(e))return this.isFullyInitialized()&&!this.filtered_;let t=rU(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class sF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function sU(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw T("Should only compare child_ events.");let i=new r0(t.childName,t.snapshotNode),r=new r0(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{var i,o,a;let l=(i=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,i.index_)),o);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function sV(e,t){return{eventCache:e,serverCache:t}}function sq(e,t,n,i){return sV(new sM(t,n,i),e.serverCache)}function sj(e,t,n,i){return sV(e.eventCache,new sM(t,n,i))}function sB(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function sz(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class s${constructor(e,t=(!u&&(u=new r5(ri)),u)){this.value=e,this.children=t}static fromObject(e){let t=new s$(null);return ra(e,(e,n)=>{t=t.set(new rM(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:rF(),value:this.value};{if(rH(e))return null;let n=rU(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(rq(e),t);return null!=r?{path:r$(new rM(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(rH(e))return this;{let t=rU(e),n=this.children.get(t);return null!==n?n.subtree(rq(e)):new s$(null)}}set(e,t){if(rH(e))return new s$(t,this.children);{let n=rU(e),i=(this.children.get(n)||new s$(null)).set(rq(e),t),r=this.children.insert(n,i);return new s$(this.value,r)}}remove(e){if(rH(e))if(this.children.isEmpty())return new s$(null);else return new s$(null,this.children);{let t=rU(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(rq(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new s$(null):new s$(this.value,i)}}}get(e){if(rH(e))return this.value;{let t=rU(e),n=this.children.get(t);return n?n.get(rq(e)):null}}setTree(e,t){if(rH(e))return t;{let n,i=rU(e),r=(this.children.get(i)||new s$(null)).setTree(rq(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new s$(this.value,n)}}fold(e){return this.fold_(rF(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(r$(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,rF(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(rH(e))return null;let i=rU(e),r=this.children.get(i);return r?r.findOnPath_(rq(e),r$(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,rF(),t)}foreachOnPath_(e,t,n){if(rH(e))return this;{this.value&&n(t,this.value);let i=rU(e),r=this.children.get(i);return r?r.foreachOnPath_(rq(e),r$(t,i),n):new s$(null)}}foreach(e){this.foreach_(rF(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(r$(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class sH{constructor(e){this.writeTree_=e}static empty(){return new sH(new s$(null))}}function sW(e,t,n){if(rH(t))return new sH(new s$(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=rW(r,t);return s=s.updateChild(o,n),new sH(e.writeTree_.set(r,s))}{let i=new s$(n);return new sH(e.writeTree_.setTree(t,i))}}}function sK(e,t,n){let i=e;return ra(n,(e,n)=>{i=sW(i,r$(t,e),n)}),i}function sG(e,t){return rH(t)?sH.empty():new sH(e.writeTree_.setTree(t,new s$(null)))}function sQ(e,t){return null!=sY(e,t)}function sY(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(rW(n.path,t)):null}function sJ(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(sn,(e,n)=>{t.push(new r0(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new r0(e,n.value))}),t}function sX(e,t){if(rH(t))return e;{let n=sY(e,t);return new sH(null!=n?new s$(n):e.writeTree_.subtree(t))}}function sZ(e){return e.writeTree_.isEmpty()}function s0(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(E(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(r$(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(r$(t,".priority"),r)),i}}(rF(),e.writeTree_,t)}function s1(e){return e.visible}function s2(e,t,n){let i=sH.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)rG(n,t)?i=sW(i,e=rW(n,t),s.snap):rG(t,n)&&(e=rW(t,n),i=sW(i,rF(),s.snap.getChild(e)));else if(s.children){if(rG(n,t))i=sK(i,e=rW(n,t),s.children);else if(rG(t,n))if(rH(e=rW(t,n)))i=sK(i,rF(),s.children);else{let t=J(s.children,rU(e));if(t){let n=t.getChild(rq(e));i=sW(i,rF(),n)}}}else throw T("WriteRecord should have .snap or .children")}}return i}function s3(e,t,n,i,r){if(i||r){let s=sX(e.visibleWrites,t);return!r&&sZ(s)?n:r||null!=n||sQ(s,rF())?s0(s2(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(rG(e.path,t)||rG(t,e.path))},t),n||sl.EMPTY_NODE):null}{let i=sY(e.visibleWrites,t);if(null!=i)return i;{let i=sX(e.visibleWrites,t);return sZ(i)?n:null!=n||sQ(i,rF())?s0(i,n||sl.EMPTY_NODE):null}}}function s4(e,t,n,i){return s3(e.writeTree,e.treePath,t,n,i)}function s6(e,t){return function(e,t,n){let i=sl.EMPTY_NODE,r=sY(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(sn,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return sJ(sX(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=sX(e.visibleWrites,t);return n.forEachChild(sn,(e,t)=>{let n=s0(sX(r,new rM(e)),t);i=i.updateImmediateChild(e,n)}),sJ(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function s5(e,t,n,i){return function(e,t,n,i,r){E(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=r$(t,n);if(sQ(e.visibleWrites,s))return null;{let t=sX(e.visibleWrites,s);return sZ(t)?r.getChild(n):s0(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function s8(e,t){var n,i;return n=e.writeTree,i=r$(e.treePath,t),sY(n.visibleWrites,i)}function s9(e,t,n){var i,r;let s,o;return i=e.writeTree,r=e.treePath,s=r$(r,t),null!=(o=sY(i.visibleWrites,s))?o:n.isCompleteForChild(t)?s0(sX(i.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function s7(e,t){return oe(r$(e.treePath,t),e.writeTree)}function oe(e,t){return{treePath:e,writeTree:t}}class ot{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;E("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),E(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,sm(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,sg(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,sp(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,sm(n,e.snapshotNode,i.oldSnap));else throw T("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let on=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class oi{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new sM(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return s9(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:sz(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,o){let a,l=sX(e.visibleWrites,t),h=sY(l,rF());if(null!=h)a=h;else{if(null==n)return[];a=s0(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function or(e,t,n,i,r,s){let o=t.eventCache;if(null!=s8(i,n))return t;{let a,l;if(rH(n))if(E(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=sz(t),r=s6(i,n instanceof sl?n:sl.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=s4(i,sz(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=rU(n);if(".priority"===h){E(1===rV(n),"Can't have a priority with additional path components");let r=o.getNode(),s=s5(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let u,c=rq(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=s5(i,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=s9(i,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,r,s):o.getNode()}}return sq(t,a,o.isFullyInitialized()||rH(n),e.filter.filtersNodes())}}function os(e,t,n,i,r,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(rH(n))l=u.updateFullNode(h.getNode(),i,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=u.updateFullNode(h.getNode(),e,null)}else{let e=rU(n);if(!h.isCompleteForPath(n)&&rV(n)>1)return t;let r=rq(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,r,on,null)}let c=sj(t,l,h.isFullyInitialized()||rH(n),u.filtersNodes()),d=new oi(r,c,s);return or(e,c,n,r,d,a)}function oo(e,t,n,i,r,s,o){let a,l,h=t.eventCache,u=new oi(r,t,s);if(rH(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=sq(t,l,!0,e.filter.filtersNodes());else{let r=rU(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=sq(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=rq(n),c=h.getNode().getImmediateChild(r);if(rH(l))s=i;else{let e=u.getCompleteChild(r);s=null!=e?".priority"===rj(l)&&e.getChild(rz(l)).isEmpty()?e:e.updateChild(l,i):sl.EMPTY_NODE}a=c.equals(s)?t:sq(t,e.filter.updateChild(h.getNode(),r,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function oa(e,t){return e.eventCache.isCompleteForChild(t)}function ol(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function oh(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=rH(n)?i:new s$(null).setTree(n,i);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){let l=ol(e,t.serverCache.getNode().getImmediateChild(n),i);h=os(e,h,new rM(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){let l=ol(e,t.serverCache.getNode().getImmediateChild(n),i);h=os(e,h,new rM(n),l,r,s,o,a)}}),h}class ou{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new sy(n.getIndex()),r=function(e){return e.loadsAllData()?new sy(e.getIndex()):e.hasLimit()?new sv(e):new s_(e)}(n);this.processor_={filter:r};const s=t.serverCache,o=t.eventCache,a=i.updateFullNode(sl.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(sl.EMPTY_NODE,o.getNode(),null),h=new sM(a,s.isFullyInitialized(),i.filtersNodes()),u=new sM(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=sV(u,h),this.eventGenerator_=new sF(this.query_)}get query(){return this.query_}}function oc(e){return 0===e.eventRegistrations_.length}function od(e,t,n){let i=[];if(n){E(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function of(e,t,n,i){var r,s;t.type===aR.MERGE&&null!==t.source.queryId&&(E(sz(e.viewCache_),"We should always have a full cache before handling merges"),E(sB(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){var s,o,a,l,h,u,c,d,f,p,g,m;let y,_,v=new ot;if(n.type===aR.OVERWRITE)n.source.fromUser?y=oo(e,t,n.path,n.snap,i,r,v):(E(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered()&&!rH(n.path),y=os(e,t,n.path,n.snap,i,r,_,v));else if(n.type===aR.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=i,u=r,c=v,d=o,l.foreach((e,t)=>{let n=r$(a,e);oa(o,rU(n))&&(d=oo(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=r$(a,e);oa(o,rU(n))||(d=oo(s,d,n,t,h,u,c))}),y=d):(E(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered(),y=oh(e,t,n.path,n.children,i,r,_,v))}else if(n.type===aR.ACK_USER_WRITE)y=n.revert?function(e,t,n,i,r,s){let o;if(null!=s8(i,n))return t;{let a,l=new oi(i,t,r),h=t.eventCache.getNode();if(rH(n)||".priority"===rU(n)){let n;if(t.serverCache.isFullyInitialized())n=s4(i,sz(t));else{let e=t.serverCache.getNode();E(e instanceof sl,"serverChildren would be complete if leaf node"),n=s6(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=rU(n),u=s9(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=h.getImmediateChild(r)),(a=null!=u?e.filter.updateChild(h,r,u,rq(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,sl.EMPTY_NODE,rq(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=s4(i,sz(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=s8(i,rF()),sq(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,v):function(e,t,n,i,r,s,o){if(null!=s8(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(rH(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return os(e,t,n,l.getNode().getChild(n),r,s,a,o);else{if(!rH(n))return t;let i=new s$(null);return l.getNode().forEachChild(r3,(e,t)=>{i=i.set(new rM(e),t)}),oh(e,t,n,i,r,s,a,o)}{let h=new s$(null);return i.foreach((e,t)=>{let i=r$(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),oh(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,v);else if(n.type===aR.LISTEN_COMPLETE){let r;d=e,f=t,p=n.path,g=i,m=v,r=f.serverCache,y=or(d,sj(f,r.getNode(),r.isFullyInitialized()||rH(p),r.isFiltered()),p,g,on,m)}else throw T("Unknown operation type: "+n.type);let w=v.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=sB(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(sf(sB(t)))}}(t,y,w),{viewCache:y,changes:w}}(e.processor_,o,t,n,i);return r=e.processor_,E((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),E(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),E(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,op(e,a.changes,a.viewCache.eventCache.getNode(),null)}function op(e,t,n,i){var r;let s,o,a=i?[i]:e.eventRegistrations_;return r=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),sU(r,s,"child_removed",t,a,n),sU(r,s,"child_added",t,a,n),sU(r,s,"child_moved",o,a,n),sU(r,s,"child_changed",t,a,n),sU(r,s,"value",t,a,n),s}class og{constructor(){this.views=new Map}}function om(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return E(null!=s,"SyncTree gave us an op for an invalid query."),of(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(of(s,t,n,i));return r}}function oy(e,t,n,i,r){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=s4(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof sl?s6(n,i):sl.EMPTY_NODE,s=!1),new ou(t,sV(new sM(e,s,!1),new sM(i,r,!1)))}return o}function o_(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function ov(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=sz(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!rH(t)&&!n.getImmediateChild(rU(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function ow(e,t){if(t._queryParams.loadsAllData())return oC(e);{let n=t._queryIdentifier;return e.views.get(n)}}function oI(e){return null!=oC(e)}function oC(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let ob=1;class oE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new s$(null),this.pendingWriteTree_={visibleWrites:sH.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function oT(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);E(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=i&&function(e,t){if(e.snap)return rG(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&rG(r$(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:rG(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=s2(n.allWrites,s1,rF()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=sG(e.visibleWrites,r.path):ra(r.children,t=>{e.visibleWrites=sG(e.visibleWrites,r$(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new s$(null);return null!=i.snap?t=t.set(rF(),!0):ra(i.children,e=>{t=t.set(new rM(e),!0)}),oA(e,new sx(i.path,t,n))}}function oS(e,t,n){return oA(e,new sO(sA(),t,n))}function ok(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=ow(o,t))){let u=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=oI(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(od(r,n,i)),oc(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(od(t,n,i)),oc(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!oI(e)&&s.push(new(E(c,"Reference.ts has not been loaded"),c)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=u.removed;if(a=u.events,!r){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>oI(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&oI(t))return[oC(t)];{let e=[];return t&&(e=o_(t)),ra(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=oP(e,i);e.listenProvider_.startListening(oF(r),ox(e,r),s.hashFn,s.onComplete)}}}r||!(d.length>0)||i||(n?e.listenProvider_.stopListening(oF(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(oD(t));e.listenProvider_.stopListening(oF(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=oD(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function oN(e,t,n,i){let r=oO(e,i);if(null==r)return[];{let i=oL(r),s=i.path,o=i.queryId,a=rW(s,t);return oM(e,s,new sO(sP(o),a,n))}}function oR(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=ov(n,rW(e,t));if(i)return i});return s3(i,t,r,n,!0)}function oA(e,t){var n;return function e(t,n,i,r){if(rH(t.path))return function e(t,n,i,r){let s=n.get(rF());null==i&&null!=s&&(i=ov(s,rF()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=s7(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(om(s,t,r,i))),o}(t,n,i,r);{let s=n.get(rF());null==i&&null!=s&&(i=ov(s,rF()));let o=[],a=rU(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=s7(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(om(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,oe(rF(),n)))}function oP(e,t){let n=t.query,i=ox(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||sl.EMPTY_NODE).hash(),onComplete:t=>{var r;if("ok"===t)if(i)return function(e,t,n){let i=oO(e,n);if(!i)return[];{let n=oL(i),r=n.path,s=n.queryId,o=rW(r,t);return oM(e,r,new sD(sP(s),o))}}(e,n._path,i);else return r=n._path,oA(e,new sD(sA(),r));{let i,r,s=(i="Unknown Error","too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(r=Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),r);return ok(e,n,null,s)}}}}function ox(e,t){let n=oD(t);return e.queryToTagMap.get(n)}function oD(e){return e._path.toString()+"$"+e._queryIdentifier}function oO(e,t){return e.tagToQueryMap.get(t)}function oL(e){let t=e.indexOf("$");return E(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new rM(e.substr(0,t))}}function oM(e,t,n){let i=e.syncPointTree_.get(t);return E(i,"Missing sync point for query tag that we're tracking"),om(i,n,oe(t,e.pendingWriteTree_),null)}function oF(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(E(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class oU{constructor(e){this.node_=e}getImmediateChild(e){return new oU(this.node_.getImmediateChild(e))}node(){return this.node_}}class oV{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=r$(this.path_,e);return new oV(this.syncTree_,t)}node(){return oR(this.syncTree_,this.path_)}}let oq=function(e,t,n){return e&&"object"==typeof e?(E(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?oj(e[".sv"],t,n):"object"==typeof e[".sv"]?oB(e[".sv"],t):void E(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},oj=function(e,t,n){if("timestamp"===e)return n.timestamp;E(!1,"Unexpected server value: "+e)},oB=function(e,t,n){e.hasOwnProperty("increment")||E(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&E(!1,"Unexpected increment value: "+i);let r=t.node();if(E(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i};function oz(e,t,n){let i,r=oq(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new st(r))),e.forEachChild(sn,(e,r)=>{let s=oz(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=oq(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new st(i,su(r)):e}}class o${constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function oH(e,t){let n=t instanceof rM?t:new rM(t),i=e,r=rU(n);for(;null!==r;){let e=J(i.node.children,r)||{children:{},childCount:0};i=new o$(r,i,e),r=rU(n=rq(n))}return i}function oW(e){return e.node.value}function oK(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===oW(i)&&!oG(i),s=Y(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function oG(e){return e.node.childCount>0}function oQ(e,t){ra(e.node.children,(n,i)=>{t(new o$(n,e,i))})}function oY(e){return new rM(null===e.parent?e.name:oY(e.parent)+"/"+e.name)}let oJ=/[\[\].#$\/\u0000-\u001F\u007F]/,oX=/[\[\].#$\u0000-\u001F\u007F]/,oZ=function(e){return"string"==typeof e&&0!==e.length&&!oJ.test(e)},o0=function(e){return"string"==typeof e&&0!==e.length&&!oX.test(e)},o1=function(e,t,n){let i=n instanceof rM?new rQ(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+rJ(i));if("function"==typeof t)throw Error(e+"contains a function "+rJ(i)+" with contents = "+t.toString());if(i9(t))throw Error(e+"contains "+t.toString()+" "+rJ(i));if("string"==typeof t&&t.length>3495253.3333333335&&eu(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+rJ(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(ra(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!oZ(t)))throw Error(e+" contains an invalid key ("+t+") "+rJ(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=eu(t),rY(i),o1(e,s,i),o=i.parts_.pop(),i.byteLength_-=eu(o),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+rJ(i)+" in addition to actual children.")}},o2=function(e,t,n,i){if((!i||void 0!==n)&&!o0(n))throw Error(el(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},o3=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),o2(e,t,n,i)},o4=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!oZ(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!o0(n)))throw Error(el(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class o6{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function o5(e,t,n){let i=null;for(let t=0;t<n.length;t++){let r=n[t],s=r.getPath();null===i||rK(s,i.path)||(e.eventLists_.push(i),i=null),null===i&&(i={events:[],path:s}),i.events.push(r)}i&&e.eventLists_.push(i),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();iZ&&i2("event: "+n.toString()),rc(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>rG(e,t)||rG(t,e))}let o8="repo_interrupt";class o9{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new o6,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=sT(),this.transactionQueueTree_=new o$,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function o7(e){var t;let n;return(t=t={timestamp:(n=e.infoData_.getNode(new rM(".info/serverTimeOffset")).val()||0,new Date().getTime()+n)}).timestamp=t.timestamp||new Date().getTime(),t}function ae(e,t,n,i,r){e.dataUpdateCount++;let s=new rM(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){let t=Z(n,e=>su(e));o=function(e,t,n,i){let r=oO(e,i);if(!r)return[];{let i=oL(r),s=i.path,o=i.queryId,a=rW(s,t),l=s$.fromObject(n);return oM(e,s,new sL(sP(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=su(n);o=oN(e.serverSyncTree_,s,t,r)}else if(i){var a;let t,i=Z(n,e=>su(e));a=e.serverSyncTree_,t=s$.fromObject(i),o=oA(a,new sL(sA(),s,t))}else{let t=su(n);o=oS(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=as(e,s)),o5(e.eventQueue_,l,o)}function at(e,t){var n;let i,r,s;an(e,"connected",t),!1===t&&(ai(n=e,"onDisconnectEvents"),i=o7(n),r=sT(),sS(n.onDisconnect_,rF(),(e,t)=>{var s;let o=(s=n.serverSyncTree_,oz(t,new oV(s,e),i));!function e(t,n,i){if(rH(n))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,i);else{let r=rU(n);t.children.has(r)||t.children.set(r,sT()),e(t.children.get(r),n=rq(n),i)}}(r,e,o)}),s=[],sS(r,rF(),(e,t)=>{var i,r;let o,a;s=s.concat(oS(n.serverSyncTree_,e,t));let l=(o=oY(ao(i=n,r=e)),!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(a=oH(i.transactionQueueTree_,r),e=>{ah(i,e)}),ah(i,a),!function e(t,n,i,r){i&&!r&&n(t),oQ(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(a,e=>{ah(i,e)}),o);as(n,l)}),n.onDisconnect_=sT(),o5(n.eventQueue_,rF(),s))}function an(e,t,n){let i=new rM("/.info/"+t),r=su(n);e.infoData_.updateSnapshot(i,r);let s=oS(e.infoSyncTree_,i,r);o5(e.eventQueue_,i,s)}function ai(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),i2(n,...t)}function ar(e,t,n){return oR(e.serverSyncTree_,t,n)||sl.EMPTY_NODE}function as(e,t){let n=ao(e,t),i=oY(n),r=aa(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=rW(n,a.path),h=!1,u;if(E(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,r=r.concat(oT(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",r=r.concat(oT(e.serverSyncTree_,a.currentWriteId,!0));else{let n=ar(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){o1("transaction failed: Data returned ",i,a.path);let t=su(i);"object"==typeof i&&null!=i&&Y(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=o7(e),h=oz(t,new oU(n),l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=e.nextWriteId_++,s.splice(s.indexOf(o),1),r=(r=r.concat(function(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,E(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=sW(s.visibleWrites,t,n)),s.lastWriteId=i,r)?oA(e,new sO(sR(),t,n)):[]}(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(oT(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",r=r.concat(oT(e.serverSyncTree_,a.currentWriteId,!0))}o5(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(u),!1,null))))}al(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)rc(i[e]);!function e(t,n=t.transactionQueueTree_){if(n||al(t,n),oW(n)){let i=aa(t,n);E(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=ar(t,n,i.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<i.length;e++){let t=i[e];E(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=rW(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,r=>{ai(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(oT(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();al(t,oH(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),o5(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)rc(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{i5("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}as(t,n)}},o)}(t,oY(n),i)}else oG(n)&&oQ(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,r,i),i}function ao(e,t){let n,i=e.transactionQueueTree_;for(n=rU(t);null!==n&&void 0===oW(i);)i=oH(i,n),n=rU(t=rq(t));return i}function aa(e,t){let n=[];return function e(t,n,i){let r=oW(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);oQ(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function al(e,t){let n=oW(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,oK(t,n.length>0?n:void 0)}oQ(t,t=>{al(e,t)})}function ah(e,t){let n=oW(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(E(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(E(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(oT(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?oK(t,void 0):n.length=s+1,o5(e.eventQueue_,oY(t),r);for(let e=0;e<i.length;e++)rc(i[e])}}let au=function(e,t){let n=ac(e),i=n.namespace;"firebase.com"===n.domain&&i6(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||i6("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||i8();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new rv(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new rM(n.pathString)}},ac=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):i5(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class ad{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+W(this.snapshot.exportVal())}}class af{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ap{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return E(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class ag{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return rH(this._path)?null:rj(this._path)}get ref(){return new am(this._repo,this._path)}get _queryIdentifier(){let e=rs(sC(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return sC(this._queryParams)}isEqual(e){if(!((e=ec(e))instanceof ag))return!1;let t=this._repo===e._repo,n=rK(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class am extends ag{constructor(e,t){super(e,t,new sw,!1)}get parent(){let e=rz(this._path);return null===e?null:new am(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ay{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new rM(e),n=av(this.ref,e);return new ay(this._node.getChild(t),n,sn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new ay(n,av(this.ref,t),sn)))}hasChild(e){let t=new rM(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function a_(e,t){return(e=ec(e))._checkNotDeleted("ref"),void 0!==t?av(e._root,t):e._root}function av(e,t){return null===rU((e=ec(e))._path)?o3("child","path",t,!1):o2("child","path",t,!1),new am(e._repo,r$(e._path,t))}function aw(e){var t,n,i,r,s;let o,a,l,h,u,c,d;e=ec(e);let f=new aI(new ap(()=>{}));return(t=e._repo,n=e,i=t.serverSyncTree_,a=(r=n)._path,l=null,i.syncPointTree_.foreachOnPath(a,(e,t)=>{let n=rW(e,a);l=l||ov(t,n)}),(h=i.syncPointTree_.get(a))?l=l||ov(h,rF()):(h=new og,i.syncPointTree_=i.syncPointTree_.set(a,h)),c=(u=null!=l)?new sM(l,!0,!1):null,d=(s=i.pendingWriteTree_,oe(r._path,s)),null!=(o=sB(oy(h,r,d,u?c.getNode():sl.EMPTY_NODE,u).viewCache_))?Promise.resolve(o):t.server_.get(n).then(e=>{let i,r=su(e).withIndex(n._queryParams.getIndex());if(!function(e,t,n,i=!1){var r;let s,o,a,l,h=t._path,u=null,c=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=rW(e,h);u=u||ov(t,n),c=c||oI(t)});let d=e.syncPointTree_.get(h);d?(c=c||oI(d),u=u||ov(d,rF())):(d=new og,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=u?s=!0:(s=!1,u=sl.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=ov(t,rF());n&&(u=u.updateImmediateChild(e,n))}));let f=null!=ow(d,t);if(!f&&!t._queryParams.loadsAllData()){let n=oD(t);E(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=ob++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let p=oe(h,e.pendingWriteTree_),g=(o=oy(r=d,t,p,u,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(sn,(e,t)=>{l.push(sp(e,t))}),a.isFullyInitialized()&&l.push(sf(a.getNode())),op(o,l,a.getNode(),n));if(!f&&!c&&!i){let n=ow(d,t);g=g.concat(function(e,t,n){let i=t._path,r=ox(e,t),s=oP(e,n),o=e.listenProvider_.startListening(oF(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)E(!oI(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!rH(e)&&t&&oI(t))return[oC(t).query];{let e=[];return t&&(e=e.concat(o_(t).map(e=>e.query))),ra(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(oF(i),ox(e,i))}}return o}(e,t,n))}}(t.serverSyncTree_,n,f,!0),n._queryParams.loadsAllData())i=oS(t.serverSyncTree_,n._path,r);else{let e=ox(t.serverSyncTree_,n);i=oN(t.serverSyncTree_,n._path,r,e)}return o5(t.eventQueue_,n._path,i),ok(t.serverSyncTree_,n,f,null,!0),r},e=>(ai(t,"get for query "+W(n)+" failed: "+e),Promise.reject(Error(e))))).then(t=>new ay(t,new am(e._repo,e._path),e._queryParams.getIndex()))}class aI{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new ad("value",this,new ay(e.snapshotNode,new am(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new af(this,e,t):null}matches(e){return e instanceof aI&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}E(!c,"__referenceConstructor has already been defined"),c=am,E(!d,"__referenceConstructor has already been defined"),d=am;let aC={};class ab{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var i;let r;if(e.stats_=rE(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new sb(e.repoInfo_,(t,n,i,r)=>{ae(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>at(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{W(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new rZ(e.repoInfo_,t,(t,n,i,r)=>{ae(e,t,n,i,r)},t=>{at(e,t)},t=>{var n;n=e,ra(t,(e,t)=>{an(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),i=e.repoInfo_,rb[r=i.toString()]||(rb[r]=(()=>new sN(e.stats_,e.server_))()),e.statsReporter_=rb[r],e.infoData_=new sE,e.infoSyncTree_=new oE({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=oS(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),an(e,"connected",!1),e.serverSyncTree_=new oE({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);o5(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new am(this._repo,rF())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=aC[t=this.app.name])&&n[e.key]===e||i6(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt(o8),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&i6("Cannot call "+e+" on a deleted database.")}}function aE(e=eX(),t){let n=eH(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let e=(e=>{let t=O(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})("database");e&&function(e,t,n,i={}){var r;let s;(e=ec(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&i6("Cannot call useEmulator() after instance has already been initialized.");let o=e._repoInternal;o.repoInfo_.nodeAdmin?(i.mockUserToken&&i6('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new rg(rg.OWNER)):i.mockUserToken&&(s=new rg("string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[P(JSON.stringify({alg:"none",type:"JWT"})),P(JSON.stringify(s)),""].join(".")}(i.mockUserToken,e.app.options.projectId))),r=s,o.repoInfo_=new rv(`${t}:${n}`,!1,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams,!0),r&&(o.authTokenProvider_=r)}(n,...e)}return n}rZ.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},rZ.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},iz=eY,e$(new ed("database",(e,{instanceIdentifier:t})=>{var n,i,r,s;let o,a,l,h,u,c,d,f=e.getProvider("app").getImmediate(),p=e.getProvider("auth-internal"),g=e.getProvider("app-check-internal");return void 0===(l=t||f.options.databaseURL)&&(f.options.projectId||i6("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),i2("Using default host for project ",f.options.projectId),l=`${f.options.projectId}-default-rtdb.firebaseio.com`),u=(h=au(l,void 0)).repoInfo,void 0!==b.default&&b.default.env&&(c=b.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?u=(h=au(l=`http://${c}?ns=${u.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new rp(f.name,f.options,p),o4("Invalid Firebase Database URL",h),rH(h.path)||i6("Database URL must point to the root of a Firebase Database (not including a child path)."),new ab((n=u,i=f,r=d,s=new rf(f.name,g),(o=aC[i.name])||(o={},aC[i.name]=o),(a=o[n.toURLString()])&&i6("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new o9(n,!1,r,s),o[n.toURLString()]=a,a),f)},"PUBLIC").setMultipleInstances(!0)),e1(ij,iB,void 0),e1(ij,iB,"esm2017");var aT,aS,ak,aN,aR,aA,aP="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,ax={},aD=aD||{},aO=aP||self;function aL(){}function aM(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function aF(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function aU(e,t,n){return e.call.apply(e.bind,arguments)}function aV(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function aq(e,t,n){return(aq=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aU:aV).apply(null,arguments)}function aj(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function aB(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function az(){this.s=this.s,this.o=this.o}az.prototype.s=!1,az.prototype.ra=function(){this.s||(this.s=!0,this.N())},az.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let a$=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function aH(e){let t=e.length;if(0<t){let n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function aW(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(aM(n)){let t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}function aK(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}aK.prototype.h=function(){this.defaultPrevented=!0};var aG=function(){if(!aO.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{aO.addEventListener("test",aL,t),aO.removeEventListener("test",aL,t)}catch(e){}return e}();function aQ(e){return/^[\s\xa0]*$/.test(e)}var aY=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function aJ(){var e=aO.navigator;return e&&(e=e.userAgent)?e:""}function aX(e){return -1!=aJ().indexOf(e)}function aZ(e){return aZ[" "](e),e}function a0(e,t,n){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=n(t)}aZ[" "]=aL;var a1=aX("Opera"),a2=aX("Trident")||aX("MSIE"),a3=aX("Edge"),a4=a3||a2,a6=aX("Gecko")&&!(-1!=aJ().toLowerCase().indexOf("webkit")&&!aX("Edge"))&&!(aX("Trident")||aX("MSIE"))&&!aX("Edge"),a5=-1!=aJ().toLowerCase().indexOf("webkit")&&!aX("Edge");function a8(){var e=aO.document;return e?e.documentMode:void 0}e:{var a9,a7="",le=(a9=aJ(),a6?/rv:([^\);]+)(\)|;)/.exec(a9):a3?/Edge\/([\d\.]+)/.exec(a9):a2?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a9):a5?/WebKit\/(\S+)/.exec(a9):a1?/(?:Version)[ \/]?(\S+)/.exec(a9):void 0);if(le&&(a7=le?le[1]:""),a2){var lt=a8();if(null!=lt&&lt>parseFloat(a7)){y=String(lt);break e}}y=a7}var ln={},li=_=aO.document&&a2&&(a8()||parseInt(y,10))||void 0;function lr(e,t){if(aK.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(a6){e:{try{aZ(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ls[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&lr.$.h.call(this)}}aB(lr,aK);var ls={2:"touch",3:"pen",4:"mouse"};lr.prototype.h=function(){lr.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var lo="closure_listenable_"+(1e6*Math.random()|0),la=0;function ll(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.la=r,this.key=++la,this.fa=this.ia=!1}function lh(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function lu(e,t,n){for(let i in e)t.call(n,e[i],i,e)}function lc(e){let t={};for(let n in e)t[n]=e[n];return t}let ld="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function lf(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t])e[n]=i[n];for(let t=0;t<ld.length;t++)n=ld[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function lp(e){this.src=e,this.g={},this.h=0}function lg(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=a$(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(lh(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function lm(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==i)return r}return -1}lp.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=lm(e,t,i,r);return -1<o?(t=e[o],n||(t.ia=!1)):((t=new ll(t,this.src,s,!!i,r)).ia=n,e.push(t)),t};var ly="closure_lm_"+(1e6*Math.random()|0),l_={};function lv(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=aF(r)?!!r.capture:!!r,a=lb(e);if(a||(e[ly]=a=new lp(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function e(t){return lC.call(e.src,e.listener,t)},n.proxy=i,i.src=e,i.listener=n,e.addEventListener)aG||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(lI(t.toString()),i);else if(e.addListener&&e.removeListener)e.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function lw(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[lo])lg(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(lI(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=lb(t))?(lg(n,e),0==n.h&&(n.src=null,t[ly]=null)):lh(e)}}}function lI(e){return e in l_?l_[e]:l_[e]="on"+e}function lC(e,t){if(e.fa)e=!0;else{t=new lr(t,this);var n=e.listener,i=e.la||e.src;e.ia&&lw(e),e=n.call(i,t)}return e}function lb(e){return(e=e[ly])instanceof lp?e:null}var lE="__closure_events_fn_"+(1e9*Math.random()>>>0);function lT(e){return"function"==typeof e?e:(e[lE]||(e[lE]=function(t){return e.handleEvent(t)}),e[lE])}function lS(){az.call(this),this.i=new lp(this),this.S=this,this.J=null}function lk(e,t){var n,i=e.J;if(i)for(n=[];i;i=i.J)n.push(i);if(e=e.S,i=t.type||t,"string"==typeof t)t=new aK(t,e);else if(t instanceof aK)t.target=t.target||e;else{var r=t;lf(t=new aK(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=lN(o,i,!0,t)&&r}if(r=lN(o=t.g=e,i,!0,t)&&r,r=lN(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=lN(o=t.g=n[s],i,!1,t)&&r}function lN(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&lg(e.i,o),r=!1!==a.call(l,i)&&r}}return r&&!i.defaultPrevented}aB(lS,az),lS.prototype[lo]=!0,lS.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);else(r=aF(r)?!!r.capture:!!r,i=lT(i),t&&t[lo])?(t=t.i,(n=String(n).toString())in t.g&&-1<(i=lm(o=t.g[n],i,r,s))&&(lh(o[i]),Array.prototype.splice.call(o,i,1),0==o.length&&(delete t.g[n],t.h--))):t&&(t=lb(t))&&(n=t.g[n.toString()],t=-1,n&&(t=lm(n,i,r,s)),(i=-1<t?n[t]:null)&&lw(i))}(this,e,t,n,i)},lS.prototype.N=function(){if(lS.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)lh(n[i]);delete t.g[e],t.h--}}this.J=null},lS.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},lS.prototype.P=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var lR=aO.JSON.stringify,lA=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new lP,e=>e.reset());class lP{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function lx(e,t){var n;v||(n=aO.Promise.resolve(void 0),v=function(){n.then(lL)}),lD||(v(),lD=!0),lO.add(e,t)}var lD=!1,lO=new class{constructor(){this.h=this.g=null}add(e,t){let n=lA.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function lL(){let e;for(var t;e=null,lO.g&&(e=lO.g,lO.g=lO.g.next,lO.g||(lO.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){aO.setTimeout(()=>{throw e},0)}(e)}lA.j(t),100>lA.h&&(lA.h++,t.next=lA.g,lA.g=t)}lD=!1}function lM(e,t){lS.call(this),this.h=e||1,this.g=t||aO,this.j=aq(this.qb,this),this.l=Date.now()}function lF(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function lU(e,t,n){if("function"==typeof e)n&&(e=aq(e,n));else if(e&&"function"==typeof e.handleEvent)e=aq(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:aO.setTimeout(e,t||0)}aB(lM,lS),(aA=lM.prototype).ga=!1,aA.T=null,aA.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),lk(this,"tick"),this.ga&&(lF(this),this.start()))}},aA.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},aA.N=function(){lM.$.N.call(this),lF(this),delete this.g};class lV extends az{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=lU(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(aO.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function lq(e){az.call(this),this.h=e,this.g={}}aB(lq,az);var lj=[];function lB(e,t,n,i){Array.isArray(n)||(n&&(lj[0]=n.toString()),n=lj);for(var r=0;r<n.length;r++){var s=function e(t,n,i,r,s){if(r&&r.once)return function e(t,n,i,r,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=lT(i),t&&t[lo]?t.P(n,i,aF(r)?!!r.capture:!!r,s):lv(t,n,i,!0,r,s)}(t,n,i,r,s);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=lT(i),t&&t[lo]?t.O(n,i,aF(r)?!!r.capture:!!r,s):lv(t,n,i,!1,r,s)}(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function lz(e){lu(e.g,function(e,t){this.g.hasOwnProperty(t)&&lw(e)},e),e.g={}}function l$(){this.g=!0}function lH(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}}return lR(n)}catch(e){return t}}(e,n)+(i?" "+i:"")})}lq.prototype.N=function(){lq.$.N.call(this),lz(this)},lq.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},l$.prototype.Ea=function(){this.g=!1},l$.prototype.info=function(){};var lW={},lK=null;function lG(){return lK=lK||new lS}function lQ(e){aK.call(this,lW.Ta,e)}function lY(e){let t=lG();lk(t,new lQ(t))}function lJ(e,t){aK.call(this,lW.STAT_EVENT,e),this.stat=t}function lX(e){let t=lG();lk(t,new lJ(t,e))}function lZ(e,t){aK.call(this,lW.Ua,e),this.size=t}function l0(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return aO.setTimeout(function(){e()},t)}lW.Ta="serverreachability",aB(lQ,aK),lW.STAT_EVENT="statevent",aB(lJ,aK),lW.Ua="timingevent",aB(lZ,aK);var l1={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},l2={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function l3(){}function l4(e){return e.h||(e.h=e.i())}function l6(){}l3.prototype.h=null;var l5={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function l8(){aK.call(this,"d")}function l9(){aK.call(this,"c")}function l7(){}function he(e,t,n,i){this.l=e,this.j=t,this.m=n,this.W=i||1,this.U=new lq(this),this.P=hn,e=a4?125:void 0,this.V=new lM(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.aa=-1,this.J=!1,this.O=0,this.M=null,this.ca=this.K=this.ba=this.S=!1,this.h=new ht}function ht(){this.i=null,this.g="",this.h=!1}aB(l8,aK),aB(l9,aK),aB(l7,l3),l7.prototype.g=function(){return new XMLHttpRequest},l7.prototype.i=function(){return{}},w=new l7;var hn=45e3,hi={},hr={};function hs(e,t,n){e.L=1,e.v=hb(h_(t)),e.s=n,e.S=!0,ho(e,null)}function ho(e,t){e.G=Date.now(),hh(e),e.A=h_(e.v);var n,i,r,s,o,a,l=e.A,h=e.W;Array.isArray(h)||(h=[String(h)]),hM(l.i,"t",h),e.C=0,l=e.l.I,e.h=new ht,e.g=uT(e.l,l?t:null,!e.s),0<e.O&&(e.M=new lV(aq(e.Pa,e,e.g),e.O)),lB(e.U,e.g,"readystatechange",e.nb),t=e.I?lc(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),lY(),n=e.j,i=e.u,r=e.A,s=e.m,o=e.W,a=e.s,n.info(function(){if(n.g)if(a)for(var e="",t=a.split("&"),l=0;l<t.length;l++){var h=t[l].split("=");if(1<h.length){var u=h[0];h=h[1];var c=u.split("_");e=2<=c.length&&"type"==c[1]?e+(u+"=")+h+"&":e+(u+"=redacted&")}}else e=null;else e=a;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+i+"\n"+r+"\n"+e})}function ha(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function hl(e,t,n){let i=!0,r;for(;!e.J&&e.C<n.length;)if((r=function(e,t){var n=e.C,i=t.indexOf("\n",n);return -1==i?hr:isNaN(n=Number(t.substring(n,i)))?hi:(i+=1)+n>t.length?hr:(t=t.substr(i,n),e.C=i+n,t)}(e,n))==hr){4==t&&(e.o=4,lX(14),i=!1),lH(e.j,e.m,null,"[Incomplete Response]");break}else if(r==hi){e.o=4,lX(15),lH(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}else lH(e.j,e.m,r,null),hp(e,r);ha(e)&&r!=hr&&r!=hi&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,lX(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ca&&(e.ca=!0,(t=e.l).g==e&&t.ca&&!t.L&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),uy(t),t.L=!0,lX(11))):(lH(e.j,e.m,n,"[Invalid Chunked Response]"),hf(e),hd(e))}function hh(e){e.Y=Date.now()+e.P,hu(e,e.P)}function hu(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=l0(aq(e.lb,e),t)}function hc(e){e.B&&(aO.clearTimeout(e.B),e.B=null)}function hd(e){0==e.l.H||e.J||uw(e.l,e)}function hf(e){hc(e);var t=e.M;t&&"function"==typeof t.ra&&t.ra(),e.M=null,lF(e.V),lz(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ra())}function hp(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||hz(n.h,e))){if(!e.K&&hz(n.h,e)&&3==n.H){try{var i=n.Ja.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g)if(n.g.G+3e3<e.G)uv(n),uh(n);else break e;um(n),lX(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.M&&0==n.A&&!n.v&&(n.v=l0(aq(n.ib,n),6e3));if(1>=hB(n.h)&&n.na){try{n.na()}catch(e){}n.na=void 0}}else uC(n,11)}else if((e.K||n.g==e)&&uv(n),!aQ(t))for(r=n.Ja.g.parse(t),t=0;t<r.length;t++){let a=r[t];if(n.V=a[0],a=a[1],2==n.H)if("c"==a[0]){n.J=a[1],n.oa=a[2];let t=a[3];null!=t&&(n.qa=t,n.j.info("VER="+n.qa));let r=a[4];null!=r&&(n.Ga=r,n.j.info("SVER="+n.Ga));let l=a[5];null!=l&&"number"==typeof l&&0<l&&(n.K=i=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(h$(s,s.h),s.h=null))}if(i.F){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.Da=e,hC(i.G,i.F,e))}}if(n.H=3,n.l&&n.l.Ba(),n.ca&&(n.S=Date.now()-e.G,n.j.info("Handshake RTT: "+n.S+"ms")),(i=n).wa=uE(i,i.I?i.oa:null,i.Y),e.K){hH(i.h,e);var o=i.K;o&&e.setTimeout(o),e.B&&(hc(e),hh(e)),i.g=e}else ug(i);0<n.i.length&&uc(n)}else"stop"!=a[0]&&"close"!=a[0]||uC(n,7);else 3==n.H&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?uC(n,7):ul(n):"noop"!=a[0]&&n.l&&n.l.Aa(a),n.A=0)}}lY(4)}catch(e){}}function hg(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(aM(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.sa&&"function"==typeof e.sa)return e.sa();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(aM(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let i in t=[],n=0,e)t[n++]=i;return t}}}(e),i=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(aM(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}(aA=he.prototype).setTimeout=function(e){this.P=e},aA.nb=function(e){e=e.target;let t=this.M;t&&3==un(e)?t.l():this.Pa(e)},aA.Pa=function(e){try{if(e==this.g)e:{let m=un(this.g);var t=this.g.Ia();let y=this.g.da();if(!(3>m)&&(3!=m||a4||this.g&&(this.h.h||this.g.ja()||ui(this.g)))){this.J||4!=m||7==t||(8==t||0>=y?lY(3):lY(2)),hc(this);var n=this.g.da();this.aa=n;t:if(ha(this)){var i=ui(this.g);e="";var r=i.length,s=4==un(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){hf(this),hd(this);var o="";break t}this.h.i=new aO.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.splice(0,r),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,a=this.j,l=this.u,h=this.A,u=this.m,c=this.W,d=n,a.info(function(){return"XMLHTTP RESP ("+u+") [ attempt "+c+"]: "+l+"\n"+h+"\n"+m+" "+d}),this.i){if(this.ba&&!this.K){t:{if(this.g){var a,l,h,u,c,d,f,p=this.g;if((f=p.g?p.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!aQ(f)){var g=f;break t}}g=null}if(n=g)lH(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hp(this,n);else{this.i=!1,this.o=3,lX(12),hf(this),hd(this);break e}}this.S?(hl(this,m,o),a4&&this.i&&3==m&&(lB(this.U,this.V,"tick",this.mb),this.V.start())):(lH(this.j,this.m,o,null),hp(this,o)),4==m&&hf(this),this.i&&!this.J&&(4==m?uw(this.l,this):(this.i=!1,hh(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,lX(12)):(this.o=0,lX(13)),hf(this),hd(this)}}}catch(e){}finally{}},aA.mb=function(){if(this.g){var e=un(this.g),t=this.g.ja();this.C<t.length&&(hc(this),hl(this,e,t),this.i&&4!=e&&hh(this))}},aA.cancel=function(){this.J=!0,hf(this)},aA.lb=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(lY(),lX(17)),hf(this),this.o=2,hd(this)):hu(this,this.Y-n)};var hm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hy(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof hy){this.h=void 0!==t?t:e.h,hv(this,e.j),this.s=e.s,this.g=e.g,hw(this,e.m),this.l=e.l,t=e.i;var n=new hx;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),hI(this,n),this.o=e.o}else e&&(n=String(e).match(hm))?(this.h=!!t,hv(this,n[1]||"",!0),this.s=hE(n[2]||""),this.g=hE(n[3]||"",!0),hw(this,n[4]),this.l=hE(n[5]||"",!0),hI(this,n[6]||"",!0),this.o=hE(n[7]||"")):(this.h=!!t,this.i=new hx(null,this.h))}function h_(e){return new hy(e)}function hv(e,t,n){e.j=n?hE(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function hw(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function hI(e,t,n){var i,r;t instanceof hx?(e.i=t,i=e.i,(r=e.h)&&!i.j&&(hD(i),i.i=null,i.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(hO(this,t),hM(this,n,e))},i)),i.j=r):(n||(t=hT(t,hA)),e.i=new hx(t,e.h))}function hC(e,t,n){e.i.set(t,n)}function hb(e){return hC(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function hE(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function hT(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,hS),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function hS(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}hy.prototype.toString=function(){var e=[],t=this.j;t&&e.push(hT(t,hk,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(hT(t,hk,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(hT(n,"/"==n.charAt(0)?hR:hN,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",hT(n,hP)),e.join("")};var hk=/[#\/\?@]/g,hN=/[#\?:]/g,hR=/[#\?]/g,hA=/[#\?@]/g,hP=/#/g;function hx(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function hD(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function hO(e,t){hD(e),t=hF(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function hL(e,t){return hD(e),t=hF(e,t),e.g.has(t)}function hM(e,t,n){hO(e,t),0<n.length&&(e.i=null,e.g.set(hF(e,t),aH(n)),e.h+=n.length)}function hF(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(aA=hx.prototype).add=function(e,t){hD(this),this.i=null,e=hF(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},aA.forEach=function(e,t){hD(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},aA.sa=function(){hD(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){let r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},aA.Z=function(e){hD(this);let t=[];if("string"==typeof e)hL(this,e)&&(t=t.concat(this.g.get(hF(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},aA.set=function(e,t){return hD(this),this.i=null,hL(this,e=hF(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},aA.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},aA.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];let s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),e.push(r)}}return this.i=e.join("&")};var hU=class{constructor(e,t){this.h=e,this.g=t}};function hV(e){this.l=e||hq,e=aO.PerformanceNavigationTiming?0<(e=aO.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(aO.g&&aO.g.Ka&&aO.g.Ka()&&aO.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var hq=10;function hj(e){return!!e.h||!!e.g&&e.g.size>=e.j}function hB(e){return e.h?1:e.g?e.g.size:0}function hz(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function h$(e,t){e.g?e.g.add(t):e.h=t}function hH(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function hW(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return aH(e.i)}function hK(){}function hG(){this.g=new hK}function hQ(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(e){}}function hY(e){this.l=e.fc||null,this.j=e.ob||!1}function hJ(e,t){lS.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=hX,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}hV.prototype.cancel=function(){if(this.i=hW(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}},hK.prototype.stringify=function(e){return aO.JSON.stringify(e,void 0)},hK.prototype.parse=function(e){return aO.JSON.parse(e,void 0)},aB(hY,l3),hY.prototype.g=function(){return new hJ(this.l,this.j)},hY.prototype.i=(m={},function(){return m}),aB(hJ,lS);var hX=0;function hZ(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function h0(e){e.readyState=4,e.l=null,e.j=null,e.A=null,h1(e)}function h1(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(aA=hJ.prototype).open=function(e,t){if(this.readyState!=hX)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,h1(this)},aA.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||aO).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},aA.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,h0(this)),this.readyState=hX},aA.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,h1(this)),this.g&&(this.readyState=3,h1(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==aO.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hZ(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},aA.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?h0(this):h1(this),3==this.readyState&&hZ(this)}},aA.Za=function(e){this.g&&(this.response=this.responseText=e,h0(this))},aA.Ya=function(e){this.g&&(this.response=e,h0(this))},aA.ka=function(){this.g&&h0(this)},aA.setRequestHeader=function(e,t){this.v.append(e,t)},aA.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},aA.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(hJ.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var h2=aO.JSON.parse;function h3(e){lS.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=h4,this.L=this.M=!1}aB(h3,lS);var h4="",h6=/^https?$/i,h5=["POST","PUT"];function h8(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,h9(e),ue(e)}function h9(e){e.F||(e.F=!0,lk(e,"complete"),lk(e,"error"))}function h7(e){if(e.h&&void 0!==aD&&(!e.C[1]||4!=un(e)||2!=e.da())){if(e.v&&4==un(e))lU(e.La,0,e);else if(lk(e,"readystatechange"),4==un(e)){e.h=!1;try{let a=e.da();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,i=!0;break;default:i=!1}if(!(t=i)){if(n=0===a){var r=String(e.I).match(hm)[1]||null;if(!r&&aO.self&&aO.self.location){var s=aO.self.location.protocol;r=s.substr(0,s.length-1)}n=!h6.test(r?r.toLowerCase():"")}t=n}if(t)lk(e,"complete"),lk(e,"success");else{e.m=6;try{var o=2<un(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.da()+"]",h9(e)}}finally{ue(e)}}}}function ue(e,t){if(e.g){ut(e);let n=e.g,i=e.C[0]?aL:null;e.g=null,e.C=null,t||lk(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function ut(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(aO.clearTimeout(e.A),e.A=null)}function un(e){return e.g?e.g.readyState:0}function ui(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case h4:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ur(e){let t="";return lu(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function us(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=ur(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):hC(e,t,n))}function uo(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function ua(e){this.Ga=0,this.i=[],this.j=new l$,this.oa=this.wa=this.G=this.Y=this.g=this.Da=this.F=this.ma=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=uo("failFast",!1,e),this.M=this.v=this.u=this.m=this.l=null,this.aa=!0,this.ta=this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=uo("baseRetryDelayMs",5e3,e),this.hb=uo("retryDelaySeedMs",1e4,e),this.eb=uo("forwardChannelMaxRetries",2,e),this.xa=uo("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.K=void 0,this.I=e&&e.supportsCrossDomainXhr||!1,this.J="",this.h=new hV(e&&e.concurrentRequestLimit),this.Ja=new hG,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.j.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.na=void 0,this.S=0,this.L=!1,this.pa=this.B=null}function ul(e){if(uu(e),3==e.H){var t=e.W++,n=h_(e.G);hC(n,"SID",e.J),hC(n,"RID",t),hC(n,"TYPE","terminate"),uf(e,n),(t=new he(e,e.j,t,void 0)).L=2,t.v=hb(h_(n)),n=!1,aO.navigator&&aO.navigator.sendBeacon&&(n=aO.navigator.sendBeacon(t.v.toString(),"")),!n&&aO.Image&&((new Image).src=t.v,n=!0),n||(t.g=uT(t.l,null),t.g.ha(t.v)),t.G=Date.now(),hh(t)}ub(e)}function uh(e){e.g&&(uy(e),e.g.cancel(),e.g=null)}function uu(e){uh(e),e.u&&(aO.clearTimeout(e.u),e.u=null),uv(e),e.h.cancel(),e.m&&("number"==typeof e.m&&aO.clearTimeout(e.m),e.m=null)}function uc(e){hj(e.h)||e.m||(e.m=!0,lx(e.Na,e),e.C=0)}function ud(e,t){var n;n=t?t.m:e.W++;let i=h_(e.G);hC(i,"SID",e.J),hC(i,"RID",n),hC(i,"AID",e.V),uf(e,i),e.o&&e.s&&us(i,e.o,e.s),n=new he(e,e.j,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.i=t.F.concat(e.i)),t=up(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),h$(e.h,n),hs(n,i,t)}function uf(e,t){e.ma&&lu(e.ma,function(e,n){hC(t,n,e)}),e.l&&hg({},function(e,n){hC(t,n,e)})}function up(e,t,n){n=Math.min(e.i.length,n);var i=e.l?aq(e.l.Va,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=r[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=r[o].h,a=r[o].g;if(0>(n-=t))t=Math.max(0,r[o].h-100),s=!1;else try{!function(e,t,n){let i=n||"";try{hg(e,function(e,n){let r=e;aF(e)&&(r=lR(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(s){i=e.join("&");break e}}}return t.F=e=e.i.splice(0,n),i}function ug(e){e.g||e.u||(e.ba=1,lx(e.Ma,e),e.A=0)}function um(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.ba++,e.u=l0(aq(e.Ma,e),uI(e,e.A)),e.A++,!0)}function uy(e){null!=e.B&&(aO.clearTimeout(e.B),e.B=null)}function u_(e){e.g=new he(e,e.j,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=h_(e.wa);hC(t,"RID","rpc"),hC(t,"SID",e.J),hC(t,"CI",e.M?"0":"1"),hC(t,"AID",e.V),hC(t,"TYPE","xmlhttp"),uf(e,t),e.o&&e.s&&us(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.oa,n.L=1,n.v=hb(h_(t)),n.s=null,n.S=!0,ho(n,e)}function uv(e){null!=e.v&&(aO.clearTimeout(e.v),e.v=null)}function uw(e,t){var n,i=null;if(e.g==t){uv(e),uy(e),e.g=null;var r=2}else{if(!hz(e.h,t))return;i=t.F,hH(e.h,t),r=1}if(0!=e.H){if(e.ta=t.aa,t.i)if(1==r){i=t.s?t.s.length:0,t=Date.now()-t.G;var s=e.C;lk(r=lG(),new lZ(r,i)),uc(e)}else ug(e);else if(3==(s=t.o)||0==s&&0<e.ta||!(1==r&&(n=t,!(hB(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.F.concat(e.i),!0):1!=e.H&&2!=e.H&&!(e.C>=(e.cb?0:e.eb))&&(e.m=l0(aq(e.Na,e,n),uI(e,e.C)),e.C++,!0)))||2==r&&um(e)))switch(i&&0<i.length&&((t=e.h).i=t.i.concat(i)),s){case 1:uC(e,5);break;case 4:uC(e,10);break;case 3:uC(e,6);break;default:uC(e,2)}}}function uI(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.l||(n*=2),n*t}function uC(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var i=aq(e.pb,e);n||(n=new hy("//www.google.com/images/cleardot.gif"),aO.location&&"http"==aO.location.protocol||hv(n,"https"),hb(n));var r=n.toString();let t=new l$;if(aO.Image){let e=new Image;e.onload=aj(hQ,t,e,"TestLoadImage: loaded",!0,i),e.onerror=aj(hQ,t,e,"TestLoadImage: error",!1,i),e.onabort=aj(hQ,t,e,"TestLoadImage: abort",!1,i),e.ontimeout=aj(hQ,t,e,"TestLoadImage: timeout",!1,i),aO.setTimeout(function(){e.ontimeout&&e.ontimeout()},1e4),e.src=r}else i(!1)}else lX(2);e.H=0,e.l&&e.l.za(t),ub(e),uu(e)}function ub(e){if(e.H=0,e.pa=[],e.l){let t=hW(e.h);(0!=t.length||0!=e.i.length)&&(aW(e.pa,t),aW(e.pa,e.i),e.h.i.length=0,aH(e.i),e.i.length=0),e.l.ya()}}function uE(e,t,n){var i=n instanceof hy?h_(n):new hy(n,void 0);if(""!=i.g)t&&(i.g=t+"."+i.g),hw(i,i.m);else{var r=aO.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new hy(null,void 0);i&&hv(s,i),t&&(s.g=t),r&&hw(s,r),n&&(s.l=n),i=s}return n=e.F,t=e.Da,n&&t&&hC(i,n,t),hC(i,"VER",e.qa),uf(e,i),i}function uT(e,t,n){if(t&&!e.I)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new h3(n&&e.Ha&&!e.va?new hY({ob:!0}):e.va)).Oa(e.I),t}function uS(){}function uk(){if(a2&&!(10<=Number(li)))throw Error("Environmental error: no available transport.")}function uN(e,t){lS.call(this),this.g=new ua(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!aQ(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!aQ(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new uP(this)}function uR(e){l8.call(this);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function uA(){l9.call(this),this.status=1}function uP(e){this.g=e}function ux(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function uD(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],o=t+(s^n&(r^s))+i[0]+0xd76aa478|0;o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[1]+0xe8c7b756|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[2]+0x242070db|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[3]+0xc1bdceee|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[4]+0xf57c0faf|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[5]+0x4787c62a|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[6]+0xa8304613|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[7]+0xfd469501|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[8]+0x698098d8|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[9]+0x8b44f7af|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[10]+0xffff5bb1|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[11]+0x895cd7be|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[12]+0x6b901122|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[13]+0xfd987193|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[14]+0xa679438e|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[15]+0x49b40821|0,n=r+(o<<22|o>>>10),o=t+(r^s&(n^r))+i[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[11]+0x265e5a51|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[0]+0xe9b6c7aa|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[15]+0xd8a1e681|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[4]+0xe7d3fbc8|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[3]+0xf4d50d87|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[8]+0x455a14ed|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[7]+0x676f02d9|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[12]+0x8d2a4c8a|0,o=t+((n=r+(o<<20|o>>>12))^r^s)+i[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[8]+0x8771f681|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[11]+0x6d9d6122|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[14]+0xfde5380c|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[4]+0x4bdecfa9|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[7]+0xf6bb4b60|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[10]+0xbebfbc70|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[0]+0xeaa127fa|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[3]+0xd4ef3085|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[6]+0x4881d05|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[12]+0xe6db99e5|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[15]+0x1fa27cf8|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[2]+0xc4ac5665|0,n=r+(o<<23|o>>>9),o=t+(r^(n|~s))+i[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[14]+0xab9423a7|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[5]+0xfc93a039|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[10]+0xffeff47d|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[1]+0x85845dd1|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[6]+0xa3014314|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[13]+0x4e0811a1|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[2]+0x2ad7d2bb|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(r+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+r|0,e.g[3]=e.g[3]+s|0}function uO(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}(aA=h3.prototype).Oa=function(e){this.M=e},aA.ha=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():w.g(),this.C=this.u?l4(this.u):l4(w),this.g.onreadystatechange=aq(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){h8(this,e);return}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[s,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=aO.FormData&&e instanceof aO.FormData,!(0<=a$(h5,t))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{var s;ut(this),0<this.B&&((this.L=(s=this.g,a2&&a0(ln,9,function(){let e=0,t=aY(String(y)).split("."),n=aY("9").split("."),i=Math.max(t.length,n.length);for(let d=0;0==e&&d<i;d++){var r,s,o,a,l,h,u=t[d]||"",c=n[d]||"";do{if(u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],c=/(\d*)(\D*)(.*)/.exec(c)||["","","",""],0==u[0].length&&0==c[0].length)break;e=(r=0==u[1].length?0:parseInt(u[1],10),s=0==c[1].length?0:parseInt(c[1],10),(r<s?-1:+(r>s))||(o=0==u[2].length,a=0==c[2].length,o<a?-1:+(o>a))||(l=u[2],h=c[2],l<h?-1:+(l>h))),u=u[3],c=c[3]}while(0==e)}return 0<=e})&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=aq(this.ua,this)):this.A=lU(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){h8(this,e)}},aA.ua=function(){void 0!==aD&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,lk(this,"timeout"),this.abort(8))},aA.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,lk(this,"complete"),lk(this,"abort"),ue(this))},aA.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ue(this,!0)),h3.$.N.call(this)},aA.La=function(){this.s||(this.G||this.v||this.l?h7(this):this.kb())},aA.kb=function(){h7(this)},aA.da=function(){try{return 2<un(this)?this.g.status:-1}catch(e){return -1}},aA.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},aA.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),h2(t)}},aA.Ia=function(){return this.m},aA.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(aA=ua.prototype).qa=8,aA.H=1,aA.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let r=new he(this,this.j,e,void 0),s=this.s;if(this.U&&(s?lf(s=lc(s),this.U):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var i=this.i[n];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)){i=i.length;break t}i=void 0}if(void 0===i)break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=up(this,r,t),hC(n=h_(this.G),"RID",e),hC(n,"CVER",22),this.F&&hC(n,"X-HTTP-Session-Id",this.F),uf(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(ur(s)))+"&"+t:this.o&&us(n,this.o,s)),h$(this.h,r),this.bb&&hC(n,"TYPE","init"),this.P?(hC(n,"$req",t),hC(n,"SID","null"),r.ba=!0,hs(r,n,null)):hs(r,n,t),this.H=2}}else 3==this.H&&(e?ud(this,e):0==this.i.length||hj(this.h)||ud(this))},aA.Ma=function(){if(this.u=null,u_(this),this.ca&&!(this.L||null==this.g||0>=this.S)){var e=2*this.S;this.j.info("BP detection timer enabled: "+e),this.B=l0(aq(this.jb,this),e)}},aA.jb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.M=!1,this.L=!0,lX(10),uh(this),u_(this))},aA.ib=function(){null!=this.v&&(this.v=null,uh(this),um(this),lX(19))},aA.pb=function(e){e?(this.j.info("Successfully pinged google.com"),lX(2)):(this.j.info("Failed to ping google.com"),lX(1))},(aA=uS.prototype).Ba=function(){},aA.Aa=function(){},aA.za=function(){},aA.ya=function(){},aA.Va=function(){},uk.prototype.g=function(e,t){return new uN(e,t)},aB(uN,lS),uN.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.I=!0);var e=this.g,t=this.l,n=this.h||void 0;lX(0),e.Y=t,e.ma=n||{},e.M=e.aa,e.G=uE(e,null,e.Y),uc(e)},uN.prototype.close=function(){ul(this.g)},uN.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=lR(e),e=n);t.i.push(new hU(t.fb++,e)),3==t.H&&uc(t)},uN.prototype.N=function(){this.g.l=null,delete this.j,ul(this.g),delete this.g,uN.$.N.call(this)},aB(uR,l8),aB(uA,l9),aB(uP,uS),uP.prototype.Ba=function(){lk(this.g,"a")},uP.prototype.Aa=function(e){lk(this.g,new uR(e))},uP.prototype.za=function(e){lk(this.g,new uA)},uP.prototype.ya=function(){lk(this.g,"b")},aB(ux,function(){this.blockSize=-1}),ux.prototype.reset=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.i=this.h=0},ux.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.m,r=this.h,s=0;s<t;){if(0==r)for(;s<=n;)uD(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(i[r++]=e.charCodeAt(s++),r==this.blockSize){uD(this,i),r=0;break}}else for(;s<t;)if(i[r++]=e[s++],r==this.blockSize){uD(this,i),r=0;break}}this.h=r,this.i+=t},ux.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var uL={};function uM(e){return -128<=e&&128>e?a0(uL,e,function(e){return new uO([0|e],0>e?-1:0)}):new uO([0|e],0>e?-1:0)}function uF(e){if(isNaN(e)||!isFinite(e))return uV;if(0>e)return u$(uF(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=uU;return new uO(t,0)}var uU=0x100000000,uV=uM(0),uq=uM(1),uj=uM(0x1000000);function uB(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function uz(e){return -1==e.h}function u$(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new uO(n,~e.h).add(uq)}function uH(e,t){return e.add(u$(t))}function uW(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function uK(e,t){this.g=e,this.h=t}function uG(e,t){if(uB(t))throw Error("division by zero");if(uB(e))return new uK(uV,uV);if(uz(e))return t=uG(u$(e),t),new uK(u$(t.g),u$(t.h));if(uz(t))return t=uG(e,u$(t)),new uK(u$(t.g),t.h);if(30<e.g.length){if(uz(e)||uz(t))throw Error("slowDivide_ only works with positive integers.");for(var n=uq,i=t;0>=i.X(e);)n=uQ(n),i=uQ(i);var r=uY(n,1),s=uY(i,1);for(i=uY(i,2),n=uY(n,2);!uB(i);){var o=s.add(i);0>=o.X(e)&&(r=r.add(n),s=o),i=uY(i,1),n=uY(n,1)}return t=uH(e,r.R(t)),new uK(r,t)}for(r=uV;0<=e.X(t);){for(i=48>=(i=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,i-48),o=(s=uF(n)).R(t);uz(o)||0<o.X(e);)n-=i,o=(s=uF(n)).R(t);uB(s)&&(s=uq),r=r.add(s),e=uH(e,o)}return new uK(r,e)}function uQ(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.D(i)<<1|e.D(i-1)>>>31;return new uO(n,e.h)}function uY(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,r=[],s=0;s<i;s++)r[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new uO(r,e.h)}(aA=uO.prototype).ea=function(){if(uz(this))return-u$(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.D(n);e+=(0<=i?i:uU+i)*t,t*=uU}return e},aA.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(uB(this))return"0";if(uz(this))return"-"+u$(this).toString(e);for(var t=uF(Math.pow(e,6)),n=this,i="";;){var r=uG(n,t).g,s=((0<(n=uH(n,r.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(uB(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},aA.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},aA.X=function(e){return uz(e=uH(this,e))?-1:+!uB(e)},aA.abs=function(){return uz(this)?u$(this):this},aA.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,r=0;r<=t;r++){var s=i+(65535&this.D(r))+(65535&e.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(e.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new uO(n,-0x80000000&n[n.length-1]?-1:0)},aA.R=function(e){if(uB(this)||uB(e))return uV;if(uz(this))return uz(e)?u$(this).R(u$(e)):u$(u$(this).R(e));if(uz(e))return u$(this.R(u$(e)));if(0>this.X(uj)&&0>e.X(uj))return uF(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<e.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=e.D(r)>>>16,l=65535&e.D(r);n[2*i+2*r]+=o*l,uW(n,2*i+2*r),n[2*i+2*r+1]+=s*l,uW(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,uW(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,uW(n,2*i+2*r+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new uO(n,0)},aA.gb=function(e){return uG(this,e).h},aA.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)&e.D(i);return new uO(n,this.h&e.h)},aA.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)|e.D(i);return new uO(n,this.h|e.h)},aA.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)^e.D(i);return new uO(n,this.h^e.h)},uk.prototype.createWebChannel=uk.prototype.g,uN.prototype.send=uN.prototype.u,uN.prototype.open=uN.prototype.m,uN.prototype.close=uN.prototype.close,l1.NO_ERROR=0,l1.TIMEOUT=8,l1.HTTP_ERROR=6,l2.COMPLETE="complete",l6.EventType=l5,l5.OPEN="a",l5.CLOSE="b",l5.ERROR="c",l5.MESSAGE="d",lS.prototype.listen=lS.prototype.O,h3.prototype.listenOnce=h3.prototype.P,h3.prototype.getLastError=h3.prototype.Sa,h3.prototype.getLastErrorCode=h3.prototype.Ia,h3.prototype.getStatus=h3.prototype.da,h3.prototype.getResponseJson=h3.prototype.Wa,h3.prototype.getResponseText=h3.prototype.ja,h3.prototype.send=h3.prototype.ha,h3.prototype.setWithCredentials=h3.prototype.Oa,ux.prototype.digest=ux.prototype.l,ux.prototype.reset=ux.prototype.reset,ux.prototype.update=ux.prototype.j,uO.prototype.add=uO.prototype.add,uO.prototype.multiply=uO.prototype.R,uO.prototype.modulo=uO.prototype.gb,uO.prototype.compare=uO.prototype.X,uO.prototype.toNumber=uO.prototype.ea,uO.prototype.toString=uO.prototype.toString,uO.prototype.getBits=uO.prototype.D,uO.fromNumber=uF,uO.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return u$(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=uF(Math.pow(n,8)),r=uV,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=uF(Math.pow(n,o)),r=r.R(o).add(uF(a))):r=(r=r.R(i)).add(uF(a))}return r};var uJ=ax.createWebChannelTransport=function(){return new uk},uX=ax.getStatEventTarget=function(){return lG()},uZ=ax.ErrorCode=l1,u0=ax.EventType=l2,u1=ax.Event=lW,u2=ax.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},u3=ax.FetchXmlHttpFactory=hY,u4=ax.WebChannel=l6,u6=ax.XhrIo=h3,u5=ax.Md5=ux,u8=ax.Integer=uO;let u9="@firebase/firestore";class u7{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}u7.UNAUTHENTICATED=new u7(null),u7.GOOGLE_CREDENTIALS=new u7("google-credentials-uid"),u7.FIRST_PARTY=new u7("first-party-uid"),u7.MOCK_USER=new u7("mock-user");let ce="9.22.0",ct=new eI("@firebase/firestore");function cn(){return ct.logLevel}function ci(e,...t){if(ct.logLevel<=aN.DEBUG){let n=t.map(co);ct.debug(`Firestore (${ce}): ${e}`,...n)}}function cr(e,...t){if(ct.logLevel<=aN.ERROR){let n=t.map(co);ct.error(`Firestore (${ce}): ${e}`,...n)}}function cs(e,...t){if(ct.logLevel<=aN.WARN){let n=t.map(co);ct.warn(`Firestore (${ce}): ${e}`,...n)}}function co(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function ca(e="Unexpected state"){let t=`FIRESTORE (${ce}) INTERNAL ASSERTION FAILED: `+e;throw cr(t),Error(t)}let cl={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ch extends B{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class cu{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class cc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(u7.UNAUTHENTICATED))}shutdown(){}}class cf{constructor(e){this.t=e,this.currentUser=u7.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),r=new cu;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new cu,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},o=e=>{ci("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(ci("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new cu)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ci("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||ca(),new cc(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||ca(),new u7(e)}}class cp{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=u7.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);let e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class cg{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new cp(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(u7.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class cm{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class cy{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){let n=e=>{null!=e.error&&ci("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.T;return this.T=e.token,ci("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let i=e=>{ci("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){let e=this.I.getImmediate({optional:!0});e?i(e):ci("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||ca(),this.T=e.token,new cm(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class c_{static A(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let i=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%e.length))}return n}}function cv(e,t){return e<t?-1:+(e>t)}function cw(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class cI{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ch(cl.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new ch(cl.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return cI.fromMillis(Date.now())}static fromDate(e){return cI.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new cI(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?cv(this.nanoseconds,e.nanoseconds):cv(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class cC{constructor(e){this.timestamp=e}static fromTimestamp(e){return new cC(e)}static min(){return new cC(new cI(0,0))}static max(){return new cC(new cI(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class cb{constructor(e,t,n){void 0===t?t=0:t>e.length&&ca(),void 0===n?n=e.length-t:n>e.length-t&&ca(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===cb.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof cb?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let n=e.get(i),r=t.get(i);if(n<r)return -1;if(n>r)return 1}return e.length<t.length?-1:+(e.length>t.length)}}class cE extends cb{construct(e,t,n){return new cE(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new ch(cl.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new cE(t)}static emptyPath(){return new cE([])}}let cT=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class cS extends cb{construct(e,t,n){return new cS(e,t,n)}static isValidIdentifier(e){return cT.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),cS.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new cS(["__name__"])}static fromServerFormat(e){let t=[],n="",i=0,r=()=>{if(0===n.length)throw new ch(cl.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;i<e.length;){let t=e[i];if("\\"===t){if(i+1===e.length)throw new ch(cl.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ch(cl.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?s=!s:"."!==t||s?n+=t:r(),i++}if(r(),s)throw new ch(cl.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new cS(t)}static emptyPath(){return new cS([])}}class ck{constructor(e){this.path=e}static fromPath(e){return new ck(cE.fromString(e))}static fromName(e){return new ck(cE.fromString(e).popFirst(5))}static empty(){return new ck(cE.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===cE.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return cE.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ck(new cE(e.slice()))}}class cN{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new cN(cC.min(),ck.empty(),-1)}static max(){return new cN(cC.max(),ck.empty(),-1)}}class cR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function cA(e){if(e.code!==cl.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;ci("LocalStore","Unexpectedly lost primary lease")}class cP{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ca(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new cP((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof cP?t:cP.resolve(t)}catch(e){return cP.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):cP.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):cP.reject(t)}static resolve(e){return new cP((t,n)=>{t(e)})}static reject(e){return new cP((t,n)=>{n(e)})}static waitFor(e){return new cP((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=cP.resolve(!1);for(let n of e)t=t.next(e=>e?cP.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new cP((n,i)=>{let r=e.length,s=Array(r),o=0;for(let a=0;a<r;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new cP((n,i)=>{let r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}function cx(e){return"IndexedDbTransactionError"===e.name}class cD{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ut&&this.ut(e),e}}function cO(e){return 0===e&&1/e==-1/0}function cL(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function cM(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function cF(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}cD.ct=-1;class cU{constructor(e,t){this.comparator=e,this.root=t||cq.EMPTY}insert(e,t){return new cU(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,cq.BLACK,null,null))}remove(e){return new cU(this.comparator,this.root.remove(e,this.comparator).copy(null,null,cq.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cV(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cV(this.root,e,this.comparator,!1)}getReverseIterator(){return new cV(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cV(this.root,e,this.comparator,!0)}}class cV{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class cq{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:cq.RED,this.left=null!=i?i:cq.EMPTY,this.right=null!=r?r:cq.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new cq(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return cq.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return cq.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,cq.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,cq.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ca();let e=this.left.check();if(e!==this.right.check())throw ca();return e+ +!this.isRed()}}cq.EMPTY=null,cq.RED=!0,cq.BLACK=!1,cq.EMPTY=new class{constructor(){this.size=0}get key(){throw ca()}get value(){throw ca()}get color(){throw ca()}get left(){throw ca()}get right(){throw ca()}copy(e,t,n,i,r){return this}insert(e,t,n){return new cq(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class cj{constructor(e){this.comparator=e,this.data=new cU(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cB(this.data.getIterator())}getIteratorFrom(e){return new cB(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof cj)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new cj(this.comparator);return t.data=e,t}}class cB{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class cz{constructor(e){this.fields=e,e.sort(cS.comparator)}static empty(){return new cz([])}unionWith(e){let t=new cj(cS.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new cz(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return cw(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class c$ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class cH{constructor(e){this.binaryString=e}static fromBase64String(e){return new cH(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new c$("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new cH(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return cv(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}cH.EMPTY_BYTE_STRING=new cH("");let cW=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cK(e){if(e||ca(),"string"==typeof e){let t=0,n=cW.exec(e);if(n||ca(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:cG(e.seconds),nanos:cG(e.nanos)}}function cG(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function cQ(e){return"string"==typeof e?cH.fromBase64String(e):cH.fromUint8Array(e)}function cY(e){var t,n;return"server_timestamp"===(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{}).__type__)?void 0:n.stringValue)}function cJ(e){let t=e.mapValue.fields.__previous_value__;return cY(t)?cJ(t):t}function cX(e){let t=cK(e.mapValue.fields.__local_write_time__.timestampValue);return new cI(t.seconds,t.nanos)}class cZ{constructor(e,t,n,i,r,s,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l}}class c0{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new c0("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof c0&&e.projectId===this.projectId&&e.database===this.database}}let c1={};function c2(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?cY(e)?4:ds(e)?0x1fffffffffffff:10:ca()}function c3(e,t){if(e===t)return!0;let n=c2(e);if(n!==c2(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return cX(e).isEqual(cX(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let i=cK(e.timestampValue),r=cK(t.timestampValue);return i.seconds===r.seconds&&i.nanos===r.nanos;case 5:return e.stringValue===t.stringValue;case 6:return cQ(e.bytesValue).isEqual(cQ(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return cG(e.geoPointValue.latitude)===cG(t.geoPointValue.latitude)&&cG(e.geoPointValue.longitude)===cG(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return cG(e.integerValue)===cG(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=cG(e.doubleValue),i=cG(t.doubleValue);return n===i?cO(n)===cO(i):isNaN(n)&&isNaN(i)}return!1;case 9:return cw(e.arrayValue.values||[],t.arrayValue.values||[],c3);case 10:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(cL(s)!==cL(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!c3(s[e],o[e])))return!1;return!0;default:return ca()}}function c4(e,t){return void 0!==(e.values||[]).find(e=>c3(e,t))}function c6(e,t){var n,i,r,s;if(e===t)return 0;let o=c2(e),a=c2(t);if(o!==a)return cv(o,a);switch(o){case 0:case 0x1fffffffffffff:return 0;case 1:return cv(e.booleanValue,t.booleanValue);case 2:let l,h;return l=cG(e.integerValue||e.doubleValue),l<(h=cG(t.integerValue||t.doubleValue))?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1;case 3:return c5(e.timestampValue,t.timestampValue);case 4:return c5(cX(e),cX(t));case 5:return cv(e.stringValue,t.stringValue);case 6:let u,c;return n=e.bytesValue,i=t.bytesValue,u=cQ(n),c=cQ(i),u.compareTo(c);case 7:return function(e,t){let n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){let t=cv(n[e],i[e]);if(0!==t)return t}return cv(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:let d;return r=e.geoPointValue,s=t.geoPointValue,0!==(d=cv(cG(r.latitude),cG(s.latitude)))?d:cv(cG(r.longitude),cG(s.longitude));case 9:return function(e,t){let n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){let t=c6(n[e],i[e]);if(t)return t}return cv(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===c1&&t===c1)return 0;if(e===c1)return 1;if(t===c1)return -1;let n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){let t=cv(i[e],s[e]);if(0!==t)return t;let o=c6(n[i[e]],r[s[e]]);if(0!==o)return o}return cv(i.length,s.length)}(e.mapValue,t.mapValue);default:throw ca()}}function c5(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return cv(e,t);let n=cK(e),i=cK(t),r=cv(n.seconds,i.seconds);return 0!==r?r:cv(n.nanos,i.nanos)}function c8(e){var t,n;let i;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(i=cK(e.timestampValue),`time(${i.seconds},${i.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?cQ(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ck.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(let i of e.values||[])n?n=!1:t+=",",t+=c8(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",i=!0;for(let r of t)i?i=!1:n+=",",n+=`${r}:${c8(e.fields[r])}`;return n+"}"}(e.mapValue):ca()}function c9(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function c7(e){return!!e&&"integerValue"in e}function de(e){return!!e&&"arrayValue"in e}function dt(e){return!!e&&"nullValue"in e}function dn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function di(e){return!!e&&"mapValue"in e}function dr(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return cM(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=dr(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=dr(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ds(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class da{constructor(e){this.value=e}static empty(){return new da({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!di(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=dr(t)}setAll(e){let t=cS.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){let e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=dr(e):i.push(r.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){let t=this.field(e.popLast());di(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return c3(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];di(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(cM(t,(t,n)=>e[t]=n),n))delete e[i]}clone(){return new da(dr(this.value))}}class dl{constructor(e,t,n,i,r,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new dl(e,0,cC.min(),cC.min(),cC.min(),da.empty(),0)}static newFoundDocument(e,t,n,i){return new dl(e,1,t,cC.min(),n,i,0)}static newNoDocument(e,t){return new dl(e,2,t,cC.min(),cC.min(),da.empty(),0)}static newUnknownDocument(e,t){return new dl(e,3,t,cC.min(),cC.min(),da.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(cC.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=da.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=da.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=cC.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof dl&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new dl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class dh{constructor(e,t){this.position=e,this.inclusive=t}}function du(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){let s=t[r],o=e.position[r];if(i=s.field.isKeyField()?ck.comparator(ck.fromName(o.referenceValue),n.key):c6(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function dc(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!c3(e.position[n],t.position[n]))return!1;return!0}class dd{constructor(e,t="asc"){this.field=e,this.dir=t}}class df{}class dp extends df{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new d_(e,t,n):"array-contains"===t?new dC(e,n):"in"===t?new db(e,n):"not-in"===t?new dE(e,n):"array-contains-any"===t?new dT(e,n):new dp(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new dv(e,n):new dw(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(c6(t,this.value)):null!==t&&c2(this.value)===c2(t)&&this.matchesComparison(c6(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ca()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class dg extends df{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new dg(e,t)}matches(e){return dm(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let e=this.ft(e=>e.isInequality());return null!==e?e.field:null}ft(e){for(let t of this.getFlattenedFilters())if(e(t))return t;return null}}function dm(e){return"and"===e.op}function dy(e){for(let t of e.filters)if(t instanceof dg)return!1;return!0}class d_ extends dp{constructor(e,t,n){super(e,t,n),this.key=ck.fromName(n.referenceValue)}matches(e){let t=ck.comparator(e.key,this.key);return this.matchesComparison(t)}}class dv extends dp{constructor(e,t){super(e,"in",t),this.keys=dI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class dw extends dp{constructor(e,t){super(e,"not-in",t),this.keys=dI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function dI(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>ck.fromName(e.referenceValue))}class dC extends dp{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return de(t)&&c4(t.arrayValue,this.value)}}class db extends dp{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&c4(this.value.arrayValue,t)}}class dE extends dp{constructor(e,t){super(e,"not-in",t)}matches(e){if(c4(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!c4(this.value.arrayValue,t)}}class dT extends dp{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!de(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>c4(this.value.arrayValue,e))}}class dS{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.dt=null}}function dk(e,t=null,n=[],i=[],r=null,s=null,o=null){return new dS(e,t,n,i,r,s,o)}function dN(e){if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof dp)return t.field.canonicalString()+t.op.toString()+c8(t.value);if(dy(t)&&dm(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>c8(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>c8(e)).join(",")),e.dt=t}return e.dt}function dR(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++){var n,i;if(n=e.orderBy[r],i=t.orderBy[r],!(n.dir===i.dir&&n.field.isEqual(i.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof dp?n instanceof dp&&t.op===n.op&&t.field.isEqual(n.field)&&c3(t.value,n.value):t instanceof dg?n instanceof dg&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,i,r)=>t&&e(i,n.filters[r]),!0):void ca()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!dc(e.startAt,t.startAt)&&dc(e.endAt,t.endAt)}function dA(e){return ck.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class dP{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function dx(e){return new dP(e)}function dD(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function dO(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function dL(e){for(let t of e.filters){let e=t.getFirstInequalityField();if(null!==e)return e}return null}function dM(e){return null!==e.collectionGroup}function dF(e){if(null===e.wt){e.wt=[];let t=dL(e),n=dO(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new dd(t)),e.wt.push(new dd(cS.keyField(),"asc"));else{let t=!1;for(let n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){let t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new dd(cS.keyField(),t))}}}return e.wt}function dU(e){if(!e._t)if("F"===e.limitType)e._t=dk(e.path,e.collectionGroup,dF(e),e.filters,e.limit,e.startAt,e.endAt);else{let t=[];for(let n of dF(e)){let e="desc"===n.dir?"asc":"desc";t.push(new dd(n.field,e))}let n=e.endAt?new dh(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new dh(e.startAt.position,e.startAt.inclusive):null;e._t=dk(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e._t}function dV(e,t){t.getFirstInequalityField(),dL(e);let n=e.filters.concat([t]);return new dP(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function dq(e,t,n){return new dP(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function dj(e,t){return dR(dU(e),dU(t))&&e.limitType===t.limitType}function dB(e){return`${dN(dU(e))}|lt:${e.limitType}`}function dz(e){var t;let n;return`Query(target=${n=(t=dU(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof dp?`${t.field.canonicalString()} ${t.op} ${c8(t.value)}`:t instanceof dg?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>c8(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>c8(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function d$(e,t){var n,i,r,s;let o,a,l;return t.isFoundDocument()&&(o=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(o):ck.isDocumentKey(e.path)?e.path.isEqual(o):e.path.isImmediateParentOf(o))&&function(e,t){for(let n of dF(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,i=t,(!n.startAt||(r=n.startAt,a=du(r,dF(n),i),r.inclusive?!!(a<=0):!!(a<0)))&&(!n.endAt||(s=n.endAt,l=du(s,dF(n),i),s.inclusive?!!(l>=0):!!(l>0))))}function dH(e){return(t,n)=>{let i=!1;for(let r of dF(e)){let e=function(e,t,n){var i;let r,s,o=e.field.isKeyField()?ck.comparator(t.key,n.key):(i=e.field,r=t.data.field(i),s=n.data.field(i),null!==r&&null!==s?c6(r,s):ca());switch(e.dir){case"asc":return o;case"desc":return -1*o;default:return ca()}}(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}class dW{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,i]of n)if(this.equalsFn(t,e))return i}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){cM(this.inner,(t,n)=>{for(let[t,i]of n)e(t,i)})}isEmpty(){return cF(this.inner)}size(){return this.innerSize}}let dK=new cU(ck.comparator),dG=new cU(ck.comparator);function dQ(...e){let t=dG;for(let n of e)t=t.insert(n.key,n);return t}function dY(){return new dW(e=>e.toString(),(e,t)=>e.isEqual(t))}new cU(ck.comparator);let dJ=new cj(ck.comparator);function dX(...e){let t=dJ;for(let n of e)t=t.add(n);return t}let dZ=new cj(cv);function d0(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cO(t)?"-0":t}}function d1(e){return{integerValue:""+e}}class d2{constructor(){this._=void 0}}class d3 extends d2{}class d4 extends d2{constructor(e){super(),this.elements=e}}function d6(e,t){let n=fe(t);for(let t of e.elements)n.some(e=>c3(e,t))||n.push(t);return{arrayValue:{values:n}}}class d5 extends d2{constructor(e){super(),this.elements=e}}function d8(e,t){let n=fe(t);for(let t of e.elements)n=n.filter(e=>!c3(e,t));return{arrayValue:{values:n}}}class d9 extends d2{constructor(e,t){super(),this.serializer=e,this.gt=t}}function d7(e){return cG(e.integerValue||e.doubleValue)}function fe(e){return de(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ft{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ft}static exists(e){return new ft(void 0,e)}static updateTime(e){return new ft(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class fi{}function fr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new fd(e.key,ft.none()):new fa(e.key,e.data,ft.none());{let n=e.data,i=da.empty(),r=new cj(cS.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new fl(e.key,i,new cz(r.toArray()),ft.none())}}function fs(e,t,n,i){return e instanceof fa?function(e,t,n,i){if(!fn(e.precondition,t))return n;let r=e.value.clone(),s=fc(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof fl?function(e,t,n,i){if(!fn(e.precondition,t))return n;let r=fc(e.fieldTransforms,i,t),s=t.data;return(s.setAll(fh(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):fn(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function fo(e,t){var n,i;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||!(!n||!i)&&cw(n,i,(e,t)=>{var n,i;return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof d4&&i instanceof d4||n instanceof d5&&i instanceof d5?cw(n.elements,i.elements,c3):n instanceof d9&&i instanceof d9?c3(n.gt,i.gt):n instanceof d3&&i instanceof d3)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class fa extends fi{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class fl extends fi{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function fh(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let i=e.data.field(n);t.set(n,i)}}),t}function fu(e,t,n){var i;let r=new Map;e.length===n.length||ca();for(let s=0;s<n.length;s++){let o=e[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,(i=n[s],a instanceof d4?d6(a,l):a instanceof d5?d8(a,l):i))}return r}function fc(e,t,n){let i=new Map;for(let r of e){let e=r.transform,s=n.data.field(r.field);i.set(r.field,function(e,t,n){var i;let r,s,o;return e instanceof d3?(i=t,r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},i&&cY(i)&&(i=cJ(i)),i&&(r.fields.__previous_value__=i),{mapValue:r}):e instanceof d4?d6(e,t):e instanceof d5?d8(e,t):(o=d7(s=function(e,t){return e instanceof d9?c7(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}(e,t))+d7(e.gt),c7(s)&&c7(e.gt)?d1(o):d0(e.serializer,o))}(e,s,t))}return i}class fd extends fi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ff{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let i=this.mutations[t];i.key.isEqual(e.key)&&function(e,t,n){let i,r;e instanceof fa?(i=e.value.clone(),r=fu(e.fieldTransforms,t,n.transformResults),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()):e instanceof fl?function(e,t,n){if(!fn(e.precondition,t))return t.convertToUnknownDocument(n.version);let i=fu(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(fh(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(i,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=fs(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=fs(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=dY();return this.mutations.forEach(i=>{let r=e.get(i.key),s=r.overlayedDocument,o=this.applyToLocalView(s,r.mutatedFields),a=fr(s,o=t.has(i.key)?null:o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(cC.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),dX())}isEqual(e){return this.batchId===e.batchId&&cw(this.mutations,e.mutations,(e,t)=>fo(e,t))&&cw(this.baseMutations,e.baseMutations,(e,t)=>fo(e,t))}}class fp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class fg{constructor(e,t){this.count=e,this.unchangedNames=t}}function fm(e){if(void 0===e)return cr("GRPC error has no .code"),cl.UNKNOWN;switch(e){case I.OK:return cl.OK;case I.CANCELLED:return cl.CANCELLED;case I.UNKNOWN:return cl.UNKNOWN;case I.DEADLINE_EXCEEDED:return cl.DEADLINE_EXCEEDED;case I.RESOURCE_EXHAUSTED:return cl.RESOURCE_EXHAUSTED;case I.INTERNAL:return cl.INTERNAL;case I.UNAVAILABLE:return cl.UNAVAILABLE;case I.UNAUTHENTICATED:return cl.UNAUTHENTICATED;case I.INVALID_ARGUMENT:return cl.INVALID_ARGUMENT;case I.NOT_FOUND:return cl.NOT_FOUND;case I.ALREADY_EXISTS:return cl.ALREADY_EXISTS;case I.PERMISSION_DENIED:return cl.PERMISSION_DENIED;case I.FAILED_PRECONDITION:return cl.FAILED_PRECONDITION;case I.ABORTED:return cl.ABORTED;case I.OUT_OF_RANGE:return cl.OUT_OF_RANGE;case I.UNIMPLEMENTED:return cl.UNIMPLEMENTED;case I.DATA_LOSS:return cl.DATA_LOSS;default:return ca()}}(C=I||(I={}))[C.OK=0]="OK",C[C.CANCELLED=1]="CANCELLED",C[C.UNKNOWN=2]="UNKNOWN",C[C.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",C[C.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",C[C.NOT_FOUND=5]="NOT_FOUND",C[C.ALREADY_EXISTS=6]="ALREADY_EXISTS",C[C.PERMISSION_DENIED=7]="PERMISSION_DENIED",C[C.UNAUTHENTICATED=16]="UNAUTHENTICATED",C[C.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",C[C.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",C[C.ABORTED=10]="ABORTED",C[C.OUT_OF_RANGE=11]="OUT_OF_RANGE",C[C.UNIMPLEMENTED=12]="UNIMPLEMENTED",C[C.INTERNAL=13]="INTERNAL",C[C.UNAVAILABLE=14]="UNAVAILABLE",C[C.DATA_LOSS=15]="DATA_LOSS";class fy{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return f_}static getOrCreateInstance(){return null===f_&&(f_=new fy),f_}onExistenceFilterMismatch(e){let t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let f_=null,fv=new u8([0xffffffff,0xffffffff],0);function fw(e){let t=(new TextEncoder).encode(e),n=new u5;return n.update(t),new Uint8Array(n.digest())}function fI(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new u8([n,i],0),new u8([r,s],0)]}class fC{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new fb(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new fb(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new fb(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=u8.fromNumber(this.It)}Et(e,t,n){let i=e.add(t.multiply(u8.fromNumber(n)));return 1===i.compare(fv)&&(i=new u8([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;let[t,n]=fI(fw(e));for(let e=0;e<this.hashCount;e++){let i=this.Et(t,n,e);if(!this.At(i))return!1}return!0}static create(e,t,n){let i=new fC(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.It)return;let[t,n]=fI(fw(e));for(let e=0;e<this.hashCount;e++){let i=this.Et(t,n,e);this.Rt(i)}}Rt(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class fb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class fE{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,fT.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new fE(cC.min(),i,new cU(cv),dK,dX())}}class fT{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new fT(n,t,dX(),dX(),dX())}}class fS{constructor(e,t,n,i){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=i}}class fk{constructor(e,t){this.targetId=e,this.Vt=t}}class fN{constructor(e,t,n=cH.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class fR{constructor(){this.St=0,this.Dt=fx(),this.Ct=cH.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=dX(),t=dX(),n=dX();return this.Dt.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:ca()}}),new fT(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=fx()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class fA{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=dK,this.zt=fP(),this.Wt=new cU(cv)}Ht(e){for(let t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(let t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{let n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:ca()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((e,n)=>{this.te(n)&&t(n)})}ne(e){var t,n,i,r,s,o,a,l;let h=e.targetId,u=e.Vt.count,c=this.se(h);if(c){let d=c.target;if(dA(d))if(0===u){let e=new ck(d.path);this.Yt(h,e,dl.newNoDocument(e,cC.min()))}else 1===u||ca();else{let c=this.ie(h);if(c!==u){let u,d,f=this.re(e,c);0!==f&&(this.ee(h),this.Wt=this.Wt.insert(h,2===f?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==(t=fy.instance)||t.notifyOnExistenceFilterMismatch((u={localCacheCount:c,existenceFilterCount:(n=e.Vt).count},(d=n.unchangedNames)&&(u.bloomFilter={applied:0===f,hashCount:null!=(i=null==d?void 0:d.hashCount)?i:0,bitmapLength:null!=(o=null==(s=null==(r=null==d?void 0:d.bits)?void 0:r.bitmap)?void 0:s.length)?o:0,padding:null!=(l=null==(a=null==d?void 0:d.bits)?void 0:a.padding)?l:0}),u))}}}}re(e,t){let n,i,{unchangedNames:r,count:s}=e.Vt;if(!r||!r.bits)return 1;let{bits:{bitmap:o="",padding:a=0},hashCount:l=0}=r;try{n=cQ(o).toUint8Array()}catch(e){if(e instanceof c$)return cs("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{i=new fC(n,a,l)}catch(e){return cs(e instanceof fb?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===i.It?1:2*(s!==t-this.oe(e.targetId,i))}oe(e,t){let n=this.Gt.getRemoteKeysForTarget(e),i=0;return n.forEach(n=>{let r=this.Gt.ue(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),i++)}),i}ce(e){let t=new Map;this.Qt.forEach((n,i)=>{let r=this.se(i);if(r){if(n.current&&dA(r.target)){let t=new ck(r.target.path);null!==this.jt.get(t)||this.ae(i,t)||this.Yt(i,t,dl.newNoDocument(t,e))}n.Mt&&(t.set(i,n.Ot()),n.Ft())}});let n=dX();this.zt.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{let t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.jt.forEach((t,n)=>n.setReadTime(e));let i=new fE(e,t,this.Wt,this.jt,n);return this.jt=dK,this.zt=fP(),this.Wt=new cU(cv),i}Jt(e,t){if(!this.te(e))return;let n=2*!!this.ae(e,t.key);this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;let i=this.Zt(e);this.ae(e,t)?i.Bt(t,1):i.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){let t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new fR,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new cj(cv),this.zt=this.zt.insert(e,t)),t}te(e){let t=null!==this.se(e);return t||ci("WatchChangeAggregator","Detected inactive target",e),t}se(e){let t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new fR),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function fP(){return new cU(ck.comparator)}function fx(){return new cU(ck.comparator)}let fD={asc:"ASCENDING",desc:"DESCENDING"},fO={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fL={and:"AND",or:"OR"};class fM{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function fF(e,t){return e.useProto3Json||null==t?t:{value:t}}function fU(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function fV(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function fq(e){let t;return e||ca(),cC.fromTimestamp(new cI((t=cK(e)).seconds,t.nanos))}function fj(e,t){return new cE(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function fB(e){let t=cE.fromString(e);return fQ(t)||ca(),t}function fz(e,t){let n=fB(t);if(n.get(1)!==e.databaseId.projectId)throw new ch(cl.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ch(cl.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ck(fW(n))}function f$(e,t){return fj(e.databaseId,t)}function fH(e){return new cE(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function fW(e){return e.length>4&&"documents"===e.get(4)||ca(),e.popFirst(5)}function fK(e){return{fieldPath:e.canonicalString()}}function fG(e){return cS.fromServerFormat(e.fieldPath)}function fQ(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class fY{constructor(e,t,n,i,r=cC.min(),s=cC.min(),o=cH.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new fY(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new fY(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class fJ{constructor(e){this.fe=e}}class fX{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(+!!e.booleanValue);else if("integerValue"in e)this.ye(t,15),t.pe(cG(e.integerValue));else if("doubleValue"in e){let n=cG(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),cO(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(cQ(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?ds(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):ca()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){let n=e.fields||{};for(let e of(this.ye(t,55),Object.keys(n)))this.Te(e,t),this.me(n[e],t)}Pe(e,t){let n=e.values||[];for(let e of(this.ye(t,50),n))this.me(e,t)}ve(e,t){this.ye(t,37),ck.fromName(e).path.forEach(e=>{this.ye(t,60),this.be(e,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}fX.Ve=new fX;class fZ{constructor(){this.rn=new f0}addToCollectionParentIndex(e,t){return this.rn.add(t),cP.resolve()}getCollectionParents(e,t){return cP.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return cP.resolve()}deleteFieldIndex(e,t){return cP.resolve()}getDocumentsMatchingTarget(e,t){return cP.resolve(null)}getIndexType(e,t){return cP.resolve(0)}getFieldIndexes(e,t){return cP.resolve([])}getNextCollectionGroupToUpdate(e){return cP.resolve(null)}getMinOffset(e,t){return cP.resolve(cN.min())}getMinOffsetFromCollectionGroup(e,t){return cP.resolve(cN.min())}updateCollectionGroup(e,t,n){return cP.resolve()}updateIndexEntries(e,t){return cP.resolve()}}class f0{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new cj(cE.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new cj(cE.comparator)).toArray()}}new Uint8Array(0);class f1{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new f1(e,f1.DEFAULT_COLLECTION_PERCENTILE,f1.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}f1.DEFAULT_COLLECTION_PERCENTILE=10,f1.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,f1.DEFAULT=new f1(0x2800000,f1.DEFAULT_COLLECTION_PERCENTILE,f1.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),f1.DISABLED=new f1(-1,0,0);class f2{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new f2(0)}static Mn(){return new f2(-1)}}class f3{constructor(){this.changes=new dW(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,dl.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?cP.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class f4{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class f6{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&fs(n.mutation,e,cz.empty(),cI.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,dX()).next(()=>t))}getLocalViewOfDocuments(e,t,n=dX()){let i=dY();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=dQ();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=dY();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,dX()))}populateOverlays(e,t,n){let i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=dK,s=dY(),o=dY();return t.forEach((e,t)=>{let o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof fl)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),fs(o.mutation,t,o.mutation.getFieldMask(),cI.now())):s.set(t.key,cz.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new f4(t,null!=(n=s.get(e))?n:null))}),o))}recalculateAndSaveOverlays(e,t){let n=dY(),i=new cU((e,t)=>e-t),r=dX();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let r of e)r.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||cz.empty();o=r.applyToLocalView(s,o),n.set(e,o);let a=(i.get(r.batchId)||dX()).add(e);i=i.insert(r.batchId,a)})}).next(()=>{let s=[],o=i.getReverseIterator();for(;o.hasNext();){let i=o.getNext(),a=i.key,l=i.value,h=dY();l.forEach(e=>{if(!r.has(e)){let i=fr(t.get(e),n.get(e));null!==i&&h.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return cP.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return ck.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):dM(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{let s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):cP.resolve(dY()),o=-1,a=r;return s.next(t=>cP.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?cP.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,a,t,dX())).next(e=>{let t;return{batchId:o,changes:(t=dG,e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t)}}))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ck(t)).next(e=>{let t=dQ();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){let i=t.collectionGroup,r=dQ();return this.indexManager.getCollectionParents(e,i).next(s=>cP.forEach(s,s=>{let o=new dP(s.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{r=r.insert(e,t)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i))).next(e=>{i.forEach((t,n)=>{let i=n.getKey();null===e.get(i)&&(e=e.insert(i,dl.newInvalidDocument(i)))});let n=dQ();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&fs(s.mutation,r,cz.empty(),cI.now()),d$(t,r)&&(n=n.insert(e,r))}),n})}}class f5{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return cP.resolve(this.cs.get(t))}saveBundleMetadata(e,t){return this.cs.set(t.id,{id:t.id,version:t.version,createTime:fq(t.createTime)}),cP.resolve()}getNamedQuery(e,t){return cP.resolve(this.hs.get(t))}saveNamedQuery(e,t){var n;let i;return this.hs.set(t.name,{name:t.name,query:(i=function(e){var t,n,i,r;let s,o,a,l,h,u=4===(s=fB(e.parent)).length?cE.emptyPath():fW(s),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){1===d||ca();let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=(o=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=fG(e.unaryFilter.field);return dp.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=fG(e.unaryFilter.field);return dp.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=fG(e.unaryFilter.field);return dp.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=fG(e.unaryFilter.field);return dp.create(r,"!=",{nullValue:"NULL_VALUE"});default:return ca()}}(t):void 0!==t.fieldFilter?dp.create(fG(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ca()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?dg.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ca()}}(t.compositeFilter.op)):ca()}(c.where))instanceof dg&&dy(t=o)&&dm(t)?o.getFilters():[o]);let g=[];c.orderBy&&(g=c.orderBy.map(e=>new dd(fG(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let m=null;c.limit&&(m=null==(a="object"==typeof(n=c.limit)?n.value:n)?null:a);let y=null;c.startAt&&(l=!!(i=c.startAt).before,y=new dh(i.values||[],l));let _=null;return c.endAt&&(h=!(r=c.endAt).before,_=new dh(r.values||[],h)),new dP(u,f,g,p,m,"F",y,_)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?dq(i,i.limit,"L"):i),readTime:fq(t.readTime)}),cP.resolve()}}class f8{constructor(){this.overlays=new cU(ck.comparator),this.ls=new Map}getOverlay(e,t){return cP.resolve(this.overlays.get(t))}getOverlays(e,t){let n=dY();return cP.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.we(e,t,i)}),cP.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.ls.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.ls.delete(n)),cP.resolve()}getOverlaysForCollection(e,t,n){let i=dY(),r=t.length+1,s=new ck(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return cP.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new cU((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=dY(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=dY(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=i)););return cP.resolve(o)}we(e,t,n){let i=this.overlays.get(n.key);if(null!==i){let e=this.ls.get(i.largestBatchId).delete(n.key);this.ls.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new fp(t,n));let r=this.ls.get(t);void 0===r&&(r=dX(),this.ls.set(t,r)),this.ls.set(t,r.add(n.key))}}class f9{constructor(){this.fs=new cj(f7.ds),this.ws=new cj(f7._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){let n=new f7(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ys(new f7(e,t))}ps(e,t){e.forEach(e=>this.removeReference(e,t))}Is(e){let t=new ck(new cE([])),n=new f7(t,e),i=new f7(t,e+1),r=[];return this.ws.forEachInRange([n,i],e=>{this.ys(e),r.push(e.key)}),r}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){let t=new ck(new cE([])),n=new f7(t,e),i=new f7(t,e+1),r=dX();return this.ws.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){let t=new f7(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class f7{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return ck.comparator(e.key,t.key)||cv(e.As,t.As)}static _s(e,t){return cv(e.As,t.As)||ck.comparator(e.key,t.key)}}class pe{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new cj(f7.ds)}checkEmpty(e){return cP.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){let r=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ff(r,t,n,i);for(let t of(this.mutationQueue.push(s),i))this.Rs=this.Rs.add(new f7(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return cP.resolve(s)}lookupMutationBatch(e,t){return cP.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.bs(t+1),i=n<0?0:n;return cP.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return cP.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return cP.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new f7(t,0),i=new f7(t,1/0),r=[];return this.Rs.forEachInRange([n,i],e=>{let t=this.Ps(e.As);r.push(t)}),cP.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new cj(cv);return t.forEach(e=>{let t=new f7(e,0),i=new f7(e,1/0);this.Rs.forEachInRange([t,i],e=>{n=n.add(e.As)})}),cP.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=n;ck.isDocumentKey(r)||(r=r.child(""));let s=new f7(new ck(r),0),o=new cj(cv);return this.Rs.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.As)),!0)},s),cP.resolve(this.Vs(o))}Vs(e){let t=[];return e.forEach(e=>{let n=this.Ps(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Ss(t.batchId,"removed")||ca(),this.mutationQueue.shift();let n=this.Rs;return cP.forEach(t.mutations,i=>{let r=new f7(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Rs=n})}Cn(e){}containsKey(e,t){let n=new f7(t,0),i=this.Rs.firstAfterOrEqual(n);return cP.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,cP.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){let t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class pt{constructor(e){this.Ds=e,this.docs=new cU(ck.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return cP.resolve(n?n.document.mutableCopy():dl.newInvalidDocument(t))}getEntries(e,t){let n=dK;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():dl.newInvalidDocument(e))}),cP.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=dK,s=t.path,o=new ck(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=ck.comparator(e.documentKey,t.documentKey))?n:cv(e.largestBatchId,t.largestBatchId)}(new cN(o.readTime,o.key,-1),n)||(i.has(o.key)||d$(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return cP.resolve(r)}getAllFromCollectionGroup(e,t,n,i){ca()}Cs(e,t){return cP.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new pn(this)}getSize(e){return cP.resolve(this.size)}}class pn extends f3{constructor(e){super(),this.os=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.os.addEntry(e,i)):this.os.removeEntry(n)}),cP.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class pi{constructor(e){this.persistence=e,this.xs=new dW(e=>dN(e),dR),this.lastRemoteSnapshotVersion=cC.min(),this.highestTargetId=0,this.Ns=0,this.ks=new f9,this.targetCount=0,this.Ms=f2.kn()}forEachTarget(e,t){return this.xs.forEach((e,n)=>t(n)),cP.resolve()}getLastRemoteSnapshotVersion(e){return cP.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return cP.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),cP.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),cP.resolve()}Fn(e){this.xs.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Ms=new f2(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,cP.resolve()}updateTargetData(e,t){return this.Fn(t),cP.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,cP.resolve()}removeTargets(e,t,n){let i=0,r=[];return this.xs.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),cP.waitFor(r).next(()=>i)}getTargetCount(e){return cP.resolve(this.targetCount)}getTargetData(e,t){let n=this.xs.get(t)||null;return cP.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),cP.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);let i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),cP.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),cP.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ks.Es(t);return cP.resolve(n)}containsKey(e,t){return cP.resolve(this.ks.containsKey(t))}}class pr{constructor(e,t){this.$s={},this.overlays={},this.Os=new cD(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new pi(this),this.indexManager=new fZ,this.remoteDocumentCache=new pt(e=>this.referenceDelegate.Ls(e)),this.serializer=new fJ(t),this.qs=new f5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new f8,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new pe(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){ci("MemoryPersistence","Starting transaction:",e);let i=new ps(this.Os.next());return this.referenceDelegate.Us(),n(i).next(e=>this.referenceDelegate.Ks(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Gs(e,t){return cP.or(Object.values(this.$s).map(n=>()=>n.containsKey(e,t)))}}class ps extends cR{constructor(e){super(),this.currentSequenceNumber=e}}class po{constructor(e){this.persistence=e,this.Qs=new f9,this.js=null}static zs(e){return new po(e)}get Ws(){if(this.js)return this.js;throw ca()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),cP.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),cP.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),cP.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(e=>this.Ws.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ws.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return cP.forEach(this.Ws,n=>{let i=ck.fromPath(n);return this.Hs(e,i).next(e=>{e||t.removeEntry(i,cC.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return cP.or([()=>cP.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class pa{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=i}static Li(e,t){let n=dX(),i=dX();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new pa(e,t.fromCache,n,i)}}class pl{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,i){return this.Ki(e,t).next(r=>r||this.Gi(e,t,i,n)).next(n=>n||this.Qi(e,t))}Ki(e,t){if(dD(t))return cP.resolve(null);let n=dU(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(n=dU(t=dq(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{let r=dX(...i);return this.Ui.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.ji(t,i);return this.zi(t,s,r,n.readTime)?this.Ki(e,dq(t,null,"F")):this.Wi(e,s,t,n)}))})))}Gi(e,t,n,i){return dD(t)||i.isEqual(cC.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next(r=>{let s,o,a=this.ji(t,r);return this.zi(t,a,n,i)?this.Qi(e,t):(cn()<=aN.DEBUG&&ci("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),dz(t)),this.Wi(e,a,t,(s=i.toTimestamp().seconds,o=i.toTimestamp().nanoseconds+1,new cN(cC.fromTimestamp(1e9===o?new cI(s+1,0):new cI(s,o)),ck.empty(),-1))))})}ji(e,t){let n=new cj(dH(e));return t.forEach((t,i)=>{d$(e,i)&&(n=n.add(i))}),n}zi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Qi(e,t){return cn()<=aN.DEBUG&&ci("QueryEngine","Using full collection scan to execute query:",dz(t)),this.Ui.getDocumentsMatchingQuery(e,t,cN.min())}Wi(e,t,n,i){return this.Ui.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class ph{constructor(e,t,n,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new cU(cv),this.Yi=new dW(e=>dN(e),dR),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new f6(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}async function pu(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,e.tr(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let r=[],s=[],o=dX();for(let e of i)for(let t of(r.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({er:e,removedBatchIds:r,addedBatchIds:s}))})})}function pc(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}async function pd(e,t,n){let i=e.Ji.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,i))}catch(e){if(!cx(e))throw e;ci("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ji=e.Ji.remove(t),e.Yi.delete(i.target)}function pf(e,t,n){let i=cC.min(),r=dX();return e.persistence.runTransaction("Execute query","readonly",s=>{var o;let a;return(o=dU(t),void 0!==(a=e.Yi.get(o))?cP.resolve(e.Ji.get(a)):e.Bs.getTargetData(s,o)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,e.Bs.getMatchingKeysForTargetId(s,t.targetId).next(e=>{r=e})}).next(()=>e.Hi.getDocumentsMatchingQuery(s,t,n?i:cC.min(),n?r:dX())).next(n=>{var i,s,o;let a;return i=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),o=n,a=i.Xi.get(s)||cC.min(),o.forEach((e,t)=>{t.readTime.compareTo(a)>0&&(a=t.readTime)}),i.Xi.set(s,a),{documents:n,ir:r}})})}class pp{constructor(){this.activeTargetIds=dZ}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class pg{constructor(){this.Hr=new pp,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new pp,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pm{Yr(e){}shutdown(){}}class py{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){for(let e of(ci("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.so))e(0)}no(){for(let e of(ci("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.so))e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let p_=null;function pv(){return null===p_?p_=0x10000000+Math.round(0x80000000*Math.random()):p_++,"0x"+p_.toString(16)}let pw={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pI{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}let pC="WebChannelConnection";class pb extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,i,r){let s=pv(),o=this.To(e,t);ci("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);let a={};return this.Eo(a,i,r),this.Ao(e,o,a,n).then(t=>(ci("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw cs("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}vo(e,t,n,i,r,s){return this.Io(e,t,n,i,r)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ce,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}To(e,t){let n=pw[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,i){let r=pv();return new Promise((s,o)=>{let a=new u6;a.setWithCredentials(!0),a.listenOnce(u0.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case uZ.NO_ERROR:let t=a.getResponseJson();ci(pC,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case uZ.TIMEOUT:ci(pC,`RPC '${e}' ${r} timed out`),o(new ch(cl.DEADLINE_EXCEEDED,"Request time out"));break;case uZ.HTTP_ERROR:let n=a.getStatus();if(ci(pC,`RPC '${e}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(cl).indexOf(e)>=0?e:cl.UNKNOWN);o(new ch(n,t.message))}else o(new ch(cl.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ch(cl.UNAVAILABLE,"Connection failed."));break;default:ca()}}finally{ci(pC,`RPC '${e}' ${r} completed.`)}});let l=JSON.stringify(i);ci(pC,`RPC '${e}' ${r} sending request:`,i),a.send(t,"POST",l,n,15)})}Ro(e,t,n){let i=pv(),r=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=uJ(),o=uX(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.xmlHttpFactory=new u3({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let h=r.join("");ci(pC,`Creating RPC '${e}' stream ${i}: ${h}`,a);let u=s.createWebChannel(h,a),c=!1,d=!1,f=new pI({ro:t=>{d?ci(pC,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(c||(ci(pC,`Opening RPC '${e}' stream ${i} transport.`),u.open(),c=!0),ci(pC,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},oo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,u4.EventType.OPEN,()=>{d||ci(pC,`RPC '${e}' stream ${i} transport opened.`)}),p(u,u4.EventType.CLOSE,()=>{d||(d=!0,ci(pC,`RPC '${e}' stream ${i} transport closed`),f.wo())}),p(u,u4.EventType.ERROR,t=>{d||(d=!0,cs(pC,`RPC '${e}' stream ${i} transport errored:`,t),f.wo(new ch(cl.UNAVAILABLE,"The operation could not be completed")))}),p(u,u4.EventType.MESSAGE,t=>{var n;if(!d){let r=t.data[0];r||ca();let s=r.error||(null==(n=r[0])?void 0:n.error);if(s){ci(pC,`RPC '${e}' stream ${i} received error:`,s);let t=s.status,n=function(e){let t=I[e];if(void 0!==t)return fm(t)}(t),r=s.message;void 0===n&&(n=cl.INTERNAL,r="Unknown error status: "+t+" with message "+s.message),d=!0,f.wo(new ch(n,r)),u.close()}else ci(pC,`RPC '${e}' stream ${i} received:`,r),f._o(r)}}),p(o,u1.STAT_EVENT,t=>{t.stat===u2.PROXY?ci(pC,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===u2.NOPROXY&&ci(pC,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{f.fo()},0),f}}function pE(){return"undefined"!=typeof document?document:null}function pT(e){return new fM(e,!0)}class pS{constructor(e,t,n=1e3,i=1.5,r=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=i,this.Vo=r,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();let t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-n);i>0&&ci("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class pk{constructor(e,t,n,i,r,s,o,a){this.ii=e,this.$o=n,this.Oo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new pS(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===cl.RESOURCE_EXHAUSTED?(cr(t.toString()),cr("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===cl.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;let e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Fo===t&&this.Zo(e,n)},t=>{e(()=>{let e=new ch(cl.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)})})}Zo(e,t){let n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{n(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(e=>{n(()=>this.tu(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Go(){this.state=5,this.qo.No(async()=>{this.state=0,this.start()})}tu(e){return ci("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(ci("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pN extends pk{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();let t=function(e,t){let n;if("targetChange"in t){var i,r;t.targetChange;let s="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:ca(),o=t.targetChange.targetIds||[],a=(r=t.targetChange.resumeToken,e.useProto3Json?(void 0===r||"string"==typeof r||ca(),cH.fromBase64String(r||"")):(void 0===r||r instanceof Uint8Array||ca(),cH.fromUint8Array(r||new Uint8Array))),l=t.targetChange.cause;n=new fN(s,o,a,l&&new ch(void 0===l.code?cl.UNKNOWN:fm(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=fz(e,i.document.name),s=fq(i.document.updateTime),o=i.document.createTime?fq(i.document.createTime):cC.min(),a=new da({mapValue:{fields:i.document.fields}}),l=dl.newFoundDocument(r,s,o,a);n=new fS(i.targetIds||[],i.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=fz(e,i.document),s=i.readTime?fq(i.readTime):cC.min(),o=dl.newNoDocument(r,s);n=new fS([],i.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=fz(e,i.document);n=new fS([],i.removedTargetIds||[],r,null)}else{if(!("filter"in t))return ca();{t.filter;let e=t.filter;e.targetId;let{count:i=0,unchangedNames:r}=e,s=new fg(i,r);n=new fk(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return cC.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?cC.min():t.readTime?fq(t.readTime):cC.min()}(e);return this.listener.nu(t,n)}su(e){let t,n={};n.database=fH(this.serializer),n.addTarget=function(e,t){var n,i;let r,s,o,a,l,h,u=t.target;if((r=dA(u)?{documents:{documents:[f$(e,u.path)]}}:{query:(s={structuredQuery:{}},o=u.path,null!==u.collectionGroup?(s.parent=f$(e,o),s.structuredQuery.from=[{collectionId:u.collectionGroup,allDescendants:!0}]):(s.parent=f$(e,o.popLast()),s.structuredQuery.from=[{collectionId:o.lastSegment()}]),(a=function(e){if(0!==e.length)return function e(t){var n;let i;return t instanceof dp?function(e){if("=="===e.op){if(dn(e.value))return{unaryFilter:{field:fK(e.field),op:"IS_NAN"}};if(dt(e.value))return{unaryFilter:{field:fK(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(dn(e.value))return{unaryFilter:{field:fK(e.field),op:"IS_NOT_NAN"}};if(dt(e.value))return{unaryFilter:{field:fK(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fK(e.field),op:fO[e.op],value:e.value}}}(t):t instanceof dg?1===(i=(n=t).getFilters().map(t=>e(t))).length?i[0]:{compositeFilter:{op:fL[n.op],filters:i}}:ca()}(dg.create(e,"and"))}(u.filters))&&(s.structuredQuery.where=a),(l=function(e){if(0!==e.length)return e.map(e=>({field:fK(e.field),direction:fD[e.dir]}))}(u.orderBy))&&(s.structuredQuery.orderBy=l),null!==(h=fF(e,u.limit))&&(s.structuredQuery.limit=h),u.startAt&&(s.structuredQuery.startAt={before:(n=u.startAt).inclusive,values:n.position}),u.endAt&&(s.structuredQuery.endAt={before:!(i=u.endAt).inclusive,values:i.position}),s)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=fV(e,t.resumeToken);let n=fF(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(cC.min())>0){r.readTime=fU(e,t.snapshotVersion.toTimestamp());let n=fF(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let i=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ca()}}(e.purpose))?null:{"goog-listen-tags":t});i&&(n.labels=i),this.Wo(n)}iu(e){let t={};t.database=fH(this.serializer),t.removeTarget=e,this.Wo(t)}}class pR extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new ch(cl.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,r])=>this.connection.Io(e,t,n,i,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===cl.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ch(cl.UNKNOWN,e.toString())})}vo(e,t,n,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.vo(e,t,n,r,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===cl.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ch(cl.UNKNOWN,e.toString())})}terminate(){this.lu=!0}}class pA{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(cr(t),this.mu=!1):ci("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class pP{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=r,this.Pu.Yr(e=>{n.enqueueAndForget(async()=>{pq(this)&&(ci("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.vu.add(4),await pD(e),e.bu.set("Unknown"),e.vu.delete(4),await px(e)}(this))})}),this.bu=new pA(n,i)}}async function px(e){if(pq(e))for(let t of e.Ru)await t(!0)}async function pD(e){for(let t of e.Ru)await t(!1)}function pO(e,t){e.Au.has(t.targetId)||(e.Au.set(t.targetId,t),pV(e)?pU(e):pK(e).Ko()&&pM(e,t))}function pL(e,t){let n=pK(e);e.Au.delete(t),n.Ko()&&pF(e,t),0===e.Au.size&&(n.Ko()?n.jo():pq(e)&&e.bu.set("Unknown"))}function pM(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(cC.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}pK(e).su(t)}function pF(e,t){e.Vu.qt(t),pK(e).iu(t)}function pU(e){e.Vu=new fA({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),pK(e).start(),e.bu.gu()}function pV(e){return pq(e)&&!pK(e).Uo()&&e.Au.size>0}function pq(e){return 0===e.vu.size}async function pj(e){e.Au.forEach((t,n)=>{pM(e,t)})}async function pB(e,t){e.Vu=void 0,pV(e)?(e.bu.Iu(t),pU(e)):e.bu.set("Unknown")}async function pz(e,t,n){if(e.bu.set("Online"),t instanceof fN&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let i of t.targetIds)e.Au.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Au.delete(i),e.Vu.removeTarget(i))}(e,t)}catch(n){ci("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await p$(e,n)}else if(t instanceof fS?e.Vu.Ht(t):t instanceof fk?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(cC.min()))try{let t,i=await pc(e.localStore);n.compareTo(i)>=0&&await ((t=e.Vu.ce(n)).targetChanges.forEach((t,i)=>{if(t.resumeToken.approximateByteSize()>0){let r=e.Au.get(i);r&&e.Au.set(i,r.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let i=e.Au.get(t);if(!i)return;e.Au.set(t,i.withResumeToken(cH.EMPTY_BYTE_STRING,i.snapshotVersion)),pF(e,t);let r=new fY(i.target,t,n,i.sequenceNumber);pM(e,r)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){ci("RemoteStore","Failed to raise snapshot:",t),await p$(e,t)}}async function p$(e,t,n){if(!cx(t))throw t;e.vu.add(1),await pD(e),e.bu.set("Offline"),n||(n=()=>pc(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ci("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await px(e)})}async function pH(e,t){e.asyncQueue.verifyOperationInProgress(),ci("RemoteStore","RemoteStore received new credentials");let n=pq(e);e.vu.add(3),await pD(e),n&&e.bu.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.vu.delete(3),await px(e)}async function pW(e,t){t?(e.vu.delete(2),await px(e)):t||(e.vu.add(2),await pD(e),e.bu.set("Unknown"))}function pK(e){var t,n,i;return e.Su||(t=e.datastore,n=e.asyncQueue,i={uo:pj.bind(null,e),ao:pB.bind(null,e),nu:pz.bind(null,e)},t.fu(),e.Su=new pN(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i),e.Ru.push(async t=>{t?(e.Su.Qo(),pV(e)?pU(e):e.bu.set("Unknown")):(await e.Su.stop(),e.Vu=void 0)})),e.Su}class pG{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new cu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,i,r){let s=new pG(e,t,Date.now()+n,i,r);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ch(cl.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pQ(e,t){if(cr("AsyncQueue",`${t}: ${e}`),cx(e))return new ch(cl.UNAVAILABLE,`${t}: ${e}`);throw e}class pY{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ck.comparator(t.key,n.key):(e,t)=>ck.comparator(e.key,t.key),this.keyedMap=dQ(),this.sortedSet=new cU(this.comparator)}static emptySet(e){return new pY(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof pY)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new pY;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class pJ{constructor(){this.Cu=new cU(ck.comparator)}track(e){let t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):ca():this.Cu=this.Cu.insert(t,e)}xu(){let e=[];return this.Cu.inorderTraversal((t,n)=>{e.push(n)}),e}}class pX{constructor(e,t,n,i,r,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new pX(e,t,pY.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&dj(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class pZ{constructor(){this.Nu=void 0,this.listeners=[]}}class p0{constructor(){this.queries=new dW(e=>dB(e),dj),this.onlineState="Unknown",this.ku=new Set}}async function p1(e,t){let n=t.query,i=!1,r=e.queries.get(n);if(r||(i=!0,r=new pZ),i)try{r.Nu=await e.onListen(n)}catch(n){let e=pQ(n,`Initialization of query '${dz(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,r),r.listeners.push(t),t.Mu(e.onlineState),r.Nu&&t.$u(r.Nu)&&p6(e)}async function p2(e,t){let n=t.query,i=!1,r=e.queries.get(n);if(r){let e=r.listeners.indexOf(t);e>=0&&(r.listeners.splice(e,1),i=0===r.listeners.length)}if(i)return e.queries.delete(n),e.onUnlisten(n)}function p3(e,t){let n=!1;for(let i of t){let t=i.query,r=e.queries.get(t);if(r){for(let e of r.listeners)e.$u(i)&&(n=!0);r.Nu=i}}n&&p6(e)}function p4(e,t,n){let i=e.queries.get(t);if(i)for(let e of i.listeners)e.onError(n);e.queries.delete(t)}function p6(e){e.ku.forEach(e=>{e.next()})}class p5{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new pX(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;let t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=pX.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class p8{constructor(e){this.key=e}}class p9{constructor(e){this.key=e}}class p7{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=dX(),this.mutatedKeys=dX(),this.tc=dH(e),this.ec=new pY(this.tc)}get nc(){return this.Yu}sc(e,t){let n=t?t.ic:new pJ,i=t?t.ec:this.ec,r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1,a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{let h=i.get(e),u=d$(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.rc(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.tc(u,a)>0||l&&0>this.tc(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:r}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;let r=e.ic.xu();r.sort((e,t)=>{var n,i;let r;return n=e.type,i=t.type,(r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ca()}})(n)-r(i)||this.tc(e.doc,t.doc)}),this.oc(n);let s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return(this.Xu=o,0!==r.length||a)?{snapshot:new pX(this.query,e.ec,i,r,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new pJ,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(e=>this.Yu=this.Yu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Yu=this.Yu.delete(e)),this.current=e.current)}uc(){if(!this.current)return[];let e=this.Zu;this.Zu=dX(),this.ec.forEach(e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))});let t=[];return e.forEach(e=>{this.Zu.has(e)||t.push(new p9(e))}),this.Zu.forEach(n=>{e.has(n)||t.push(new p8(n))}),t}hc(e){this.Yu=e.ir,this.Zu=dX();let t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return pX.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class ge{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class gt{constructor(e){this.key=e,this.fc=!1}}class gn{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new dW(e=>dB(e),dj),this._c=new Map,this.mc=new Set,this.gc=new cU(ck.comparator),this.yc=new Map,this.Ic=new f9,this.Tc={},this.Ec=new Map,this.Ac=f2.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function gi(e,t){var n,i,r;let s,o,a=((n=e).remoteStore.remoteSyncer.applyRemoteEvent=go.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=gg.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=gl.bind(null,n),n.dc.nu=p3.bind(null,n.eventManager),n.dc.Pc=p4.bind(null,n.eventManager),n),l=a.wc.get(t);if(l)s=l.targetId,a.sharedClientState.addLocalQueryTarget(s),o=l.view.lc();else{let e=await (i=a.localStore,r=dU(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Bs.getTargetData(e,r).next(n=>n?(t=n,cP.resolve(t)):i.Bs.allocateTargetId(e).next(n=>(t=new fY(r,n,"TargetPurposeListen",e.currentSequenceNumber),i.Bs.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ji.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ji=i.Ji.insert(e.targetId,e),i.Yi.set(r,e.targetId)),e})),n=a.sharedClientState.addLocalQueryTarget(e.targetId);s=e.targetId,o=await gr(a,t,s,"current"===n,e.resumeToken),a.isPrimaryClient&&pO(a.remoteStore,e)}return o}async function gr(e,t,n,i,r){e.Rc=(t,n,i)=>(async function(e,t,n,i){let r=t.view.sc(n);r.zi&&(r=await pf(e.localStore,t.query,!1).then(({documents:e})=>t.view.sc(e,r)));let s=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,s);return gc(e,t.targetId,o.cc),o.snapshot})(e,t,n,i);let s=await pf(e.localStore,t,!0),o=new p7(t,s.ir),a=o.sc(s.documents),l=fT.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),h=o.applyChanges(a,e.isPrimaryClient,l);gc(e,n,h.cc);let u=new ge(t,n,o);return e.wc.set(t,u),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),h.snapshot}async function gs(e,t){let n=e.wc.get(t),i=e._c.get(n.targetId);i.length>1?(e._c.set(n.targetId,i.filter(e=>!dj(e,t))),e.wc.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await pd(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),pL(e.remoteStore,n.targetId),gh(e,n.targetId)}).catch(cA)):(gh(e,n.targetId),await pd(e.localStore,n.targetId,!0))}async function go(e,t){var n;try{let i,r,s=await (n=e.localStore,i=t.snapshotVersion,r=n.Ji,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,o,a;let l,h,u=n.Zi.newChangeBuffer({trackRemovals:!0});r=n.Ji;let c=[];t.targetChanges.forEach((s,o)=>{var a;let l=r.get(o);if(!l)return;c.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Bs.addMatchingKeys(e,s.addedDocuments,o)));let h=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(cH.EMPTY_BYTE_STRING,cC.min()).withLastLimboFreeSnapshotVersion(cC.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,i)),r=r.insert(o,h),a=h,(0===l.resumeToken.approximateByteSize()||a.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(n.Bs.updateTargetData(e,h))});let d=dK,f=dX();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),c.push((s=e,o=u,a=t.documentUpdates,l=dX(),h=dX(),a.forEach(e=>l=l.add(e)),o.getEntries(s,l).next(e=>{let t=dK;return a.forEach((n,i)=>{let r=e.get(n);i.isFoundDocument()!==r.isFoundDocument()&&(h=h.add(n)),i.isNoDocument()&&i.version.isEqual(cC.min())?(o.removeEntry(n,i.readTime),t=t.insert(n,i)):!r.isValidDocument()||i.version.compareTo(r.version)>0||0===i.version.compareTo(r.version)&&r.hasPendingWrites?(o.addEntry(i),t=t.insert(n,i)):ci("LocalStore","Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)}),{nr:t,sr:h}})).next(e=>{d=e.nr,f=e.sr})),!i.isEqual(cC.min())){let t=n.Bs.getLastRemoteSnapshotVersion(e).next(t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,i));c.push(t)}return cP.waitFor(c).next(()=>u.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,d,f)).next(()=>d)}).then(e=>(n.Ji=r,e)));t.targetChanges.forEach((t,n)=>{let i=e.yc.get(n);i&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||ca(),t.addedDocuments.size>0?i.fc=!0:t.modifiedDocuments.size>0?i.fc||ca():t.removedDocuments.size>0&&(i.fc||ca(),i.fc=!1))}),await gf(e,s,t)}catch(e){await cA(e)}}function ga(e,t,n){var i;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,r=[];e.wc.forEach((e,n)=>{let i=n.view.Mu(t);i.snapshot&&r.push(i.snapshot)}),(i=e.eventManager).onlineState=t,n=!1,i.queries.forEach((e,i)=>{for(let e of i.listeners)e.Mu(t)&&(n=!0)}),n&&p6(i),r.length&&e.dc.nu(r),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function gl(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let i=e.yc.get(t),r=i&&i.key;if(r){let n=new cU(ck.comparator);n=n.insert(r,dl.newNoDocument(r,cC.min()));let i=dX().add(r),s=new fE(cC.min(),new Map,new cU(cv),n,i);await go(e,s),e.gc=e.gc.remove(r),e.yc.delete(t),gd(e)}else await pd(e.localStore,t,!1).then(()=>gh(e,t,n)).catch(cA)}function gh(e,t,n=null){for(let i of(e.sharedClientState.removeLocalQueryTarget(t),e._c.get(t)))e.wc.delete(i),n&&e.dc.Pc(i,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach(t=>{e.Ic.containsKey(t)||gu(e,t)})}function gu(e,t){e.mc.delete(t.path.canonicalString());let n=e.gc.get(t);null!==n&&(pL(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),gd(e))}function gc(e,t,n){for(let i of n)i instanceof p8?(e.Ic.addReference(i.key,t),function(e,t){let n=t.key,i=n.path.canonicalString();e.gc.get(n)||e.mc.has(i)||(ci("SyncEngine","New document in limbo: "+n),e.mc.add(i),gd(e))}(e,i)):i instanceof p9?(ci("SyncEngine","Document no longer in limbo: "+i.key),e.Ic.removeReference(i.key,t),e.Ic.containsKey(i.key)||gu(e,i.key)):ca()}function gd(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){let t=e.mc.values().next().value;e.mc.delete(t);let n=new ck(cE.fromString(t)),i=e.Ac.next();e.yc.set(i,new gt(n)),e.gc=e.gc.insert(n,i),pO(e.remoteStore,new fY(dU(dx(n.path)),i,"TargetPurposeLimboResolution",cD.ct))}}async function gf(e,t,n){let i=[],r=[],s=[];e.wc.isEmpty()||(e.wc.forEach((o,a)=>{s.push(e.Rc(a,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);let e=pa.Li(a.targetId,t);r.push(e)}}))}),await Promise.all(s),e.dc.nu(i),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>cP.forEach(t,t=>cP.forEach(t.Fi,i=>e.persistence.referenceDelegate.addReference(n,t.targetId,i)).next(()=>cP.forEach(t.Bi,i=>e.persistence.referenceDelegate.removeReference(n,t.targetId,i)))))}catch(e){if(!cx(e))throw e;ci("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ji.get(t),i=n.snapshotVersion,r=n.withLastLimboFreeSnapshotVersion(i);e.Ji=e.Ji.insert(t,r)}}}(e.localStore,r))}async function gp(e,t){if(!e.currentUser.isEqual(t)){ci("SyncEngine","User change. New user:",t.toKey());let n=await pu(e.localStore,t);e.currentUser=t,e.Ec.forEach(e=>{e.forEach(e=>{e.reject(new ch(cl.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ec.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await gf(e,n.er)}}function gg(e,t){let n=e.yc.get(t);if(n&&n.fc)return dX().add(n.key);{let n=dX(),i=e._c.get(t);if(!i)return n;for(let t of i){let i=e.wc.get(t);n=n.unionWith(i.view.nc)}return n}}class gm{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=pT(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t,n;return t=this.persistence,n=new pl,new ph(t,n,e.initialUser,this.serializer)}createPersistence(e){return new pr(po.zs,this.serializer)}createSharedClientState(e){return new pg}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class gy{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ga(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=gp.bind(null,this.syncEngine),await pW(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new p0}createDatastore(e){var t;let n=pT(e.databaseInfo.databaseId),i=new pb(e.databaseInfo);return t=e.authCredentials,new pR(t,e.appCheckCredentials,i,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new pP(t,n,e.asyncQueue,e=>ga(this.syncEngine,e,0),py.D()?new py:new pm)}createSyncEngine(e,t){var n,i,r,s,o,a;let l;return n=this.localStore,i=this.remoteStore,r=this.eventManager,s=this.sharedClientState,o=e.initialUser,a=e.maxConcurrentLimboResolutions,l=new gn(n,i,r,s,o,a),t&&(l.vc=!0),l}terminate(){return async function(e){ci("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await pD(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class g_{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):cr("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class gv{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=u7.UNAUTHENTICATED,this.clientId=c_.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{ci("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(ci("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ch(cl.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new cu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=pQ(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function gw(e,t){e.asyncQueue.verifyOperationInProgress(),ci("FirestoreClient","Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await pu(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gI(e,t){e.asyncQueue.verifyOperationInProgress();let n=await gC(e);ci("FirestoreClient","Initializing OnlineComponentProvider");let i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener(e=>pH(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>pH(t.remoteStore,n)),e._onlineComponents=t}async function gC(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ci("FirestoreClient","Using user provided OfflineComponentProvider");try{await gw(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===cl.FAILED_PRECONDITION||t.code===cl.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;cs("Error using user provided cache. Falling back to memory cache: "+t),await gw(e,new gm)}}else ci("FirestoreClient","Using default OfflineComponentProvider"),await gw(e,new gm);return e._offlineComponents}async function gb(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ci("FirestoreClient","Using user provided OnlineComponentProvider"),await gI(e,e._uninitializedComponentsProvider._online)):(ci("FirestoreClient","Using default OnlineComponentProvider"),await gI(e,new gy))),e._onlineComponents}async function gE(e){let t=await gb(e),n=t.eventManager;return n.onListen=gi.bind(null,t.syncEngine),n.onUnlisten=gs.bind(null,t.syncEngine),n}function gT(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let gS=new Map;function gk(e,t,n){if(!n)throw new ch(cl.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function gN(e){if(!ck.isDocumentKey(e))throw new ch(cl.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function gR(e){if(ck.isDocumentKey(e))throw new ch(cl.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function gA(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":ca()}function gP(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ch(cl.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=gA(e);throw new ch(cl.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class gx{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ch(cl.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ch(cl.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new ch(cl.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gT(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ch(cl.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ch(cl.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ch(cl.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gD{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gx({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ch(cl.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ch(cl.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gx(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new cd;switch(e.type){case"firstParty":return new cg(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ch(cl.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=gS.get(this))&&(ci("ComponentProvider","Removing Datastore"),gS.delete(this),e.terminate()),Promise.resolve()}}class gO{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gM(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new gO(this.firestore,e,this._key)}}class gL{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new gL(this.firestore,e,this._query)}}class gM extends gL{constructor(e,t,n){super(e,t,dx(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new gO(this.firestore,null,new ck(e))}withConverter(e){return new gM(this.firestore,e,this._path)}}function gF(e,t,...n){if(e=ec(e),1==arguments.length&&(t=c_.A()),gk("doc","path",t),e instanceof gD){let i=cE.fromString(t,...n);return gN(i),new gO(e,null,new ck(i))}{if(!(e instanceof gO||e instanceof gM))throw new ch(cl.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(cE.fromString(t,...n));return gN(i),new gO(e.firestore,e instanceof gM?e.converter:null,new ck(i))}}class gU{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new pS(this,"async_queue_retry"),this.Xc=()=>{let e=pE();e&&ci("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=pE();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;let t=pE();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});let t=new cu;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!cx(e))throw e;ci("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){let t=this.Gc.then(()=>(this.Hc=!0,e().catch(e=>{let t;throw this.Wc=e,this.Hc=!1,cr("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.Hc=!1,e))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);let i=pG.createAndSchedule(this,e,t,n,e=>this.na(e));return this.zc.push(i),i}Zc(){this.Wc&&ca()}verifyOperationInProgress(){}async sa(){let e;do e=this.Gc,await e;while(e!==this.Gc)}ia(e){for(let t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{for(let t of(this.zc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.zc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){let t=this.zc.indexOf(e);this.zc.splice(t,1)}}function gV(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class gq extends gD{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new gU,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||gz(this),this._firestoreClient.terminate()}}function gj(e,t,n){n||(n="(default)");let i=eH(e,"firestore");if(i.isInitialized(n)){let e=i.getImmediate({identifier:n});if(ee(i.getOptions(n),t))return e;throw new ch(cl.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new ch(cl.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ch(cl.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return i.initialize({options:t,instanceIdentifier:n})}function gB(e){return e._firestoreClient||gz(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function gz(e){var t,n,i,r,s;let o=e._freezeSettings(),a=(r=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new cZ(r,s,e._persistenceKey,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,gT(o.experimentalLongPollingOptions),o.useFetchStreams));e._firestoreClient=new gv(e._authCredentials,e._appCheckCredentials,e._queue,a),(null==(n=o.cache)?void 0:n._offlineComponentProvider)&&(null==(i=o.cache)?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:o.cache.kind,_offline:o.cache._offlineComponentProvider,_online:o.cache._onlineComponentProvider})}class g${constructor(e){this._byteString=e}static fromBase64String(e){try{return new g$(cH.fromBase64String(e))}catch(e){throw new ch(cl.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new g$(cH.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class gH{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ch(cl.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new cS(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class gW{constructor(e){this._methodName=e}}class gK{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ch(cl.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ch(cl.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return cv(this._lat,e._lat)||cv(this._long,e._long)}}let gG=/^__.*__$/;function gQ(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ca()}}class gY{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.ua(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new gY(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;let n=null==(t=this.path)?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.fa(e),i}da(e){var t;let n=null==(t=this.path)?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return g0(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(gQ(this.ca)&&gG.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class gJ{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||pT(e)}ya(e,t,n,i=!1){return new gY({ca:e,methodName:t,ga:n,path:cS.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gX(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof cI||e instanceof gK||e instanceof g$||e instanceof gO||e instanceof gW)}let gZ=RegExp("[~\\*/\\[\\]]");function g0(e,t,n,i,r){let s=i&&!i.isEmpty(),o=void 0!==r,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new ch(cl.INVALID_ARGUMENT,a+e+l)}class g1{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new gO(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new g2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(g3("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class g2 extends g1{data(){return super.data()}}function g3(e,t){return"string"==typeof t?function(e,t,n){if(t.search(gZ)>=0)throw g0(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,void 0);try{return new gH(...t.split("."))._internalPath}catch(n){throw g0(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,void 0)}}(e,t):t instanceof gH?t._internalPath:t._delegate._internalPath}function g4(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ch(cl.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class g6{}class g5 extends g6{}class g8 extends g5{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new g8(e,t,n)}_apply(e){let t=this._parse(e);return mt(e._query,t),new gL(e.firestore,e.converter,dV(e._query,t))}_parse(e){var t;let n,i,r=(n=(t=e.firestore)._freezeSettings(),i=pT(t._databaseId),new gJ(t._databaseId,!!n.ignoreUndefinedProperties,i));return function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ch(cl.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){me(o,s);let t=[];for(let n of o)t.push(g7(i,e,n));a={arrayValue:{values:t}}}else a=g7(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||me(o,s),a=function(e,t,n,i=!1){return function e(t,n){if(gX(t=ec(t))){var i,r;let s;return function(e,t,n){if(!gX(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let i=gA(n);throw"an object"===i?t._a(e+" a custom object"):t._a(e+" "+i)}}("Unsupported field value:",n,t),i=t,r=n,s={},cF(i)?r.path&&r.path.length>0&&r.fieldMask.push(r.path):cM(i,(t,n)=>{let i=e(n,r.ha(t));null!=i&&(s[t]=i)}),{mapValue:{fields:s}}}if(t instanceof gW)return function(e,t){if(!gQ(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(t,n),null;if(void 0===t&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),t instanceof Array){if(n.settings.la&&4!==n.ca)throw n._a("Nested arrays are not supported");let i=[],r=0;for(let s of t){let t=e(s,n.wa(r));null==t&&(t={nullValue:"NULL_VALUE"}),i.push(t),r++}return{arrayValue:{values:i}}}return function(e,t){if(null===(e=ec(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e){var n,i,r;return n=t.serializer,"number"==typeof(r=i=e)&&Number.isInteger(r)&&!cO(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER?d1(i):d0(n,i)}if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=cI.fromDate(e);return{timestampValue:fU(t.serializer,n)}}if(e instanceof cI){let n=new cI(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:fU(t.serializer,n)}}if(e instanceof gK)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof g$)return{bytesValue:fV(t.serializer,e._byteString)};if(e instanceof gO){let n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:fj(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${gA(e)}`)}(t,n)}(n,e.ya(i?4:3,t))}(n,t,o,"in"===s||"not-in"===s);return dp.create(r,s,a)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}class g9 extends g6{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new g9(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:dg.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())mt(n,e),n=dV(n,e)}(e._query,t),new gL(e.firestore,e.converter,dV(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function g7(e,t,n){if("string"==typeof(n=ec(n))){if(""===n)throw new ch(cl.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!dM(t)&&-1!==n.indexOf("/"))throw new ch(cl.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let i=t.path.child(cE.fromString(n));if(!ck.isDocumentKey(i))throw new ch(cl.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return c9(e,new ck(i))}if(n instanceof gO)return c9(e,n._key);throw new ch(cl.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gA(n)}.`)}function me(e,t){if(!Array.isArray(e)||0===e.length)throw new ch(cl.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function mt(e,t){if(t.isInequality()){let n=dL(e),i=t.field;if(null!==n&&!n.isEqual(i))throw new ch(cl.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${i.toString()}'`);let r=dO(e);null!==r&&function(e,t,n){if(!n.isEqual(t))throw new ch(cl.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}(0,i,r)}let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new ch(cl.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ch(cl.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class mn{convertValue(e,t="none"){switch(c2(e)){case 0:return null;case 1:return e.booleanValue;case 2:return cG(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(cQ(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw ca()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return cM(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertGeoPoint(e){return new gK(cG(e.latitude),cG(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=cJ(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cX(e));default:return null}}convertTimestamp(e){let t=cK(e);return new cI(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=cE.fromString(e);fQ(n)||ca();let i=new c0(n.get(1),n.get(3)),r=new ck(n.popFirst(5));return i.isEqual(t)||cr(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class mi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mr extends g1{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ms(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(g3("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ms extends mr{data(e={}){return super.data(e)}}class mo{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new mi(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ms(this._firestore,this._userDataWriter,n.key,n,new mi(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ch(cl.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let i=new ms(e._firestore,e._userDataWriter,n.doc.key,n.doc,new mi(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let i=new ms(e._firestore,e._userDataWriter,t.doc.key,t.doc,new mi(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ca()}}(t.type),doc:i,oldIndex:r,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ma(e){e=gP(e,gO);let t=gP(e.firestore,gq);return(function(e,t,n={}){let i=new cu;return e.asyncQueue.enqueueAndForget(async()=>{var r,s;let o,a;return r=await gE(e),s=e.asyncQueue,o=new g_({next:e=>{s.enqueueAndForget(()=>p2(r,a));let o=e.docs.has(t);!o&&e.fromCache?i.reject(new ch(cl.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&e.fromCache&&n&&"server"===n.source?i.reject(new ch(cl.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(e)},error:e=>i.reject(e)}),p1(r,a=new p5(dx(t.path),o,{includeMetadataChanges:!0,Ku:!0}))}),i.promise})(gB(t),e._key).then(n=>mh(t,e,n))}class ml extends mn{constructor(e){super(),this.firestore=e}convertBytes(e){return new g$(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new gO(this.firestore,null,t)}}function mh(e,t,n){let i=n.docs.get(t._key),r=new ml(e);return new mr(e,r,t._key,i,new mi(n.hasPendingWrites,n.fromCache),t.converter)}!function(e,t=!0){ce=eY,e$(new ed("firestore",(e,{instanceIdentifier:n,options:i})=>{let r=e.getProvider("app").getImmediate(),s=new gq(new cf(e.getProvider("auth-internal")),new cy(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ch(cl.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new c0(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),e1(u9,"3.12.0",void 0),e1(u9,"3.12.0","esm2017")}(),e1("firebase","9.22.0","app"),e.i(103251);let mu=(p=eZ(),p?.length>0?p?.[0]:eJ({apiKey:"AIzaSyAU62kOE6xhSrFqoXQPv6_WHxYilmoUxDk",authDomain:"idlemmo.firebaseapp.com",databaseURL:"idlemmo.firebaseio.com",storageBucket:"idlemmo.appspot.com",projectId:"idlemmo"}));var mc=e.i(608580),md=e.i(698881),mf=e.i(372110);let mp=async(e,t)=>{let n,i=iq(mu);"apple"===t?n=new nT("apple.com").credential({idToken:e?.id_token,rawNonce:e?.nonce}):"google"===t&&(n=nk.credential(e,null));let r=await nF(i,n).catch(function(e){if("auth/account-exists-with-different-credential"===e.code)throw Error("Email already associated with another account.");throw console.error("Error while trying to sign in with credentials: ",e),Error(e)});return r?.user},mg=async({email:e,password:t}={})=>{let n=iq(mu),i=await nF(ec(n),nC.credential(e,t)).catch(function(e){let t=e.code;if("auth/account-exists-with-different-credential"===t)throw Error("Email already associated with another account.");if("auth/invalid-email"===t||"auth/user-not-found"===t||"auth/invalid-password"===t||"auth/wrong-password"===t)throw Error("Username or password is incorrect");throw console.error("Error while trying to sign in with credentials: ",e),Error(e)});return i?.user},mm=async(e,t)=>{if(!e)return;let n=iq(mu),i=await nV(n,e).catch(function(e){t({type:"loginError",data:e?.message})});return i?.user},my=()=>{let e=iq(mu);return new Promise((t,n)=>{try{e.onAuthStateChanged(e=>{e?t(e):t(null)})}catch(e){n(e)}})},m_=async(e,t,n)=>{var i,r;let s,o=eX(),a=aE(o),l=gj(o,{});(i=ec(i=a))._checkNotDeleted("goOnline"),(r=i._repo).persistentConnection_&&r.persistentConnection_.resume(o8);let h=a_(a),u=await mw(h,`_uid/${e}`);if(!u)throw Error("No characters found for this account");if(l?.type==="firestore"){let e=await ma(gF(l,"_vars","_vars"));e.exists()&&(s=e.data())}if(u?.length>0){let i,r=await ma(gF(l,"_data",e));return r.exists()&&(i=r._document.createTime.toTimestamp()),function(e,...t){var n,i,r,s;let o,a,l,h,u;e=ec(e);let c={includeMetadataChanges:!1},d=0;"object"!=typeof t[0]||gV(t[d])||(c=t[d],d++);let f={includeMetadataChanges:c.includeMetadataChanges};if(gV(t[d])){let e=t[d];t[d]=null==(n=e.next)?void 0:n.bind(e),t[d+1]=null==(i=e.error)?void 0:i.bind(e),t[d+2]=null==(r=e.complete)?void 0:r.bind(e)}if(e instanceof gO)a=gP(e.firestore,gq),l=dx(e._key.path),o={next:n=>{t[d]&&t[d](mh(a,e,n))},error:t[d+1],complete:t[d+2]};else{let n=gP(e,gL);a=gP(n.firestore,gq),l=n._query;let i=new ml(a);o={next:e=>{t[d]&&t[d](new mo(a,i,n,e))},error:t[d+1],complete:t[d+2]},g4(e._query)}return s=gB(a),u=new p5(l,h=new g_(o),f),s.asyncQueue.enqueueAndForget(async()=>p1(await gE(s),u)),()=>{h.Dc(),s.asyncQueue.enqueueAndForget(async()=>p2(await gE(s),u))}}(gF(l,"_data",e),{includeMetadataChanges:!0},async r=>{if(r.exists()){let o=await mw(h,`_comp/${e}`),a=await mw(h,`_usgu/${e}/g`),l=await mw(h,`_guild/${a}`),c=r.data();n(c,u,o,{stats:(0,mc.tryToParse)(c?.Guild),members:Object.values(l?.m||{}),points:l?.p},s,i,e,t)}},e=>{console.error("Error has occurred on subscribe",e)})}},mv=async e=>{try{var t;let n,i,r,s=Date.now(),o=eX(),a=aE(o),l=gj(o,{}),h=function(e,t,...n){if(e=ec(e),gk("collection","path",t),e instanceof gD){let i=cE.fromString(t,...n);return gR(i),new gM(e,null,i)}{if(!(e instanceof gO||e instanceof gM))throw new ch(cl.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(cE.fromString(t,...n));return gR(i),new gM(e.firestore,null,i)}}(l,"_guildStat"),u=await (t=function(e,t,...n){let i=[];for(let t of(function(e){let t=e.filter(e=>e instanceof g9).length,n=e.filter(e=>e instanceof g8).length;if(t>1||t>0&&n>0)throw new ch(cl.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i=i.concat(n)),i))e=t._apply(e);return e}(h),t=gP(t,gL),n=gP(t.firestore,gq),i=gB(n),r=new ml(n),g4(t._query),(function(e,t,n={}){let i=new cu;return e.asyncQueue.enqueueAndForget(async()=>{var r,s;let o;return r=await gE(e),s=e.asyncQueue,o=new p5(t,new g_({next:e=>{s.enqueueAndForget(()=>p2(r,o)),e.fromCache&&"server"===n.source?i.reject(new ch(cl.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),{includeMetadataChanges:!0,Ku:!0}),p1(r,o)}),i.promise})(i,t._query).then(e=>new mo(n,r,t,e))),c=[];u.forEach(e=>{let{stats:t,n:n,i:i}=e.data()||{},r=t?.reduce((e,t,n)=>e+(0,mf.calculateGuildBonusCost)(t,md.guildBonuses?.[n]?.gpBaseCost,md.guildBonuses?.[n]?.gpIncrease),0);c.push({id:e.id,totalStatCost:r,guildName:n,guildIcon:i})});let d=Date.now();console.info(`Guild firestore execution time: ${d-s} ms`);let f=c.sort((e,t)=>t?.totalStatCost-e?.totalStatCost),p=f?.slice(0,150),g=p.map(({id:e})=>aw(function(e,...t){let n=ec(e);for(let e of t)n=e._apply(n);return n}(a_(a,`_guild/${e}`)))),m=await Promise.all(g),y=m?.map((e,t)=>{let n=e.val(),i=p?.[t];return{...i,totalGp:(n?.p||0)+i?.totalStatCost,members:Object.values(n?.m||{})}}),_=y.sort((e,t)=>t?.totalGp-e?.totalGp)?.filter(({members:e})=>e?.length>10),v=Date.now();console.info(`Guild realtime db execution time: ${v-s} ms`),e({guilds:_})}catch(t){console.error(t),e({guilds:[],error:!0})}},mw=async(e,t)=>{try{let n=await aw(av(e,t));if(n&&n.exists())return n.val();return console.error(`No data available for key ${t}`),null}catch(e){return console.error(`Error while fetching data for key ${t}: `,e),null}},mI=async()=>{let e=iq(mu);await ec(e).signOut().then(()=>{console.info("Logged off successfully")}).catch(e=>{let t=e.code;console.error(`Error while logging out: ${t}`,e.message)})};e.s(["checkUserStatus",()=>my,"getGuilds",0,mv,"signInWithCustom",()=>mm,"signInWithEmailPassword",()=>mg,"signInWithToken",()=>mp,"subscribe",()=>m_,"userSignOut",()=>mI],153712)}]);